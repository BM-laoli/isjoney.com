---
title: "å–„çœ - ç¬¬å…­æœŸï¼ˆ22å¹´6æœˆï¼‰"
date: "2024-12-19"
summary: "æ¢è®¨å¦‚ä½•å½’çº³ç¢ç‰‡åŒ–çŸ¥è¯†ï¼Œé€šè¿‡PDCAå¾ªç¯ä¸æ–­è¿­ä»£å­¦ä¹ æ–¹æ³•ï¼›åˆ†äº«Nginxå¤šç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…æ‹¬äºŒçº§åŸŸåé…ç½®å’Œå‰ç«¯æ¡†æ¶éƒ¨ç½²å®è·µã€‚"
status: "completed"
tech: ["å­¦ä¹ æ–¹æ³•","çŸ¥è¯†ç®¡ç†","Nginx","å‰ç«¯éƒ¨ç½²"]
github: "https://github.com/BM-laoli"
arxiv: ""
keyId: "å–„çœ"
---

## å¦‚ä½•å½’çº³ç¢ç‰‡åŒ–ğŸ§©åŒ–çš„çŸ¥è¯†
 å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä½ è¦å­¦ä¹ çš„ä¸œè¥¿éå¸¸çš„å¤šï¼Œéå¸¸çš„ç¢ç‰‡åŒ–ï¼Œä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ç›®å‰éœ€è¦å­¦ä¹ çš„ä¸œè¥¿éå¸¸éå¸¸çš„å¤š

1. Nodejsçš„çŸ¥è¯†
2. Webçš„å¼€å‘çŸ¥è¯†
3. Android å¼€å‘çŸ¥è¯†
4. IOS å¼€å‘çŸ¥è¯†
5. React Naive å¼€å‘åªæ˜¯
6. Golang å¼€å‘çŸ¥è¯†
7. .....

ä½ ä¼šå‘ç°æˆ‘ä»¬éœ€è¦å­¦ä¹ çš„ä¸œè¥¿ï¼Œå¥½åƒå¼€èµ·æ¥éå¸¸çš„å¤šã€‚å¤šæ²¡æœ‰å…³ç³»æˆ‘ä»¬å¯ä»¥é€šè¿‡å½’çº³æ•´ç†èµ·æ¥ï¼Œä¸€å—ä¸€å—çš„å»èµ ç¤¼æ”¶é›†ï¼Œä½†æ˜¯æˆ‘è¦è®²çš„ä¸œè¥¿ä¸Šè¿™æ ·çš„æƒ…å†µï¼Œæ¯”å¦‚å­¦ä¹ è‹±è¯­çš„æ—¶å€™æˆ‘çš„çŸ¥è¯†æ–‡æ¡£çš„ç»“æ„è¿ç§» å’Œ æ¼”åŒ–

1. ç¬¬ä¸€ä¸ªç‰ˆæœ¬

æˆ‘ä»…ä»…æ˜¯æŒ‰ç…§æ•™ç¨‹ï¼Œä¸€æ­¥ä¸€æ­¥çš„å»åšï¼Œç„¶åæŠŠå®ƒå½’çº³æˆäº†è‡ªå·±çš„çŸ¥è¯†ï¼Œï¼ˆè¯´ç™½äº†è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»…ä»…æ˜¯ å­¦ä¹ ï¼ŒæŒ‰éƒ¨å°±ç­çš„å­¦ä¹ ï¼‰è¿™ä¸ªé˜¶æ®µæˆ‘åšçš„ç¬”è®°çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­çš„ ï¼šğŸ‘‡

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1656046200715-3299b8a5-05bf-4980-a6d4-60c931a65961.png)

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1656046229270-5f599391-d0c4-4d0b-924c-e635add9d139.png)



2. ç¬¬äºŒä¸ªç‰ˆæœ¬

ç­‰æˆ‘æ…¢æ…¢çš„å­¦ä¹ çš„è¿‡ç¨‹ä¹‹ä¸­ï¼Œæˆ‘é€æ¸çš„å‘ç°ï¼Œè¿™æ ·çš„åšç¬”è®°çš„æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯æ€»èƒ½éå¸¸å¥½çš„ç¬¦åˆæˆ‘è‡ªå·±ï¼Œè€Œä¸”ä¹Ÿä¸å¤Ÿç»“æ„åŒ–ï¼Œäºæ˜¯æˆ‘æ¼”å˜æˆäº†ä¸‹é¢çš„ç»“æ„ï¼Œï¼ˆæˆ‘åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç° listening å’Œ é¢„ä¹ ï¼Œå®é™…ä¸Šæ²¡æœ‰å¿…è¦ç”¨ä¸€ä¸ªå•ç‹¬çš„title å» è¿›è¡Œæ„é€ ï¼Œäºæ˜¯æˆ‘çš„åšç¬”è®°çš„æ–¹æ³•å¼€å§‹æ¼”åŒ–ï¼Œæˆ‘å»æ‰äº† å¬åŠ› å»æ‰äº†é¢„ä¹ æ ‡é¢˜ï¼Œæˆ‘æŠŠè¯­æ³•å’Œ è¯æ³• éƒ½åšæˆäº†è¡¨æ ¼ ï¼Œç°åœ¨ä»–ä»¬æ˜¯è¿™ä¸ªæ ·å­çš„ ğŸ‘‡ï¼š

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1656046487133-4efc5e4a-5b01-4498-89e4-c3f8aae1483c.png)



3. ç¬¬ä¸‰ä¸ªç‰ˆæœ¬

ä¹Ÿè®¸ä¸Šé¢çš„ç‰ˆæœ¬ä¾ç„¶ä¸æ˜¯æœ€å¥½çš„ï¼Œç°åœ¨æˆ‘è®¤ä¸ºä¹Ÿè®¸æˆ‘ä½¿ç”¨ä¸‹é¢çš„è¿™ä¸ªè½¯ä»¶ï¼Œåšè¿™æ ·çš„ç¬”è®°ä¼š æ›´åŠ çš„å¥½ï¼›åœ¨è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¯¾ç¨‹çš„é‡ç‚¹èšç„¦å°±æ˜¯ â€œæ–‡ç« â€ï¼Œé€šè¿‡å­¦ä¹ æ–‡ç« ï¼Œæˆ‘ä»¬æ¥åˆ†æå…¶ä¸­çš„è¯­æ³•ï¼Œå’ŒçŸ¥è¯†ç‚¹ï¼Œè¯æ±‡ï¼Œç„¶åæŠŠä»–ä»¬éƒ½æ±‡æ€»æ¥ã€‚é¡ºä¾¿å†å»ºç«‹ä¸€ä¸ª ç‰¹ç‚¹çš„ â€œæ”¶é›†åº“â€æ¥æ€»ç»“å’Œå½’çº³æ‰€æœ‰çš„ ï¼Œè¯æ±‡ï¼Œè¯æ³•ï¼Œè¯­æ³•çš„ ä¸€è§ˆè¡¨å“¥ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„é€Ÿè®°ä¸€äº›é‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œ![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1656046758744-7c05dbda-341d-4ab1-ae97-6c441b9e6d1b.png)

æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘å‘ç°å­¦ä¹ è¿™ä»¶äº‹æƒ…ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ª â€œæ¼”åŒ–çš„è¿‡ç¨‹â€ï¼Œéœ€è¦æˆ‘ä»¬ä¸æ–­çš„è¿­ä»£ è¿­ä»£ï¼Œå†è¿­ä»£, æ­£å¦‚æˆ‘åœ¨ æ–‡ç« ï¼š

[è®¤çŸ¥æ–¹æ³•è®º_ç¬¬äºŒæœŸ ( é€‚ç”¨äºè€æ )é‡è¦ç½®é¡¶](https://www.yuque.com/bmlaoli/gyzv66/dhedch)

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1656046899569-bdb6eb5f-4dcf-4385-bc5e-0b173171b188.png)



æ€»çš„æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºç›®å‰çš„è¿™ç§æ€ç»´æ¨¡å¼å¸¦ç»™äº†æˆ‘ä¸€å®šå¯ç¤º PDCAï¼Œä¸åœçš„ä¸æ–­çš„ å»ç»™è‡ªå·±è¿­ä»£ã€‚è¿™å°±æ˜¯æ¼”åŒ–æ‰€ç»™æˆ‘å¸¦æ¥çš„åŠ›é‡ï¼Œä¹Ÿè®¸è¿˜æœ‰å¾ˆå¤šèƒ½ç»™æˆ‘å¸¦æ¥æ›´å¤šçš„æˆå°±... ç­‰å¾… æˆ‘çš„å‘æ˜

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1656047185821-e477056e-49a7-45a8-acb8-16148994060e.png)







## ç”¨é•¿è¿œçš„çœ¼å…‰çœ‹å¾…æ‰€æœ‰çš„äº‹æƒ…
æ¥è‡ªä¹”å¸®ä¸» çš„ä¸€æ¬¡æ¼”è®²



## è®°å½•ä¸€æ¬¡Nginx
è®°å½•ä¸€ä¸ªNginx å’ŒäºŒçº§åŸŸå + å‰ç«¯æ¡†æ¶çš„éƒ¨ç½²é—®é¢˜ ğŸ“ã€‚

éœ€æ±‚èƒŒæ™¯ï¼š



è¦æ±‚éƒ¨ç½²çš„æ—¶å€™ä½¿ç”¨ä¸åŒçš„URL æ¥åŒºåˆ†ä¸åŒçš„ç¯å¢ƒ

  


| éœ€æ±‚èƒŒæ™¯ | éƒ¨ç½²è¦æ±‚ |
| --- | --- |
| æˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªshopifyçš„æ’ä»¶ï¼Œå®ƒå…·å¤‡äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä¸»è¦åˆ†ä¸‰ä¸ªéƒ¨åˆ† ï¼Œ2B+ 2Cï¼ˆReact çº¯js +them- extension ï¼‰ + game | éƒ¨ç½²åˆ°ä¸‰ä¸ªä¸åŒçš„ç¯å¢ƒä¸­å»ï¼Œæ¯”èµ·ç»™è¦æ±‚æ˜¯äºŒçº§åŸŸå    |


| ç¯å¢ƒ | å‰ç«¯ | åç«¯ |
| --- | --- | --- |
| dev | youhoust.com/shopify_app/app1/2b_gqc   -> bç«¯ æŒ‡å‘ä¸€ä¸ªspaåº”ç”¨<br/>   youhoust.com/shopify_app/app1/2c_gqc/game1<br/>-> cç«¯game æŒ‡å‘ä¸€ä¸ª Pahaser åº”ç”¨<br/><br/>shopify.com/sss/sss<br/>-> shopify ä¼šè‡ªåŠ¨å»è½½å…¥ä½ çš„jsï¼Œæˆ‘ï¼Œ åªéœ€è¦åŠ¨æ€åˆ›å»ºroot èŠ‚ç‚¹ï¼Œå†ä¸€æ¬¡æ€§æŒ‚åœ¨å…¨éƒ¨js å°±å¥½äº†ã€‚       | youhoust.com/shopify_app/app1/api_gqc |
| staging | youhoust.com/shopify_app/app1/2b_staging   -> bç«¯ æŒ‡å‘ä¸€ä¸ªspaåº”ç”¨<br/>   youhoust.com/shopify_app/app1/2c_staging/game1<br/>-> cç«¯game æŒ‡å‘ä¸€ä¸ª Pahaser åº”ç”¨<br/><br/>shopify.com/sss/sss<br/>-> shopify ä¼šè‡ªåŠ¨å»è½½å…¥ä½ çš„jsï¼Œæˆ‘ï¼Œ åªéœ€è¦åŠ¨æ€åˆ›å»ºroot èŠ‚ç‚¹ï¼Œå†ä¸€æ¬¡æ€§æŒ‚åœ¨å…¨éƒ¨js å°±å¥½äº†ã€‚ | youhoust.com/shopify_app/app1/api_staging |
| prd | youhoust.com/shopify_app/app1/2b_prd   -> bç«¯ æŒ‡å‘ä¸€ä¸ªspaåº”ç”¨<br/>   youhoust.com/shopify_app/app1/2c_prd/game1<br/>-> cç«¯game æŒ‡å‘ä¸€ä¸ª Pahaser åº”ç”¨<br/><br/>shopify.com/sss/sss<br/>-> shopify ä¼šè‡ªåŠ¨å»è½½å…¥ä½ çš„jsï¼Œæˆ‘ï¼Œ åªéœ€è¦åŠ¨æ€åˆ›å»ºroot èŠ‚ç‚¹ï¼Œå†ä¸€æ¬¡æ€§æŒ‚åœ¨å…¨éƒ¨js å°±å¥½äº†ã€‚ | youhoust.com/shopify_app/app1/api |


è¿™ç§æˆ‘ä»¬å¦‚ä½•åšå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ ä½¿ç”¨Nginx çš„å‰ç«¯æ–¹æ¡ˆï¼Œè¿™äº›æ–¹æ¡ˆéƒ½æ˜¯æœ‰ç»éªŒçš„å¤§ä½¬æ€»ç»“æ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿé‰´ä¸€ä¸‹

é¦–å…ˆå‘¢æ˜¯ 

[Nginxä¸­æ–‡æ–‡æ¡£](https://www.nginx.cn/doc/index.html)

ï¼Œä¸€äº›å€¼å¾—å€Ÿé‰´çš„æ–‡ç«  

[çŸ¥ä¹çš„æ–‡ç« ](https://zhuanlan.zhihu.com/p/33379828)

[nginxé…ç½®é€‰é¡¹try_filesè¯¦è§£_åŠ¿æ— å½¢çš„åšå®¢-CSDNåšå®¢_tryfiles](https://blog.csdn.net/qq_24861509/article/details/102716191)



ä»–ä»¬åŸºæœ¬ä¸Šå°±æ˜¯è¯´ä¸€ä»¶äº‹ï¼šä½¿ç”¨ try_files åŸºæœ¬ä¸Šå°±èƒ½è§£å†³ä½ çš„æ‰€æœ‰éœ€æ±‚



ç»¼åˆä¸Šé¢æ‰€è¿°æˆ‘åªéœ€è¦è¿™æ ·é…ç½®nginx å°±èƒ½è¾¾åˆ°æˆ‘éœ€éœ€è¦çš„æ•ˆæœ

```nginx
worker_processes  1;

events {
    worker_connections  1024;
}

http {

    include       mime.types;
    default_type  application/octet-stream;
    server_tokens off;
    sendfile        on;

    keepalive_timeout  65;
    client_header_buffer_size    2m;
    large_client_header_buffers  4 2m;
    client_max_body_size 0;
    client_body_buffer_size 2m;
    underscores_in_headers on;
    ignore_invalid_headers off;

    server {
        listen 80;
        root /opt/app;
        gzip on;
        gzip_min_length 1k;
        gzip_buffers 4 8k;
        gzip_http_version 1.1;
        client_header_buffer_size    2m;
        large_client_header_buffers  4 2m;
        client_max_body_size 0;
        client_body_buffer_size 2m;
        underscores_in_headers on;
        ignore_invalid_headers off;

        # è¿è¡Œè·¨è¶Šé…ç½®
        #å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸï¼Œ* ä»£è¡¨æ‰€æœ‰ PRD éœ€è¦åŠ ä¸Šå¤„ç†GQC å…è®¸æ‰€æœ‰è®¿é—®
        add_header 'Access-Control-Allow-Origin' *;
        #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
        add_header 'Access-Control-Allow-Credentials' 'true';
        #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
        add_header 'Access-Control-Allow-Methods' *;
        #å…è®¸è¯·æ±‚çš„header
        add_header 'Access-Control-Allow-Headers' *;
                
        # ----------dev æœ¬åœ°å¼€å‘
        # 2b
        location ^~ /shopify_campaign_app_ui_gqc_2b/  { 
          root /opt/app;
          try_files $uri  /shopify_campaign_app_ui_gqc_2b/index.html;
        }

        # 2c 
        location ^~ /shopify_campaign_app_ui_gqc_2c/  {
          root /opt/app/games/;
          try_files $uri  $uri/ ;
        }

        

        # ---------- staging ç°åº¦
        # 2b
        location ^~ /shopify_campaign_app_ui_staging_2b/  { 
          root /opt/app;
          try_files $uri  /shopify_campaign_app_ui_staging_2b/index.html;
        }

        # 2c 
        location ^~ /shopify_campaign_app_ui_staging_2c/  {
          root /opt/app/games/;
          try_files $uri  $uri/ ;
        }
        


        # ---------- prd  äº§çº¿
        # 2b
        location ^~ /shopify_campaign_app_ui/  { 
          root /opt/app;
          try_files $uri  /shopify_campaign_app_ui/index.html;
        }

        # 2c 
        location ^~ /shopify_campaign_app_ui_2c/  {
          root /opt/app/games/;
          try_files $uri  $uri/ ;
        }
    }
}

```



âš ï¸ æ³¨æ„ï¼Œä½ ä¸ä»…ä»…è¦å…³æ³¨ nginx çš„é…ç½®ï¼Œä½ è¿˜è¦ç¡®ä¿çš„ä½ çš„æ–‡ä»¶å¤¹ç»“æ„ğŸ“ ç»„ç»‡çš„æ­£ç¡®æ€§ï¼Œä¸‹é¢æ˜¯é€‚åˆä¸Šé¢é…ç½®çš„æ–‡ä»¶å¤¹ç»“æ„

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1657791392542-cb2ac416-3c18-4260-ba26-b798446be0a9.png)

è¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨docker éƒ¨ç½²çš„ä¸€ä¸ªç‹¬ç«‹çš„webServiceï¼Œåœ¨è¿è¡Œçš„æ—¶å€™éœ€è¦æŒ‡å®šä¸€äº›ç¯å¢ƒã€‚  
è€Œä¸”è¿˜éœ€è¦æ‰‹åŠ¨çš„æ‰§è¡Œ nginx å»å¼€å¯ï¼Œä½†æ˜¯åº”è¯¥æœ‰æ›´å¥½çš„æ–¹å¼å»å®ç°ã€‚  
å¯¹äºå‰ç«¯ä¸åŒçš„ç¯å¢ƒï¼ŒåŒºåˆ†æˆ‘ä»¬æ˜¯é€šè¿‡ä»£ç æ³¨å…¥çš„æ–¹å¼ å»æ›¿æ¢äº†api åœ°å€çš„ äºŒçº§é™†æ¸¸åœ°å€ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ï¼ˆç”±äºè¿™ä¸æ˜¯ç»ˆç‚¹ï¼Œæˆ‘ä»¬ç®€å•è®²ï¼‰

```shell
# è¿›å…¥åˆ°appçš„ç›®å½•ä¸‹
$ nginx 
$ nginx 
# è¿ç»­ä¸¤ä¸‹nginx å°±èƒ½è¿è¡Œäº†
```

```dockerfile

FROM node:latest
RUN  apt-get -y update && apt-get -y install nginx  
RUN  apt-get -y update && apt-get -y install vim
RUN wget ftp://mama.indstate.edu/linux/tree/tree-1.6.0.tgz
RUN  tar xzvf tree-1.6.0.tgz
RUN  cd tree-1.6.0 &&  make && make install

# runtime é…ç½®
COPY script /opt/app

# prd & gqc & staging
COPY build/admin/prd /opt/app/shopify_campaign_app_ui
COPY build/admin/gqc /opt/app/shopify_campaign_app_ui_gqc_2b
COPY build/admin/staging /opt/app/shopify_campaign_app_ui_staging_2b

COPY build/games/prd /opt/app/games/shopify_campaign_app_ui_2c
COPY build/games/gqc /opt/app/games/shopify_campaign_app_ui_gqc_2c
COPY build/games/staging /opt/app/games/shopify_campaign_app_ui_staging_2c

COPY nginx.conf /etc/nginx
ENV shopify_env gqc

WORKDIR /opt/app
CMD sh /opt/app/runtime.sh
```

