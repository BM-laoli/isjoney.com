---
title: "React ç¼–ç è§„èŒƒä¸æœ€ä½³å®è·µæŒ‡å—"
date: "2024-12-19"
summary: "æ·±å…¥æ¢è®¨ React ä»£ç ç¼–å†™è§„èŒƒï¼ŒåŒ…æ‹¬ç»„ä»¶å¸ƒå±€ã€ä¾èµ–åŒ…ç®¡ç†ã€æ³¨é‡Šè§„èŒƒã€ä»£ç è´¨é‡å¯¹æ¯”ä»¥åŠé¡¹ç›®æ„å»ºæ¨¡å¼ç­‰æœ€ä½³å®è·µã€‚"
status: "completed"
tech: ["React", "JavaScript", "CodingStandards"]
github: "https://github.com/BM-laoli"
arxiv: ""
keyId: "React"
---

> ç»è¿‡å·®ä¸éƒ½ä¸‰ä¸ªå¤šæœˆçš„å®è·µï¼Œæœ¬äººå¯¹è‡ªå·±çš„Reactä»£ç ç¼–ç¨‹çš„è§„èŒƒæœ‰äº†è¿›ä¸€æ­¥çš„åŠ æ·±äº†è§£
>
> ï¼Œåœ¨vueä¸Šæœ‰å¼€æºçš„æ–‡ç« å’Œè§„èŒƒä½œä¸ºæŒ‡å¯¼ï¼Œåœ¨Reactæ–¹å‘ä¸Šè¿™æ–¹é¢å°‘å¾—å¯æ€œï¼Œå› æ­¤æœ¬äººç»“åˆè‡ªå·±åœ¨å·¥ä½œä¸Šçš„ç»ˆç»“
>
> æ‘¸ç´¢å‡ºè¿™æ ·çš„ä¸€å¥—åˆç†çš„ç¬¦åˆä»£ç ç¼–å†™é£æ ¼çš„React_PCæŒ‡å—ï¼Œæ³¨æ„ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„é˜¿é‡Œå®¶åŒæ¬¾çš„æ‰€æœ‰æŠ€æœ¯æ ˆï¼Œäºæ˜¯è¿™é‡Œæœ‰äº›ä¸œè¥¿æ˜¯æˆ‘ä»¬æ¯”é€‰çš„æ¯”å¦‚è¯´
>



## ä¸€ã€ä»£ç æµ‹å±‚é¢çš„è§„èŒƒ
### 1. ä»£ç çš„å¸ƒå±€å¦‚ä¸‹
```jsx
// MyComponent
 import React, { useState, useRef,useEffect, useCallback, useContext } from 'react' 


 /** 
  * Preset 
  */ 


const MyComponent = () => {
 /** 
  * state 
  */ 


 /** 
  * method
  */ 


 /** 
  * effct 
  */ 


 /** 
  * componentsConfig 
  */ 


 /** 
  * render
  */ 
 return(
    <>
     <h1>BMlaoli-coding....</h1>
    </>
   )
 }

export default MyComponent
```

### 2. ä¾èµ–åŒ…çš„ç¾è§‚ç¨‹åº¦
```jsx
import { PageHeaderWrapper } from '@ant-design/pro-layout';
import config from '@/utils/config';
import ProTable from '@ant-design/pro-table';
import { useRequest } from 'ahooks';
import { Card, Input, Select, Tag, Popconfirm, Button } from 'antd';
import { page, deleteArrange } from '@/services/service';
import React, { useEffect, useRef, useState } from 'react';

//ä»¥ä¸Šçš„ä»£ç æ˜¾å¾—æœ‰äº›æ··ä¹±ã€‚ä¸è¿‡ä¹Ÿæ˜¯ä¸è¦ç´§çš„
/**
 * èµ„äº§å›æ”¶ç«™Tableè¡¨æ ¼
 */
import React, { useState, useRef, useEffect, useCallback, useContext } from 'react';
import { Card, Button, message, Row, Col, Select, Form, Cascader, Space, Popconfirm, Alert, Input, } from 'antd';
import { getHeader, deleteAsset, page, getTags } from '@/pages/Dashboard/services/assetDetail';
import { getNamespace } from '@/pages/discovery/Setting/services/discoveryJob';
import { PageHeaderWrapper } from '@ant-design/pro-layout';
import { getAssetModel } from '@/services/assetModel';
import ProTable from '@ant-design/pro-table';
import { PlusOutlined } from '@ant-design/icons';
import { operate } from '@/services/recycle';
import config from '@/utils/config';
import { useRequest } from 'ahooks';
import { Link } from 'umi';
import DrawerHH from '../Drawer';
import moment from 'moment'

const { Option, OptGroup } = Select;

//ä»¥ä¸Šçš„ä»£ç éœ€è¦éå¸¸æ³¨æ„çš„ä¸€ç‚¹æˆ‘ä¸€å®šè¦æé†’ä½ ï¼Œå¦‚æœåŒ…ä¹‹é—´æœ‰æ˜ç¡®çš„ä¾èµ–å…³ç³»ï¼Œé‚£ä½ å°±ä¸èƒ½è¿™æ ·åšï¼Œä¼šå‡‰å‡‰çš„
//ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶ä¸æ¨èä½¿ç”¨å¦‚ä¸Šçš„æ ¼å¼ï¼Œå› ä¸ºå®ƒä¼šé€ æˆä¸€äº›éå¿…è¦çš„é—®é¢˜ï¼Œå¦‚æœä½ ä¸æ˜¯å’Œæˆ‘ä¸€æ ·æœ‰å¼ºè¿«ç—‡ è¿™ä¸ªimportå¯¼åŒ…çš„åœ°æ–¹æ˜¯éå¿…è¦çš„ï¼Œè¿™æ ·å°±å·®ä¸å¤šäº†

```

### 3. æ³¨æ„äº‹é¡¹
> è¯·æ³¨æ„ç»™ä½ çš„ä»£ç åŠ ä¸Šæ³¨é‡Šï¼Œæˆ‘å‘ç°å¥½å¤šçš„æœ‹å‹éƒ½å¿…é¡»ä¼šåŠ æ³¨é‡Šï¼Œå½“ä¸€ä¸ªé¡¹ç›®ç»„ä¸­æœ‰å¾ˆå¤šäººå…±åŒå®Œæˆå¾ˆå¤šçš„ä»£ç çš„æ—¶å€™ï¼Œè¿™æ ·ç»´æŠ¤çš„æˆæœ¬æ˜¯ä¸å¯æƒ³è±¡çš„
>
> å¦‚æœæœ‰é‡å¤§bugæˆ–è€…æœ‰äººç¦»èŒäº†ï¼Œé‚£ä¹ˆå®ƒçš„ä»£ç å°†ä¼šæ— äººçœ‹æ‡‚ï¼Œé€»è¾‘çš„å †å å°†ä¼šæ˜¯ä¸å¯å¼€äº¤çš„
>

```jsx
// è·å–æ ‡ç­¾
  const { run: getTageList } = useRequest(getTags, {
    onSuccess: (result) => {
      if (result && result.success) {
        setTagList(result.data);
        getColumns({ tableName: location.query.tableName });
      }
    },
  });


  /** 
 * componentsConfig 
 */
  // ç”¨æˆ·è‡ªå®šä¹‰çš„æ£€ç´¢é¡¹ æ ‡ç­¾
  const TagtSearch = (_, p) => {
    return (
      <Select mode="multiple" placeholder="è¯·é€‰æ‹©æ ‡ç­¾" showArrow
        {...p}
      >
        { tagList.map((item) => (
          <OptGroup label={item.name} key={item.id}>
            {(item.tags ? item.tags : []).map((items) => (
              <Option value={items.name} key={items.id}>
                {items.name}
              </Option>
            ))}
          </OptGroup>
        ))}
      </Select>
    )
  }

  // ç½‘ç»œåŸŸ
  const NamespaceSearch = (_, p) => {
    return (
      <Select placeholder="è¯·é€‰æ‹©ç½‘ç»œåŸŸ" {...p}>
        {  namespace.map(item => (
          <Option key={item.id} value={item.name}>{item.name}</Option>
        ))}
      </Select>
    )
  }

  /** 
   * method
   */
  /** æ³¨æ„ï¼Œè¿™æ ·çš„ä»£ç ä»…ä»…é€‚ç”¨äºï¼Œå¤æ‚çš„å­ç¨‹åºæ³¨é‡Šï¼Œä¸è¦å››å¤„æ»¥ç”¨
   * æè¿°  
   * åŠ¨æ€å•Šçš„è·å–è¡¨å¤´
   * @author lishizeng
   * @date 2020-10-10
   * @param {Array} data è·å–çš„æ•°æ® 
   * @returns {any}
   */
  const dynamicSetColums = (value) => {

    let data = value.map((item) => {
      let valueType = 'text';
      if (item.propertyType === 'DATETIME') {
        valueType = 'dateTime';
      } else if (item.propertyType === 'DATE') {
        valueType = 'date';
      } else if (item.propertyType === 'TIME') {
        valueType = 'time';
      }
      const basicColumns = {
        hideInSearch: !InCulde.includes(item.name),
        title: item.name,
        dataIndex: item.propertyName,
        width: 200,
        ellipsis: true,
        sorter: tru
        ......
 
        
  // ä½ å¯ä»¥éå¸¸æ¸…æ™°çš„çœ‹åˆ°æˆ‘çš„ä»£ç çš„æ³¨é‡Šï¼Œæœ‰äº›ä»£ç çš„æ³¨é‡Šæ¯”è¾ƒå¤æ‚ï¼Œ@ä»€ä¹ˆä»€ä¹ˆçš„ï¼Œä½†æ˜¯æœ‰çš„ä»£ç çœ‹èµ·æ¥æ¯”è¾ƒçš„ç®€å•ï¼Œåªæœ‰ // é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»€ä¹ˆæ—¶å€™ *å…¨æ³¨é‡Šä»€ä¹ˆæ—¶å€™ç”¨
        //å‘¢ï¼Œæˆ‘è®¤ä¸ºå¦‚æœå…¨éƒ¨éƒ½æ˜¯/*@*/é‚£ä¹ˆ ä»£ç è™½ç„¶å¾ˆokï¼Œä½†æ˜¯è¿™ä¸ªå’Œæˆ‘ä»¬çš„å¼€å‘æ•ˆç‡æ˜¯ä¸ç¬¦çš„
       ï¼Œå› æ­¤ä»€ä¹ˆæ—¶å€™ç”¨/*@*/ä»€ä¹ˆæ—¶å€™ç”¨//ï¼Œæˆ‘ä»¬è¿˜æ˜¯çœ‹æƒ…å†µæ¥é…ç½®æ˜¯æ¯”ä»·åˆé€‚çš„
        
 ----> ç›®å‰æˆ‘ä¸ªäººæ¯”è¾ƒæ¨å´‡çš„è§„èŒƒæ˜¯ï¼š
        1. ä¸€åˆ‡ä»¥ç®€å•ä¸ºä¸» // 
        2. å¦‚æœæ˜¯ç»„ä»¶çš„ä¸œè¥¿ å¯ä»¥ä½¿ç”¨ /**/
        3. å¦‚æœæ˜¯ä»£ç å¤æ‚çš„åœ°æ–¹ï¼Œå¯ä»¥ 
           /** 
             * æè¿°  
             * åŠ¨æ€å•Šçš„è·å–è¡¨å¤´
             * @author lishizeng
             * @date 2020-10-10
             * @param {Array} data è·å–çš„æ•°æ® 
             * @returns {any}
             */
        4. åŸåˆ™ï¼Œå¦‚æœä½ ç¼–å†™æ³¨é‡Šçš„æ—¶é—´ï¼Œè€—è´¹äº†ä½ ä»£ç çš„æ—¶é—´ï¼Œé‚£ä¹ˆä½ åº”è¯¥è€ƒè™‘ä¸€ä¸‹äº†ï¼Œè¿™æ ·çš„ä»£ç æ³¨é‡Šæ˜¯ä¸æ˜¯å¤ªæœ‰å¿…è¦ï¼Ÿ

```

### 4. ä¸€ä¸ªä¸è§„èŒƒçš„ä»£ç &&ä¸€ä¸ªç¼–ç é£æ ¼è‰¯å¥½çš„ä»£ç 
> ä»¥ä¸‹çš„ä»£ç ç»´æŠ¤å’Œå¯é˜…è¯»æ€§ç®€ç›´ğŸ˜­
>



- [x] è´¨é‡ä¸æ˜¯å¾ˆå¥½çš„ä»£ç ç¤ºä¾‹

```jsx
import React, { useState, useRef, useEffect, useCallback, useContext, createRef } from 'react'
import {
  Form, Drawer, Button, Input, Collapse, Row, Col, message,
  Select, Checkbox, Radio, Tree, Tabs, Space, DatePicker, Spin, Popover
} from 'antd'
import config from '@/utils/config';
import { CloseOutlined, MinusCircleOutlined, PlusOutlined } from '@ant-design/icons'
import { createCheckTaks, getTackById, getServieceScenes, getConfigByServieceScenes, getAssetLoctionByServieceScenes } from '../../service'
import TaskType from './TaskType'
import TreeConfig from './Tree'
import { useRequest } from 'ahooks'
import { history, useModel } from 'umi';
import Execution from './ExecutionType'
import moment from 'moment'
const { Panel } = Collapse;
const { TabPane } = Tabs;
import _ from 'lodash'

/** 
 * é¢„ç½®æ–¹æ³• 
 */
const InspectionMode = ({ actionRef, visable, setVsiable, itemValue, setItemValue, formDefalutValues, setFormDefalutValues }) => {
  /** 
   * åˆå§‹åŒ–æ•°æ® 
   */
  const [form] = Form.useForm();
  const [propsTreeData, setPropsTreeData] = useState([])
  const [treeDefaultDataChangeValue] = useState('VMWARE')
  const { initialState } = useModel('@@initialState');

  const [servieceScenesList, setServieceScenesList] = useState([])

  const [servieceScenesIdType, setServieceScenesIdType] = useState(null)
  const [servieceScenesId, setServieceScenesId] = useState(0)
  const [assetObjcet, setAssetObjcet] = useState([])
  /** 
   * æ–¹æ³• 
   */
  const close = () => {
    setItemValue(Object.assign([], []))
    form.resetFields();
    setVsiable(false)
    setFormDefalutValues(null)
  };

  const { run: initServieceScenes, } = useRequest(getServieceScenes, {
    manual: true,
    onSuccess: (result, params) => {
      if (result && result.success) {
        setServieceScenesList(_.filter(result.data, (v) => v.name !== 'è‡ªå®šä¹‰'))
      }
    },
  });

  const { run: initConfigByServieceScenes, } = useRequest(getConfigByServieceScenes, {
    manual: true,
    onSuccess: (result, params) => {
      if (result && result.success) {
        if (servieceScenesIdType) {
          initAssetLoctionByServieceScenes(servieceScenesId)
        }
      }
    },
  });

  const { run: initAssetLoctionByServieceScenes, } = useRequest(getAssetLoctionByServieceScenes, {
    manual: true,
    onSuccess: (result, params) => {
      if (result && result.success) {
        setAssetObjcet(result.data)
      }
    },
  });

  // é€‰æ‹©åœºæ™¯
  const servieceScenesChange = (value, b, c) => {
    setServieceScenesIdType(b.typeS)
    setServieceScenesId(value)
  }

  useEffect(() => {
    // if(itemValue.length>0){
    // }
    // // setServieceScenesIdType(() => {
    // //   if (itemValue.assetIdList === 0) {
    // //     return 1
    // //   } else {
    // //     return 0
    // //   }
    // // })

    if (servieceScenesId) {
      initConfigByServieceScenes(servieceScenesId)
    }
  }, [servieceScenesId])

  const onSubmit = () => {
    if (propsTreeData.length == 0) {
      message.error('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ£€æŸ¥é¡¹ï¼')
      return
    }
    form
      .validateFields()
      .then(async (values) => {
        // console.log(values);
        let FormObject = {
          id: values.id ? values.id : undefined,
          name: values.name,
          taskType: values.ip ? 2 : 1,
          performStatus: values.performStatus,
          performTimeSource: values.performStatus == 1 ?
            moment(values.performTimeSourceE).format('YYYY-MM-DD hh:mm:ss') :
            values.performTimeSource,
          description: values.description || '',
          userId: values.userId,
          userName: values.userName,
          configIdList: propsTreeData,
          serviceVersionId: values.serviceVersionId || 1,
          adviceObjectList: !values.ip ? null : [{
            ip: values.ip,
            user: values.user,
            password: values.password
          }],
          assetIdList: values.assetIdList
        }

        console.log(FormObject, '+++>');

        const { success } = await createCheckTaks(FormObject)
        if (success) {
          message.success('è®¾ç½®æˆåŠŸ')
        }
        actionRef.current.reload()
        form.resetFields();
        setItemValue(Object.assign([], []))
        setFormDefalutValues(null)
        setVsiable(false)
      })
      .catch((info) => {
        console.log(info);
      });
  }

  const handleChange = (value) => {
  }

  const initItemValue = async (value) => {
    try {
      const { data } = await getTackById(value)
      setFormDefalutValues(data)
    } catch (error) {
      message.error(error)
    }
  }

  // çº§è”æ£€æŸ¥é¡¹
  const callback = () => {
  }

  /** 
   * ç”Ÿå‘½å‘¨æœŸ 
   */
  useEffect(() => {
    initServieceScenes()
  }, [itemValue])

  /** 
   * ç»„ä»¶é…ç½® 
   */
  // æŒ‡å®šä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼Œå±•å¼€é¡¹ç»„ä»¶
  // Draweré¡µè„š
  const DrawerFooter = () => {
    return (
      <div style={{ float: "right", marginRight: 15 }}>
        <Button style={{ marginRight: 8 }} onClick={close}>å–æ¶ˆ</Button>
        <Button type='primary' onClick={onSubmit}>æäº¤</Button>
      </div>
    )
  }


  /** 
   * è§†å›¾ 
   */
  return (
    <>
      <Drawer
        title={itemValue.id ? 'ç¼–è¾‘å·¡æ£€ä»»åŠ¡' : 'æ–°å¢å·¡æ£€ä»»åŠ¡'}
        placement="right"
        onClose={close}
        visible={visable}
        closable={true}
        closeIcon={<CloseOutlined />}
        destroyOnClose={true}
        width={800}
        footer={DrawerFooter()}
      >
        <Form
          // style={{ width: 500 }}
          preserve={false}
          form={form} layout="horizontal"
          onFinish={(value) => {
          }}
          size="large"
          layout="horizontal"
        >
          <Form.Item
            {...config.modalFormItemLayout}
            label="ä»»åŠ¡åç§°"
            name='name'
            rules={[
              { required: true, message: 'è¯·è¾“å…¥ä»»åŠ¡åç§°', },
              { max: 20, message: 'åç§°ä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦' },
            ]}
            initialValue={itemValue && itemValue.name}
          >
            <Input placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°" />
          </Form.Item>

          <Form.Item
            label="ä»»åŠ¡æè¿°"
            {...config.modalFormItemLayout}
            name='description'
            initialValue={itemValue && itemValue.description}
          >
            <Input.TextArea placeholder="è¯·è¾“å…¥æè¿°" />
          </Form.Item>

          <Form.Item
            {...config.modalFormItemLayout}
            name="serviceVersionId"
            label="é€‰æ‹©å·¡æ£€åœºæ™¯"
            initialValue={itemValue && itemValue.serviceVersionId}
            rules={[{ required: true, message: 'è¯·é€‰æ‹©å·¡æ£€åœºæ™¯' }]}
          >
            <Select disabled={itemValue && itemValue.serviceVersionId} placeholder="è¯·é€‰æ‹©å·¡æ£€åœºæ™¯" onChange={servieceScenesChange} >
              {servieceScenesList.map((item) => (
                <Option typeS={item.type} value={item.id} key={item.id}>
                  {item.serviceVersionName}
                </Option>
              ))}
            </Select>
          </Form.Item>

          <Form.Item
            noStyle
            shouldUpdate={(prevValues, currentValues) => prevValues.serviceVersionId !== currentValues.serviceVersionId}
          >
            {({ getFieldValue }) => {
              return getFieldValue('serviceVersionId') ? (
                <>
                  {
                    servieceScenesIdType
                      ? (
                        <Form.Item
                          label="å·¡æ£€å¯¹è±¡"
                          {...config.modalFormItemLayout}
                          name='assetIdList'
                          rules={
                            [{ required: true, message: 'è¯·é€‰æ‹©ä¸€ä¸ªå·¡æ£€å¯¹è±¡' }]
                          }
                        >
                          <Select
                            mode='multiple'
                            placeholder="è¯·é€‰æ‹©å·¡æ£€å¯¹è±¡" >
                            {assetObjcet.map((item) => (
                              <Option typeS={item.type} value={item.id} key={item.id}>
                                {item.assetName}
                              </Option>
                            ))}
                          </Select>
                        </Form.Item>
                      )
                      : (
                        <>
                          <Form.Item
                            label='IP'
                            name='ip'
                            {...config.modalFormItemLayout}
                            rules={
                              [{ required: true, message: 'VCåœ°å€æ˜¯å¿…å¡«çš„ï¼' }, {
                                pattern: config.ipExp,
                                message: 'è¯·è¾“å…¥æ­£ç¡®çš„IPåœ°å€',
                              }]
                            }
                            initialValue={formDefalutValues && formDefalutValues.adviceObjectList[0].ip}
                          >
                            <Input addonBefore="https://" disabled={formDefalutValues} placeholder="è¯·è¾“å…¥VCåœ°å€" />
                          </Form.Item>
                          <Form.Item
                            {...config.modalFormItemLayout}
                            label='ç”¨æˆ·å'
                            name='user'
                            rules={
                              [{ required: true, message: 'ç”¨æˆ·åæ˜¯å¿…å¡«çš„ï¼' }]
                            }
                            initialValue={formDefalutValues && formDefalutValues.adviceObjectList[0].user}
                          >
                            <Input disabled={formDefalutValues} placeholder="è¯·è¾“ç”¨æˆ·å" />
                          </Form.Item>
                          <Form.Item
                            {...config.modalFormItemLayout}
                            label='å¯†ç '
                            name='password'
                            rules={
                              [{ required: true, message: 'å¯†ç æ˜¯å¿…å¡«çš„ï¼' }]
                            }
                            initialValue={formDefalutValues && formDefalutValues.adviceObjectList[0].password}
                          >
                            <Input.Password disabled={formDefalutValues} placeholder="è¯·è¾“å…¥å¯†ç " />
                          </Form.Item>
                          <Form.Item initialValue={2} name="taskType" noStyle>
                            <Input type="hidden" />
                          </Form.Item>
                        </>
                      )
                  }
                  <Form.Item
                    label="æ£€æŸ¥é¡¹"
                    {...config.modalFormItemLayout}
                    name='configIdList'
                  >
                    <Popover
                      content="å¿…é¡»é€‰æ‹©ä¸€ä¸ªæ£€æŸ¥é¡¹"
                      visible={propsTreeData.length == 0}
                    >
                      <TreeConfig
                        id={servieceScenesId}
                        formDefalutValues={formDefalutValues}
                        treeDefaultDataChangeValue={treeDefaultDataChangeValue}
                        setPropsTreeData={setPropsTreeData} />
                    </Popover>
                  </Form.Item>

                  <Form.Item
                    label="æ‰§è¡Œä»»åŠ¡"
                    {...config.modalFormItemLayout}
                    name='execution_time'
                  >
                    <Execution itemValue={itemValue} />
                  </Form.Item>
                  <Form.Item initialValue={initialState.currentUser && initialState.currentUser.id} name="userId" noStyle>
                    <Input type="hidden" />
                  </Form.Item>
                </>
              ) : null;
            }}
          </Form.Item>
          <Form.Item initialValue={initialState.currentUser && initialState.currentUser.username} name="userName" noStyle>
            <Input type="hidden" />
          </Form.Item>
          <Form.Item initialValue={itemValue && itemValue.id} name="id" noStyle>
            <Input type="hidden" />
          </Form.Item>
        </Form>

      </Drawer>
    </>
  )
}

export default InspectionMode
```



> _**<font style="color:#F5222D;">ä¸Šè¿°ä»£ç çš„è¯Ÿç—…ï¼š</font>**__**<font style="color:#F5222D;"></font>**_
>
> 1. æ•´ä½“çš„è§„èŒƒå¸ƒå±€å‡Œä¹±ï¼Œæ¯”å¦‚stateæ²¡æœ‰å†™åœ¨ä¸€èµ·
> 2. ç»„ä»¶æ²¡æœ‰å¾ˆå¥½çš„åˆ†ç¦»ï¼Œè¿‡å¤šçš„if else åµŒå¥—å’Œåˆ¤æ–­ï¼Œè®©ä½ å¤´æ˜è„‘æ¶¨
>

- [x] è´¨é‡è¿˜ä¸é”™çš„ä»£ç ç¤ºä¾‹

```jsx
/**
 * èµ„äº§å›æ”¶ç«™Tableè¡¨æ ¼
 */
import React, { useState, useRef, useEffect, useCallback, useContext } from 'react';
import { Card, Button, message, Row, Col, Select, Form, Cascader, Space, Popconfirm, Alert, Input, PageHeader } from 'antd';
import { getHeader, deleteAsset, page, getTags } from '@/pages/Dashboard/services/assetDetail';
import { getNamespace } from '@/pages/discovery/Setting/services/discoveryJob';
import { PageHeaderWrapper } from '@ant-design/pro-layout';
import { getAssetModel } from '@/services/assetModel';
import ProTable from '@ant-design/pro-table';
import { PlusOutlined } from '@ant-design/icons';
import { operate } from '@/services/recycle';
import config from '@/utils/config';
import { useRequest } from 'ahooks';
import { Link, history } from 'umi';
import DrawerHH from '../Drawer';
import moment from 'moment'
const { Option, OptGroup } = Select;

/** 
 * Preset 
 */
const layout = {
  labelCol: { span: 6 },
  wrapperCol: { span: 18 },
};
let x = 200;
let InCulde = ['èµ„äº§ç¼–å·', 'èµ„äº§åç§°', 'ç½‘ç»œåŸŸ'];
const RecycleDetail = ({ location }) => {
  /** 
   * state 
   */
  const actionRef = useRef(null);
  const [size, setSize] = useState('middle');
  const [tableNames, setTableNames] = useState(location.query.tableName);
  const [columns, setColumns] = useState([]);
  const [basicProps, setBasicProps] = useState({ drawerVisible: false });
  const [namespace, setNamespace] = useState([]);
  const [tagList, setTagList] = useState([]);
  const [otheSearch, setOtheSearch] = useState({
    sorter: null,
    sortOrder: null,
    tableName: location?.query?.tableName,
    del: 1,
    state: 0,
  })

  // è·å–åç§°åˆ—è¡¨
  const { run: getNameSpaceList } = useRequest(getNamespace, {
    onSuccess: (result) => {
      if (result && result.success) {
        setNamespace(result.data);
      }
    },
  });

  // è·å–æ ‡ç­¾
  const { run: getTageList } = useRequest(getTags, {
    onSuccess: (result) => {
      if (result && result.success) {
        setTagList(result.data);
        getColumns({ tableName: location.query.tableName });
      }
    },
  });


  /** 
 * componentsConfig 
 */
  // ç”¨æˆ·è‡ªå®šä¹‰çš„æ£€ç´¢é¡¹ æ ‡ç­¾
  const TagtSearch = (_, p) => {
    return (
      <Select mode="multiple" placeholder="è¯·é€‰æ‹©æ ‡ç­¾" showArrow
        {...p}
      >
        { tagList.map((item) => (
          <OptGroup label={item.name} key={item.id}>
            {(item.tags ? item.tags : []).map((items) => (
              <Option value={items.name} key={items.id}>
                {items.name}
              </Option>
            ))}
          </OptGroup>
        ))}
      </Select>
    )
  }

  // ç½‘ç»œåŸŸ
  const NamespaceSearch = (_, p) => {
    return (
      <Select placeholder="è¯·é€‰æ‹©ç½‘ç»œåŸŸ" {...p}>
        {  namespace.map(item => (
          <Option key={item.id} value={item.name}>{item.name}</Option>
        ))}
      </Select>
    )
  }

  /**
   * 
   * renderFormItem: TimeLimit,
        formItemProps: {
          label: "é€‰æ‹©æ—¶é—´",
        }, 
   */

  /** 
   * method
   */
  /**
   * æè¿°
   * åŠ¨æ€å•Šçš„è·å–è¡¨å¤´
   * @author lishizeng
   * @date 2020-10-10
   * @param {Array} data è·å–çš„æ•°æ® 
   * @returns {any}
   */
  const dynamicSetColums = (value) => {
    let data = value.map((item) => {
      // ç›®å‰çš„æ–¹æ¡ˆæ˜¯ å…ˆå…¨éƒ¨æ’åºï¼Œç„¶åç»™å®šå‡ ä¸ªèŒƒå›´å»æ‰æ’åºï¼Œæ’åºçš„ä¿¡æ¯æ¥æºä¸€å®šæ˜¯è¡¨å¤´æ•°æ®
      let sorter = false;
      let valueType = 'text';
      if (item.propertyType === 'DATETIME') {
        valueType = 'dateTime';
        sorter = true;
      } else if (item.propertyType === 'DATE') {
        valueType = 'date';
        sorter = true;
      } else if (item.propertyType === 'TIME') {
        valueType = 'time';
        sorter = true;
      } else if (item.propertyType === 'INT') {
        sorter = true;
      }
      const basicColumns = {
        hideInSearch: !InCulde.includes(item.name),
        title: item.name,
        dataIndex: item.propertyName,
        width: 200,
        ellipsis: true,
        sorter,
        valueType,
        renderFormItem: (_, p, form) => {
          if (item.name === 'ç½‘ç»œåŸŸ') {
            return NamespaceSearch(_, p)
          }
          if (_.valueType === 'text') {
            return <Input placeholder={`è¯·è¾“å…¥${p.label}`} {...p} />;
          } else {
            return p.defaultRender(_);
          }
        },
        render: (_, record) => {
          if (record[item.propertyName]) {
            if (item.propertyType === 'DATETIME') {
              return (<Tooltip title={moment(record[item.propertyName]).format('YYYY-MM-DD HH:mm:ss')}>{moment(record[item.propertyName]).format('YYYY-MM-DD HH:mm:ss')}</Tooltip>)
            } else if (item.propertyType === 'DATE') {
              return (<Tooltip title={moment(record[item.propertyName]).format('YYYY-MM-DD')}>{moment(record[item.propertyName]).format('YYYY-MM-DD')}</Tooltip>)
            } else if (item.propertyType === 'TIME') {
              return (<Tooltip title={moment(record[item.propertyName]).format('HH:mm:ss')}>{moment(record[item.propertyName]).format('HH:mm:ss')}</Tooltip>)
            } else {
              return _
            }
          } else {
            return '-';
          }
        },
      };
      // x += 200;
      return basicColumns;
    });

    data.push({
      title: 'æ ‡ç­¾',
      dataIndex: 'tag',
      width: 200,
      renderFormItem: (_, p, form) => {
        return TagtSearch(_, p)
      }
    })

    data.push({
      title: 'æ“ä½œ',
      dataIndex: 'id',
      width: 200,
      hidden: false,
      default: true,
      sorter: false,
      valueType: 'option',
      fixed: 'right',
      render: (text, obj) => {
        return [
          <a
            key="1"
            style={{ marginRight: 5 }}
            onClick={() =>
              openDetail({
                id: obj._id,
                tableName: tableNames,
                ciTypeId: obj.ciTypeId,
                name: obj.name,
              })
            }
          >
            è¯¦æƒ…
          </a>,
          <a key="2" >
            <Popconfirm
              title="æ‚¨ç¡®è®¤è¦æ¢å¤å—?"
              onConfirm={() => operateRun({ id: obj._id, ciTypeId: obj.ciTypeId, type: '0' })}
              okText="æ˜¯"
              cancelText="å¦"
            >
              æ¢å¤
            </Popconfirm>
          </a>,
          <a key="3" >
            <Popconfirm
              title="æ‚¨ç¡®è®¤è¦æ¸…ç©ºå—?"
              onConfirm={() => operateRun({ id: obj._id, ciTypeId: obj.ciTypeId, type: '1' })}
              okText="æ˜¯"
              cancelText="å¦"
            >
              æ¸…ç©º
            </Popconfirm>
          </a>,
        ];
      },
    });
    setColumns(data);
  }

  // è·å–åŠ¨æ€è¡¨å¤´
  const { run: getColumns, loading } = useRequest(getHeader, {
    manual: true,
    onSuccess: (result) => {
      if (result && result.success) {
        dynamicSetColums(result.data)
      } else {
        message.error(result.message || 'ç½‘ç»œè¯·æ±‚é”™è¯¯', 5);
      }
    },
  });

  // æ‰“å¼€è¯¦æƒ…
  const { run: operateRun } = useRequest(operate, {
    manual: true,
    onSuccess: (result) => {
      if (result && result.success) {
        message.success(result.codeMessage);
        actionRef.current.reload();
      }
    },
  });

  // è¡¨æ ¼çš„æ•°æ®åŠ è½½æ–¹æ³•
  const loadData = async (params) => {
    const response = await page(params);
    return {
      success: response.success,
      ...response.data.list
    };
  };

  const onTableChange = (p, f, s) => {
    setOtheSearch((oldData) => {
      return {
        ...oldData,
        ...{
          sorter: s.field || '',
          sortOrder: s.order || ''
        }
      }
    })
  };

  const drawerProps = {
    ...basicProps,
    onClose: () => {
      setBasicProps({
        drawerVisible: false,
        id: undefined,
        tableName: undefined,
      });
    },
  };

  const openDetail = (data) => {
    setBasicProps({
      ...data,
      drawerVisible: true,
    });
  };


  /** 
   * effct 
   */
  useEffect(() => {
    if (location.query.tableName) {
      setOtheSearch((oldData) => {
        return { ...oldData, ...{ tableName: location.query.tableName } }
      })
      getNameSpaceList();
      getTageList();
    }
  }, [location.query.tableName]);


  /** 
   * render
   */
  return (
    <PageHeaderWrapper
      onBack={() => history.push({ pathname: '/recycle' })}
      title='èµ„äº§å›æ”¶ç«™'
    >
      <Card loading={loading}>
        <ProTable
          search={{
            labelWidth: 0,
            optionRender: (a, b) => {
              return [<Button key='id' type='primary' onClick={() => b.form.submit()} > æŸ¥è¯¢ </Button>, <Button key='id' onClick={() => {
                b.form.resetFields(); b.form.submit();
                // setUseList({
                //   userIdList: ''
                // })
              }}> é‡ç½® </Button>]
            }
          }}
          beforeSearchSubmit={(T) => {
            if (T.tag && T.tag.length > 0) {
              T.tag = T.tag.join(',')
            }
            return T
          }}
          onReset={() => {
            setOtheSearch(
              (oldData) => {
                oldData.namespace = ''
                oldData.tags = ''
                return oldData
              }
            )
          }}
          size={size}
          onSizeChange={(size) => {
            setSize(size);
          }}
          columns={columns}
          actionRef={actionRef}
          request={(params) => loadData(params)}
          params={{
            ...otheSearch
          }}
          rowKey="_id"
          onChange={(p, f, s) => onTableChange(p, f, s)}
          pagination={config.paginationDisplay}
          scroll={{ x: x, y: 450 }}
        />
      </Card>
      <DrawerHH {...drawerProps} />
    </PageHeaderWrapper>
  )
}

export default RecycleDetail
```



### 5. ä¸è¦åœ¨requestè¯·æ±‚æ–‡ä»¶ä¸­ï¼Œæè¿™äº›èŠ±é‡Œèƒ¡å“¨çš„ä¸œè¥¿


åé¢æ•™æ

```jsx
import http from '@/utils/request'
import qs from 'qs'
import moment from 'moment'
// æ¨¡æ‹Ÿæ¥å£
const getInsepectionStatic = async () => {
  return http.get('/api/itcc-ops-provider/taskRecord/statisticalPresetType')
}

const queryInsepectionTable = async (value) => {
  let parms = {
    name: value.name && value.name || '',
    userIdList: value.userIdList ? value.userIdList : '',
    startTimeStr: value.startTimeStr || '',
    endTimeStr: value.endTimeStr || '',
    sorter: value.sorter,
    sortOrder: value.sortOrder,
    current: value.current,
    pageSize: value.pageSize
  }
  return http.get(`/api/itcc-ops-provider/task/page?${qs.stringify(parms)}`)
}

// ---------------------------åˆ†å‰²çº¿
// è·å–è§’è‰²ä¸‹é¢çš„æ‰€æœ‰ç”¨æˆ·ï¼ˆæŒ‰åç§°å‡åºï¼‰
const getDefaultUser = async (parmas) => {
  return http.get(`/api/tcms-auth-provider/user/getByRoleId?roleId=${parmas}`)
}

// é¢„è®¾ç±»å‹ ï¼ˆç¯å¢ƒ ï¼‰ä¸‹æ‹‰æ¡†
const getDefaultCheckType = async () => {
  // return http.get('/api/itcc-ops-provider/serverVersions/list')
  return http.get('/api/itcc-ops-provider/procedureLayout/support/environment')
}

// æ£€æŸ¥é¡¹é¢„è®¾å¯¹åº”è‡ªå·±å®šä¹‰çš„å°±æ˜¯VMWARE
const getDefaultCheckItem = async (value) => {
  return http.get(`/api/itcc-ops-provider/adviceConfig/tree/${value || 1}`)
}

// æ–°å¢å·¡æ£€ä»»åŠ¡&ç¼–è¾‘
const createCheckTaks = async (value) => {
  return http.post(`/api/itcc-ops-provider/task/saveOrUpdate`, { data: value })
}



// è·å–å¥åº·è¯„ä¼°åˆ†ç±»åˆ—è¡¨(é»˜è®¤é¡µ)
const getScanResultList = (parmas) => {
  return http.get(`/api/itcc-ops-provider/scanResult/getScanResultList?${qs.stringify(parmas)}`)
}

// å¥åº·è¯„ä¼°è¡¨æ ¼åˆ†é¡µåˆ—è¡¨
const getScanResultListForTable = (parmas) => {

  function toLowerLine (str) {
    var temp = str.replace(/[A-Z]/g, function (match) {
      return "_" + match.toLowerCase();
    });
    if (temp.slice(0, 1) === '_') { //å¦‚æœé¦–å­—æ¯æ˜¯å¤§å†™ï¼Œæ‰§è¡Œreplaceæ—¶ä¼šå¤šä¸€ä¸ª_ï¼Œè¿™é‡Œéœ€è¦å»æ‰
      temp = temp.slice(1);
    }
    return temp;
  }
  parmas.module = !parmas.module ? null : parmas.module
  let finallyDate = Object.assign(
    {
      taskId: null,
      performCount: null,
      name: parmas.name || null,
      priority: null,
      module: null,
      serviceVersionId: null,
      type: null,
      sorter: null,
      sortOrder: null,
      current: null,
      pageSize: null,
    }, parmas)
  finallyDate.sorter = toLowerLine(finallyDate.sorter)

  return http.get(`/api/itcc-ops-provider/scanResult/page?${qs.stringify(finallyDate)}`)
}

// å¯¼å‡º
const getScanResultListTabledDownload = (parmas) => {
  let finallyDate = Object.assign(
    {
      taskId: null,
      performCount: null,
      name: parmas.refName || null,
      priority: null,
      module: null,
      serviceVersionId: null,
      type: null,
      sorter: null,
      sortOrder: null,
    }, parmas)
  return http.get(`/api/itcc-ops-provider/scanResult/download/list?${qs.stringify(finallyDate)}`)
}


```

æ­£ç¡®çš„åšæ³•

```jsx
/*** æŸç½‘ç»œåŸŸä¸‹çš„ç½‘ç»œåˆ—è¡¨ */
// è·å–ipåŸŸä¸‹çš„ç½‘ç»œåˆ—è¡¨
const getIPall = async (params: any) => {
  return request.get(`/api/itcc-cmdb-provider/network/page?${qs.stringify(params)}`)
}
// åˆ›å»ºå’Œç¼–è¾‘
const createEdite = async (params: any) => {
  return request.post('/api/itcc-cmdb-provider/network/saveOrUpdate', { data: params })
}
// åˆ é™¤
const deleteIp = async (params: any) => {
  return request.delete(`/api/itcc-cmdb-provider/network/delete?id=${params}`)
}
// ç½‘æ®µç®¡ç†
const createShortMange = async (params: any) => {
  return request.post(`/api/itcc-cmdb-provider/network/ipManagement`, { data: params })
}


/** ç½‘ç»œæ®µæ˜ å°„çš„ç®¡ç† */
// æ ¹æ®idè·å–ç½‘ç»œæ®µ
const initNetwordShort = async (params: any) => {
  return request.get(`/api/itcc-cmdb-provider/network/get?id=${params}`)
}
// ä¿ç•™OCCUPY ä½¿ç”¨USE é‡Šæ”¾FREE
const createNetworkRelation = async (params: any) => {
  return request.post(`/api/itcc-cmdb-provider/ip/releaseOrRetain`, { data: params })
}


/**
 * ç½‘ç»œå…³è”é€‰æ‹©
 */
// è·å–é»˜è®¤çš„å¯é€‰ä¸­å™¨
const defaultNetwork = async () => {
  return request.get('/api/itcc-cmdb-provider/network/associatedNetWork')
}
// åˆ›å»ºå…³è”å…³ç³»
const buildNetworkRelations = async (params: any) => {
  console.log('create====>', params);
  return request.post('/api/itcc-cmdb-provider/poolVswitch/saveOrUpdate', { data: params })
}
// é€‰ä¸­ç½‘ç»œçš„å…³è”å…³ç³»
const getNetworkRelations = async (params: any) => {
  return request.get(`/api/itcc-cmdb-provider/network/selectPool?id=${params}`)
}


export {
  defaultNetwork, buildNetworkRelations, getNetworkRelations,
  initNetwordShort, createNetworkRelation,
  getIPall, createEdite, deleteIp, createShortMange,
  getList, del, save, page,
  networkSave, networkDel, validation,
}

```



### 6. å˜é‡åæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œè¯¦è§ï¼ˆè°·æ­Œå…¬å¸æ–‡æ¡£è§„èŒƒï¼š[https://google.github.io/styleguide/jsguide.html](https://google.github.io/styleguide/jsguide.html)ï¼‰
1. åŸåˆ™å°±æ˜¯ è§åçŸ¥æ„ï¼Œé•¿ç‚¹æ²¡å…³ç³»

### 7. ç¼©è¿›ç»Ÿä¸€ä½¿ç”¨ä¸¤ä¸ªtable


### 8.æœ‰å…³äºåˆ°åº•æ˜¯ä¸æ˜¯åé¢åŠ ä¸Šåˆ†å· ï¼›
> jsä¸­æ²¡æœ‰å¼ºåˆ¶ä½¿ç”¨ ï¼›è¦æ±‚ï¼Œåœ¨ç°ä»£çš„çš„æ¡†æ¶ä¸­ï¼ŒåŒ…æ‹¬å‰ç«¯ä¸‰é©¾é©¬è½¦ï¼Œéƒ½ä¼šç»è¿‡bableè½¬ä¹‰è‡ªå·±å†™çš„jsä»£ç ã€‚å› æ­¤æˆ‘è®¤ä¸ºä»è¿™ä¸€ç‚¹å‡ºå‘ ï¼›å·æ˜¯éå¿…è¦çš„
>
> åœ¨å¾ˆå¤šä¼˜ç§€çš„åº“ä¸­ï¼Œï¼›å·ä¹Ÿæ˜¯æ²¡æœ‰å¼ºåˆ¶è¦æ±‚çš„
>
> ![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1604196966434-40c3376a-2915-4427-a408-9686f6e669ea.png)
>
> ä¸‹é¢çš„è¿™æ®µä»£ç åˆ†åˆ«æ¥è‡ªæ¡†æ¶å†…éƒ¨æºä»£ç 
>
> ![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1604197138186-822db236-1de1-47be-8d23-5318fda15015.png)
>
> ![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1604197213901-5cd6a9f4-ffa9-4c32-843d-1c905c3bb9b6.png)
>

æ€»ç»“ï¼šæˆ‘è®¤ä¸ºåœ¨è¿™ä»¶äº‹æƒ…çš„æ¢è®¨è¿‡åº¦ï¼Œæ— ç–‘æ˜¯æµªè´¹æ—¶é—´çš„ä¸œè¥¿!!,

## äºŒã€ä»£ç æ„å»ºæ¨¡å¼ä¸Šçš„è¯´æ˜
#### 1.IDEçš„å¿«æ·é”®çš„å­¦ä¹ 
- [x] IDEçš„å¿«æ·é”®çš„å­¦ä¹ 
    - [x] æ‰“å¼€ç»ˆç«¯Â (Â ctrlÂ Â +Â `Â Â Â )Â Â Â Â Â Â Â Â Â ç»ˆç«¯æ–°å¼€(Â Â ctrlÂ +Â shiftÂ Â +Â 5Â Â )ï¼ŒÂ ç»ˆç«¯å†…éƒ¨åˆ‡æ¢(Â Â altÂ +Â ä¸Šä¸‹å·¦å³Â )Â ï¼ŒÂ åˆ‡æ¢ç»ˆç«¯ç»„ï¼ˆï¼‰
    - [x] æŒ‡å®šå·¥ä½œç›®å½•Â æ–°å»ºç»ˆç«¯Â ï¼ˆÂ ctrlÂ +Â shiftÂ +Â `Â Â ï¼‰
    - [x] åˆ†å±å’Œåˆ‡æ¢å±:Â æ–°å¼€ä¸€ä¸ªåˆ†å±ï¼ˆÂ ctrlÂ +Â \Â ï¼‰ï¼Œåˆ‡æ¢åˆ†å±ï¼ˆÂ ctrlÂ +Â upÂ æˆ–è€…Â downÂ ï¼‰ï¼Œå…³é—­æŸä¸€ä¸ªåˆ†å±Â ï¼ˆÂ ctrlÂ +Â wÂ ï¼‰Â Â ï¼Œå±å†…ç»„åˆ‡æ¢(Â Â ctrlÂ +Â kÂ Â ä¹‹åÂ ctrlÂ +Â upæˆ–è€…downÂ )
    - [x] æ‰“å¼€æŒ‡å®šæ–‡ä»¶(Â ctrlÂ +Â shiftÂ +Â pÂ )ï¼Œåˆ‡æ¢åˆ°å·¥ä½œæ ‘
    - [x] æµè§ˆçš„æ“ä½œã€‚ä¾ç„¶è¿˜æ˜¯éœ€è¦é¼ æ ‡çš„



#### 2.æœ‰å…³äºæ‰“åŒ…çš„é—®é¢˜
- [x] æœ‰å…³äºæ‰“åŒ…çš„é—®é¢˜
    - [x] æ‰“åŒ…æ›´æ–°ä¸‹åˆçš„æ—¶å€™ä¸€æ¬¡ï¼Œæ™šä¸Šçš„æ—¶å€™ä¸€æ¬¡
    - [x] ä»»åŠ¡ç‚¹å‡»çš„æ—¶å€™ä¹Ÿæ˜¯ï¼Œä¸­åˆä¸€æ¬¡ï¼Œæ™šä¸Šä¸€æ¬¡ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½é€šçŸ¥å“ªäº›å·²ç»ç¡®è®¤äººå»ç¡®è®¤ï¼Œæ³¨æ„å•Šã€‚ä½ ç¡®è®¤è¿‡çš„ä»»åŠ¡ä¸€å®šæ˜¯å…ˆå‘åŒ…å†ç‚¹å‡»å®Œæˆï¼



#### <font style="color:#F5222D;">3.Modalå’Œdrawæ„å»ºæ–¹å¼ï¼ˆå„ç§å¼¹å‡ºå±‚çš„å¤„ç†ï¼‰</font>
    - [x] ç”±äºmodalå’Œdrawè¿™ä¸¤ä¸ªä¸œè¥¿å’Œå½“å‰çš„é¡µé¢ç»„ä»¶çš„é€šä¿¡å’Œä¾èµ–æ¯”è¾ƒçš„ä¸¥é‡ï¼Œä¸å¥½ä¹Ÿä¸æ˜¯å¾ˆé€‚åˆè§£è€¦å‡ºå»ï¼Œå› æ­¤ï¼Œç°è¡Œæˆ‘è®¤ä¸ºæ¯”è¾ƒå¥½çš„æ„å»ºæ–¹å¼å¦‚ä¸‹
    - [x] æ ¸å¿ƒä»£ç 

```jsx
const props = {
    visible,
    loading,
    obj,
    onCancel: () => {
      setVisible(false);
      setObj(false);
    },
    onSubmit: (values: any) => {
      saveData(values);
    },
  };
```



```jsx
// NetworkDomain ç½‘ç»œè§„åˆ’
import React, { useState, useRef } from 'react'
import { useRequest } from 'ahooks';
import ProTable, { ActionType, ProColumns } from '@ant-design/pro-table';
import { PageHeaderWrapper } from '@ant-design/pro-layout';
import config from '@/utils/config';
import { Button, Space, message, Popconfirm, Card, } from 'antd';
import { page, networkSave, networkDel } from './service';
import AddModal from './AddModal';
import { SizeType } from 'antd/lib/config-provider/SizeContext';
import { Link } from 'umi';

/** 
 * Preset 
 */


const NetworkDomain: React.FC<any> = () => {
  /** 
   * state 
   */
  const actionRef = useRef<ActionType>();

  const [size, setSize] = useState<SizeType>('middle');
  const [sorter, setSorter] = useState<any>('');
  const [sortOrder, setSortOrder] = useState<any>('');
  const [visible, setVisible] = useState<boolean>(false);
  const [obj, setObj] = useState<boolean>(false);

  /** 
   * method
   */
  const onTableChange = (p: any, f: any, s: any) => {
    setSorter(s.field || '');
    setSortOrder(s.order || '');
  };


  const { run: delData } = useRequest(networkDel, {
    manual: true,
    onSuccess: (result) => {
      if (result.success) {
        actionRef.current?.reset()
        actionRef.current?.reload()
      }
    },
  });

  const { run: saveData, loading } = useRequest(networkSave, {
    manual: true,
    onSuccess: (result, params) => {
      actionRef?.current?.reload();
      if (result.success) {
        result.data && message.success(result.codeMessage);
        setVisible(false);
        setObj(false);
      }
    },
  });

  const loadData = async (params: any) => {
    const response = await page(params);
    return {
      success: response.success,
      ...response.data,
    };
  };

  const handleEdit = (obj: any) => {
    setObj(obj);
    setVisible(true);
  };
  const handleDel = (id: any) => {
    delData(id);
  };
  const props = {
    visible,
    loading,
    obj,
    onCancel: () => {
      setVisible(false);
      setObj(false);
    },
    onSubmit: (values: any) => {
      saveData(values);
    },
  };

  /** 
   * effct 
   */


  /** 
   * componentsConfig 
   */
  const header = (
    <Space>
      <Button
        size={size}
        type="primary"
        onClick={() => {
          setVisible(true);
        }}
      >
        æ–°å¢
      </Button>
    </Space>
  );

  const columns: ProColumns<any>[] = [
    {
      title: 'åç§°',
      key: 'name',
      dataIndex: 'name',
      render: (_, dom) => {
        return <Link
          to={{
            pathname: '/networkDomain/networkShort',
            state: {
              areaId: dom.id,
              name: dom.name,
              description: dom.description
            },
          }}
        >{_}</Link>
      }
    },
    {
      title: 'æè¿°',
      dataIndex: 'description',
      ellipsis: true,
    },
    {
      title: 'æ“ä½œ',
      valueType: 'option',
      dataIndex: 'id',
      width: 200,
      fixed: 'right',
      render: (text: any, record: any) => (
        <>
          <Space>
            {/* <Tag color={config.editColor}> */}
            <a onClick={() => handleEdit(record)}>ç¼–è¾‘</a>
            {/* </Tag> */}
            {/* <Tag color={config.deleteColor}> */}
            <a>
              <Popconfirm
                title="æ‚¨ç¡®è®¤è¦åˆ é™¤è¯¥å…¨å±€å±æ€§ä¹ˆ?"
                onConfirm={() => handleDel(record.id)}
                okText="æ˜¯"
                cancelText="å¦"
              >
                åˆ é™¤
                </Popconfirm>
            </a>
            {/* </Tag> */}
          </Space>
        </>
      ),
    },
  ];


  /** 
   * render
   */
  return (
    <PageHeaderWrapper title="ç½‘ç»œåŸŸè§„åˆ’">
      <Card >
        <div style={{ minHeight: 650 }}>
          <ProTable
            actionRef={actionRef}
            columns={columns}
            request={(params) => loadData(params)}
            params={{ sorter, sortOrder }}
            size={size}
            rowKey="id"
            headerTitle={header}
            // rowSelection={{}}
            search={false}
            tableAlertRender={() => false}
            onSizeChange={(size) => setSize(size)}
            onChange={(p, f, s) => onTableChange(p, f, s)}
            pagination={config.paginationDisplay}
            scroll={{ x: 1250, y: 450 }}
            toolBarRender={(action, { selectedRows }) => []}
          />
          <AddModal {...props} />
        </div>
      </Card>
    </PageHeaderWrapper>
  )
}

export default NetworkDomain




// AddModal ç½‘ç»œåŸŸæ–°å¢ç¼–è¾‘çš„å¼¹å‡ºå±‚
import React, { useState, useRef, useEffect, useCallback, useContext } from 'react'
import config from '@/utils/config';
import { Form, Input, Modal } from 'antd';
import { validation } from './service'

/** 
 * Preset 
 */
const { TextArea } = Input;


const AddModal: React.FC<any> = ({ obj = {}, visible, onCancel, onSubmit, loading }) => {
  /** 
   * state 
   */
  const [form] = Form.useForm();


  /** 
   * method
   */
  const onOk = () => {
    form
      .validateFields()
      .then((values) => {
        const data = { ...values }
        if (obj.id) {
          data.id = obj.id
        }
        onSubmit({ ...data });
      })
      .catch((info) => {
        console.log('Validate Failed:', info);
      });
  };

  const close = () => {
    clear();
    onCancel();
  };

  const clear = () => {
    form.resetFields();
  };

  const validationName = (rule, value, callback) => {
    try {
      let data = {}
      if (obj && obj.id) {
        data.id = obj.id
      }
      data.name = value
      validation(data).then((res) => {
        if (res && res.data && res.success) {
          callback();
        } else {
          callback('ç½‘ç»œåŸŸå·²å­˜åœ¨');
        }
      })
      data = null
    } catch (err) {
      callback(err);
    }
  }


  /** 
   * effct 
   */
  useEffect(() => {
    if (visible) {
      form.setFieldsValue({
        ...obj,
      });
    }
  }, [visible]);


  /** 
   * componentsConfig 
   */


  /** 
   * render
   */
  return (
    <>
      <Modal
        visible={visible}
        title={`${obj.id ? 'ç¼–è¾‘ç½‘ç»œåŸŸ' : 'æ–°å¢ç½‘ç»œåŸŸ'}`}
        onCancel={() => close()}
        confirmLoading={loading}
        afterClose={() => clear()}
        width={700}
        okText="æäº¤"
        cancelText="å–æ¶ˆ"
        onOk={() => onOk()}
      >
        <Form form={form} layout="horizontal" name="networkForm">
          <Form.Item
            {...config.modalFormItemLayout}
            label="ç½‘ç»œåŸŸ"
            name="name"
            rules={[
              {
                required: true,
                message: 'è¯·è¾“å…¥ç½‘ç»œåŸŸåç§°',
              },
              { validator: validationName },
            ]}
          >
            <Input placeholder="è¯·è¾“å…¥ç½‘ç»œåŸŸåç§°" />
          </Form.Item>

          <Form.Item
            label="æè¿°"
            {...config.modalFormItemLayout}
            name="description">
            <TextArea />
          </Form.Item>

        </Form>
      </Modal>
    </>
  )
}

export default AddModal
```

#### 4. æ–‡ä»¶å¤¹å±‚æ¬¡çš„æ„å»ºæ–¹æ¡ˆå’Œå‘½åæ–¹æ¡ˆ
ä¸ªäººæ¨èçš„åšæ³•

pageä¸‹ä»…ä»…æ˜¯æ”¾é¡µé¢ç”¨æ¥ç»„è£…ç»„ä»¶ï¼Œè€Œä¸åº”è¯¥å­˜æ”¾å„ç§å„æ ·çš„ç»„ä»¶çš„å…·ä½“å®ç°ï¼Œcomponenté‡Œäº†è§£ä¸€ä¸‹ï¼Œcomponenté‡Œæ‰æ˜¯æ”¾ç½®å…·ä½“ç»„ä»¶çš„æ‰€åœ¨ä½ç½®

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1604545369288-9209e185-494c-4ac8-8538-ec50fe2121fa.png)





#### 5.å¦‚ä½•åªtablä¸­æ„å»ºä¸€äº›ç‹¬ç«‹ä¸”åˆå„è‡ªæœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Ÿ
> æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œä½ å¦‚ä½•å®Œæˆå¦‚ä¸‹çš„æ•ˆæœ
>



å¾ˆæ˜æ˜¾ï¼Œè¦æƒ³å®ç°è¿™æ ·çš„æ•ˆæœä½ å¿…é¡»è®©æ²¡ä¸€ä¸ªrowæ•°æ®éƒ½æå®šç‹¬ç«‹çš„åŠ è½½ä¸€ä¸ªç»„ä»¶å‡ºæ¥,è¿™ä¸ªæ—¶å€™ï¼Œæ€§èƒ½å’Œæ•ˆæœå°±è¦åšå–èˆäº†



