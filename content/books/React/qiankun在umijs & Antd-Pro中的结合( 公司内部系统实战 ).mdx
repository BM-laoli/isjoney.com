---
title: "å¾®å‰ç«¯é›†æˆï¼šqiankunjs åœ¨ React Antd-Pro é¡¹ç›®ä¸­çš„å®è·µ"
date: "2024-12-19"
summary: "è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ React Antd-Pro é¡¹ç›®ä¸­é›†æˆé˜¿é‡Œ qiankunjs å¾®å‰ç«¯æ¡†æ¶ï¼Œå®ç°å•é¡µåº”ç”¨å¼åˆ‡æ¢ã€token éªŒè¯ã€å¤´éƒ¨ä¿ç•™ç­‰åŠŸèƒ½ï¼ŒåŒ…å«å­åº”ç”¨é…ç½®å’Œå¾®ç»„ä»¶åŠ è½½æ–¹æ¡ˆã€‚"
status: "completed"
tech: ["React", "qiankun", "Antd-Pro", "å¾®å‰ç«¯"]
github: "https://github.com/BM-laoli"
arxiv: ""
keyId: "React"
---

> æ–‡æ¡£è¯´æ˜
>



# æ˜ç¡®ç›®æ ‡å’Œæ•ˆæœ
 Â  Â Â æˆ‘ä»¬éœ€è¦æŠŠå¾®å‰ç«¯å·¥å…·-æ¥è‡ªé˜¿é‡Œå®¶çš„qiankunjs é›†æˆåˆ°æˆ‘ä»¬çš„react Antd-Proé¡¹ç›®ä¸­å»ï¼Œå¹¶ä¸”å®ç°è¿™æ ·çš„æ•ˆæœ

**<font style="color:#F5222D;"></font>**

![](https://cdn.nlark.com/yuque/0/2021/gif/1627571/1615793041549-bcbae99e-b699-4053-90bb-95348987b5d5.gif)

**<font style="color:#F5222D;"></font>**

**<font style="color:#F5222D;">åŠŸèƒ½ç‚¹æç‚¼å¦‚ä¸‹</font>**

- [x] åœ¨ä¸šåŠ¡ä¸­å°ä¸­è¿›è¡Œ å•é¡µåº”ç”¨å¼ çš„åˆ‡æ¢åˆ°ä¸åŒçš„å¹³å°ï¼Œè€Œä¸”è¦ä¿è¯tokençš„éªŒè¯æ˜¯æœ‰æ•ˆçš„
- [x] åˆ‡æ¢çš„æ—¶å€™é¡µé¢ä¸Šéƒ¨åˆ†çš„ä¸­å°å¤´éƒ¨éœ€è¦ä¿ç•™ï¼Œä¸‹é¢çš„å†…å®¹è·Ÿç€å­åº”ç”¨èµ°

# å¼€å§‹å»åš
## é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸ªæ¯ä¸€ä¸ªçš„å­åº”ç”¨éƒ½ä¸‹è½½qiankunjs
 Â  Â Â ç”±äºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨Antd-Proï¼Œè¿™ä¸ªè„šæ‰‹æ¶æ˜¯åŸºäºumijsæ„å»ºçš„ï¼Œæ‰€ä»¥åªéœ€è¦ä¸‹è½½umijsä¸­çš„qiankun-pluginå°±å¥½äº†ï¼Œå¯ä»¥åšåˆ°é›¶é…ç½®ï¼Œé©¬ä¸Šè¿è¡Œ

```shell
yarn add @umijs/plugin-qiankun -D
```

## ç„¶åæˆ‘ä»¬éœ€è¦å…ˆåˆ°ä¸­å°è¿›è¡Œé…ç½®
qiankunjsåœ¨umijsä¸­æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯è·¯ç”±å¼é…ç½®å¼ï¼ŒäºŒæ˜¯ç»„ä»¶å¼ï¼Œæˆ‘ä»¬å®ç°ä¸Šé¢çš„åŠŸèƒ½å’Œæ•ˆæœï¼Œæˆ‘ä»¬ä½¿ç”¨é…ç½®å¼è·¯ç”±å°±å¥½äº†



Config/config.tsä¸­

```javascript
...
{
      path: '/tcms-auth-provider',  // è·¯ç”±åŒ¹é…åˆ°ä¹‹åå°±ä¼šå»åŠ è½½å¯¹åº”çš„å­åº”ç”¨
      microApp: 'tcms-auth-provider',  // å­åº”ç”¨çš„åç§°
    },
    {
      path: '/itcc-monitor-provider',
      microApp: 'itcc-monitor-provider',
    },
    {
      path: '/itcc-ops-provider',
      microApp: 'itcc-ops-provider',
    },
    {
      path: '/itcc-cmp-provider',
      microApp: 'itcc-cmp-provider',
    },
    {
      path: '/itcc-ai-provider',
      microApp: 'itcc-ai-provider',
    },
    {
      path: '/itcc-topo-provider',
      microApp: 'itcc-topo-provider',
    },
    {
```



ä¸Šé¢çš„æ˜¯é…ç½®æ‰“å¼€æ–¹å¼ï¼Œä¸‹é¢å°±æ˜¯å»æ³¨å†Œ,åœ¨appjsä¸‹å°±èƒ½è¿›è¡Œæ³¨å†Œï¼Œå¦‚æœä½ ä¸çŸ¥é“app.jså¹²ä»€ä¹ˆçš„ï¼Œè¯·å»é˜…è¯»umijsæ–‡æ¡£ï¼Œapp.jsæ˜¯è¿è¡Œæ—¶é…ç½®ï¼ˆä¼šç¨å¾®å½±å“æ€§èƒ½ï¼‰ï¼Œæˆ‘ä»¬çš„å¾®åº”ç”¨çš„åœ°å€å’Œnameéƒ½æ˜¯ç”±åç«¯ä¼ å…¥çš„ï¼

/src/app.js

```javascript
// å¯¼å‡ºqiankunè¿™ä¸ªå‡½æ•°ï¼Œumijså°±å¯ä»¥è‡ªåŠ¨å»è¿›è¡Œé…ç½®
export const qiankun = (props) => {
  // ç›‘å¬ åŠ è½½å®Œæ¯•ä¹‹åå–æ¶ˆloading
  return queryCurrent().then(res => {
    if (res && res.success) {
      const apps = res.data.menus.map(menu => ({
        name: menu.serviceId,
        entry: menu.href,
        to: menu.serviceId,
      }))
      // è¯·å‚é˜…umijs-qiankun-plugin
      return {
        apps,
        lifeCycles: {

          beforeLoad: (a, b, c) => {
            // console.log('å­åº”ç”¨åŠ è½½ä¹‹å‰', a, b, c);
          },
          beforeMount: (a, b, c) => {
            // console.log('å­åº”ç”¨åŠ è½½å®Œæˆï¼', a, b, c);
          },
          afterMount: (a, b, c) => {
            // console.log('å­åº”ç”¨åŠ è½½ä¹‹å', a, b, c);
          },
          beforeUnmount: (a, b, c) => {
            // console.log('å­åº”ç”¨é”€æ¯ä¹‹å‰ï¼', a, b, c);
          },
          afterUnmount: (a, b, c) => {
            // console.log('å­åº”ç”¨é”€æ¯ä¹‹åï¼', a, b, c);
          }

        }
      }
    }
    return { apps: [] }
  });
}
....
```

## å†å»å­åº”ç”¨è¿›è¡Œé…ç½®
  Â  Â Â Â  å¯¹äºqiankun + umijs æ¥è¯´å­åº”ç”¨çš„é…ç½®éå¸¸éå¸¸çš„ç®€å•

/config/config.ts

```typescript
// https://umijs.org/config/
import { defineConfig } from 'umi';
import defaultSettings from './defaultSettings';

export default defineConfig({
  hash: true,
  antd: {},
  dva: {
    hmr: true,
  },
  qiankun: {
    slave: {},  // é…ç½®å¥½è¿™ä¸ªå°±å¥½äº†
  },
 ....
```



## å»æ‰å­åº”ç”¨çš„å¤´éƒ¨å’ŒLOGO
   ç°åœ¨æˆ‘ä»¬éœ€è¦å»æ‰æˆ‘ä»¬çš„LOGOå’Œå­åº”ç”¨è‡ªå¸¦çš„å¤´éƒ¨ï¼Œè¦ä¸ç„¶ï¼Œå­åº”ç”¨ä¼šæŠŠä¸»åº”ç”¨è¦†ç›–æ‰, åœ¨å­åº”ç”¨ä¸­ï¼Œä¿®æ”¹æ ·å¼å’Œumijsçš„é»˜è®¤layout-pluaginè‡ªåŠ¨ç”Ÿæˆçš„å¸ƒå±€ç»“æ„ å°±å¥½äº†

/src/global.less

```javascript
...
.ant-layout-sider {
  position:fixed!important;
  margin-top: 48px!important;
}

.ant-pro-sider-logo {
  display: none!important;
}

```

    /config/config.ts

```typescript
import { Settings as LayoutSettings } from '@ant-design/pro-layout';

export default {
  navTheme: 'light',
  // æ‹‚æ™“è“
  primaryColor: '#1890ff',
  layout: 'sild',   // ä½¿ç”¨sildå¸ƒå±€
  contentWidth: 'Fluid',
  fixedHeader: false,
  fixSiderbar: true,
  colorWeak: false,
   headerHeight: 0,  // è®¾ç½®å¤´éƒ¨é«˜åº¦,å»é™¤æ‰å­åº”ç”¨è‡ªå·±çš„å¤´éƒ¨å°±å¥½äº†
  menu: {
    locale: false,
  },
  title: 'è¿ç»´ä¸­å¿ƒ',
```



## å¦‚æœéœ€è¦å¼•å…¥å­åº”ç”¨çš„æŸä¸€ä¸ªç»„ä»¶æ€ä¹ˆåŠï¼Ÿ
### 1,.å­åº”ç”¨æš´éœ²å‡ºå»
å¦‚æœä½ éœ€è¦å¼•å…¥å­åº”ç”¨çš„æŸä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™æ ·çš„æ–¹å¼,  åœ¨å­åº”ç”¨ä¸­å†™ä¸€ä¸ªè·¯ç”±ï¼Œå¹¶ä¸”åŒ¹é…åˆ°ä½ è‡ªå·±çš„éœ€è¦æš´éœ²å‡ºå»çš„å­åº”ç”¨ä¸­çš„æŸä¸€ä¸ªç»„ä»¶,

æ¯”å¦‚æˆ‘éœ€è¦æš´éœ²ä¸€ä¸ªmonitorä¸­å¾—å›¾è¡¨

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1615794351371-73b3fd6b-e024-46e0-86e5-6565ee304468.png)

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè·¯ç”±ç‹¬ç«‹çš„å»åŒ¹é…åˆ°å®ƒ

config/config.ts

```javascript
+++   
{
      path: '/MicorComponent',
      name: 'ä»»åŠ¡ç®¡ç†',
      layout:false,
      component: './event/Statistics/components/Trend',
    },
+++
```

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1615794604999-8af0ae15-5e3b-4e6b-8813-ff5b331b2d2a.png)

### 2.ä¸»è¦æœ‰é€šè¿‡qiankunçš„å¾®ç»„ä»¶åŠ è½½åˆ°å®ƒ
```javascript
import { MicroAppWithMemoHistory } from 'umi';

export function MyPage() {

  return (
    <div>
      <div>
 <MicroAppWithMemoHistory 
    		name="app2" // ä½ çš„å¾®åº”ç”¨çš„name
    url="/MicorComponent" />  // ä½ çš„å¾®åº”ç”¨ä¸­çš„ç»„ä»¶è·¯ç”±åœ°å€
      </div>
    </div>
  )
}
```

## å¦‚æœå­åº”ç”¨éœ€è¦ç‹¬ç«‹å‘å¸ƒæ€ä¹ˆåŠï¼Ÿ
**ç›®å‰çš„æ–¹æ¡ˆæ˜¯æŠŠåŸæ¥é‡Œé¢çš„å‡ è¡Œç¡¬ç¼–ç å»æ‰å°±å¥½äº†****ğŸ˜¥**

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1615794973093-0bd6f6e5-3694-4db9-b1bb-86309d7a9bbb.png)

