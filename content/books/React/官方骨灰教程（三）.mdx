---
title: "React é«˜çº§åŠŸèƒ½è¯¦è§£ï¼šä»£ç åˆ†å‰²ã€Context ä¸é«˜é˜¶ç»„ä»¶"
date: "2024-12-19"
summary: "æ·±å…¥æ¢è®¨ React ä¸­çš„é«˜çº§ç‰¹æ€§ï¼ŒåŒ…æ‹¬ä»£ç åˆ†å‰²ä¼˜åŒ–ã€Context API ä½¿ç”¨ã€é«˜é˜¶ç»„ä»¶è®¾è®¡æ¨¡å¼ä»¥åŠæ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚"
status: "completed"
tech: ["React", "CodeSplitting", "HOC"]
github: "https://github.com/BM-laoli"
arxiv: ""
keyId: "React"
---

> å®˜æ–¹éª¨ç°æ•™ç¨‹ï¼ˆä¸‰ï¼‰ï¼Œè¿™é‡Œä¸»è¦æ˜¯ä»‹ç»äº†reactä¸­çš„é«˜çº§åŠŸèƒ½ï¼Œå±äºè¿›é˜¶å†…å®¹
>



### æ‰“åŒ…é…ç½®
#### ç®€å•çš„è¯´æ˜
æ­£å¦‚å¤§å¤šæ•°çš„å‰ç«¯æ¡†æ¶ä¸€æ ·ï¼Œreactä¹Ÿæ˜¯éœ€è¦æ‰“åŒ…çš„ã€‚åœ¨reactä¸Šå¹¶æ²¡æœ‰vue cli /ng clié‚£ä¹ˆæ–¹ä¾¿çš„ä¸œè¥¿ï¼Œä¸è¿‡æ­£æ˜¯å› ä¸ºå¦‚æ­¤ã€‚reactæ‰æ˜¯é«˜åº¦å¯æ‰©å±•çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»æ„çš„æ‰“åŒ…å·¥å…·ï¼Œæ¥é…ç½®æˆ‘ä»¬è‡ªå·±éœ€è¦çš„æ‰“åŒ…ç»“æ„

å½“ç„¶äº†reactå®˜æ–¹ä¹Ÿæ˜¯æœ‰æ¨èçš„cli æ¯”å¦‚ [Create React App](https://github.com/facebookincubator/create-react-app)<font style="color:#000000;">ï¼Œ</font>[Next.js](https://github.com/zeit/next.js/)<font style="color:#000000;">ï¼Œ</font>[Gatsby](https://www.gatsbyjs.org/)<font style="color:#000000;">ï¼Œä»–ä»¬åªéœ€è¦å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶å°±å¥½äº†ï¼Œä¸éœ€è¦å†åšå…¶å®ƒçš„äº‹æƒ…ï¼Œå¦‚æœä½ éœ€è¦è‡ªå·±åŸç”Ÿæ„å»ºä¸€ä¸ªæ‰“åŒ…é…ç½®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ‰‹åŠ¨å»é…ç½®å°±å®Œäº†ï¼Œæˆ‘æ¨èä½¿ç”¨webpack</font>

<font style="color:#000000;"></font>

#### ä½¿ç”¨create-react-app  + webpackæ„ä»¶ä¸€ä¸ªè„šæ‰‹æ¶
### 
### ä»£ç åˆ†å‰²ä¼˜åŒ–ç§˜å¯†
å½“æˆ‘ä»¬çš„appè¶Šæ¥è¶Šå¤§ï¼Œå¦‚æœéƒ½æ‰“åŒ…æˆä¸€ä¸ªbundleæ— ç–‘æ˜¯ä¸€ä¸ªç¾éš¾ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼Œä»£ç åˆ†å‰²æ¥ä¼˜åŒ–

#### åŠ¨æ€å¼•å…¥
çœ‹èµ·æ¥å¾ˆNBï¼Œå…¶å®éå¸¸çš„ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„import(  )å°±å¥½äº†

+ ä½¿ç”¨å‰

```javascript
import { add } form './math'
console.log( add(16.4) )
```

+ ä½¿ç”¨å

```javascript
import( './math' ).then( math => {
		console.log( add(16.4) )
} )

// æ³¨æ„é˜¿ è¿™ç§è¯­æ³•å’Œwebpackæ˜¯æœ‰å…³çš„ï¼Œä½ åº”è¯¥å…ˆäº†è§£ï¼Œwebpack ç›¸å…³çš„ä¸€äº›ä¸œè¥¿
// å¦‚æœä½ ä½¿ç”¨äº†creat-react-app cli å°±å¯ä»¥è‡ªåŠ¨çš„ä½¿ç”¨äº†ï¼Œä»–ä»¬ç»™ä½ é…ç½®å¥½äº†ï¼Œ
```

+ åŠ¨æ‰‹å¹²ä¸€æ³¢

```jsx
// è¿™é‡Œä½¿ç”¨creat-react-app + webpack + balble
// è®¾è®¡æ¨¡å¼ä½¿ç”¨é«˜é˜¶ç»„ä»¶çš„æ–¹å¼
1. å®‰è£…ä¸¤ä¸ªåŒ…
cnpm i react-loadable babel-plugin-syntax-dynamic-import -D

2. é…ç½®bable .babelrc

{
  "presets": [
    "react"
  ],
  "plugins": [
    "syntax-dynamic-import"
  ]
}

3. å¦‚æœä½ ä½¿ç”¨äº†eslintå¯ä»¥è¿™æ ·æ¥ç© .eslintrc
module.exports = {
  //...è‹¥å¹²é…ç½®

  parser: "babel-eslint"
}

4. å°è£…ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ loadable.jsx
import React from 'react'
import Loadable from 'react-loadable'

const Loading = () => {
  return <div>loading...</div>
}

export default (Loader) => {
  const LoadableComponent = Loadable({
    loader: Loader,
    loading: Loading
  })

  return class LoadableHOC extends React.Component {
    render () {
      return <LoadableComponent></LoadableComponent>
    }
  }
}

5.è¿™æ˜¯ä¸€ä¸ªéœ€è¦åŠ¨æ€åŠ è½½çš„ç»„ä»¶  Import.jsx
import React from 'react'

class Import extends React.Component {
  render () {
    return <div>import...</div>
  }
}

export default Import

6. è¿™æ˜¯ä¸€ä¸ªçˆ¶å®¹å™¨ test.jsx
import React from 'react'
import loadable from '@/utils/loadable'

const Import = loadable(() => import('@/components/Import'))

class Test extends React.Component {
  render () {
    return (<div>
      <Import></Import>
    </div>)
  }
}

export default Test

6. mianä¸­è¯•ä¸€ä¸‹
import React from 'react'
import ReactDom from 'react-dom'
import Test from '@/components/Test'

ReactDom.render(<Test />, document.getElementById('app')
```

#### React.lazy
`React.lazy`<font style="color:#000000;">Â å‡½æ•°èƒ½è®©ä½ åƒæ¸²æŸ“å¸¸è§„ç»„ä»¶ä¸€æ ·å¤„ç†åŠ¨æ€å¼•å…¥ï¼ˆçš„ç»„ä»¶ï¼‰ã€‚</font>

ğŸ” æ³¨æ„ï¼š`React.lazy`<font style="color:#000000;background-color:rgba(255, 229, 100, 0.3);">Â å’Œ Suspense æŠ€æœ¯è¿˜ä¸æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ã€‚å¦‚æœä½ æƒ³è¦åœ¨ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„åº”ç”¨ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬æ¨èÂ </font>[Loadable Components](https://github.com/gregberge/loadable-components)<font style="color:#000000;background-color:rgba(255, 229, 100, 0.3);">Â è¿™ä¸ªåº“ã€‚å®ƒæœ‰ä¸€ä¸ªå¾ˆæ£’çš„</font>[æœåŠ¡ç«¯æ¸²æŸ“æ‰“åŒ…æŒ‡å—](https://loadable-components.com/docs/server-side-rendering/)<font style="color:#000000;background-color:rgba(255, 229, 100, 0.3);">ã€‚</font>



+ ä½¿ç”¨å‰

```javascript
import OtherComponent from './OtherComponent';
```

+ ä½¿ç”¨å 

```javascript
const OtherComponent = React.lazy(() => import('./OtherComponent'));

// æ­¤ä»£ç å°†ä¼šåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œè‡ªåŠ¨å¯¼å…¥åŒ…å« OtherComponent ç»„ä»¶çš„åŒ…ã€‚
æ³¨æ„è¿™ä¸ªlazy æ¥å—æœ‰ä¸ªpromiseå‡½æ•°ï¼Œå¹¶ä¸”è¦æ±‚resolveä¸€ä¸ªdefalut exportçš„reactç»„ä»¶

```

+ æŒ‡ç¤ºåŠ è½½å™¨

è¿™ä¸ªæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿè¿™ä¸œè¥¿å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª lazyçš„æ—¶å€™ ç”¨äºloadingçš„ä¸œè¥¿

```jsx
import React, { Suspense } from 'react';

const OtherComponent = React.lazy(() => import('./OtherComponent'));
const AnotherComponent = React.lazy(() => import('./AnotherComponent'));

function MyComponent() {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <section>
          <OtherComponent />
          <AnotherComponent />
        </section>
      </Suspense>
    </div>
  );
}
```

+ æ³¨æ„ï¼šå¦‚æœæ˜¯æœåŠ¡ç«¯æ¸²æŸ“å»ºè®®ä½¿ç”¨è¿™ä¸ªåº“ [Loadable Components](https://github.com/gregberge/loadable-components) é…åˆlazy åè€…nextjs 

#### æ¨¡å—åŠ è½½å¼‚å¸¸æ€ä¹ˆåŠï¼Ÿå¼‚å¸¸æ•è·è¾¹ç•Œ
æœ‰æ—¶å€™ï¼Œæ¨¡å—ä¼šåŠ è½½å¼‚å¸¸ï¼Œè¿™ä¸ªæ—¶å€™ä½ éœ€è¦è¿™æ ·æ¥é…  ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªHOCè®¾è®¡æ¨¡å¼çš„æœ€ä½³è·µè¡Œ

```jsx
import React, { Suspense } from 'react';
import MyErrorBoundary from './ErrorBoundary';  

const OtherComponent = React.lazy(() => import('./OtherComponent'));
const AnotherComponent = React.lazy(() => import('./AnotherComponent'));

const MyComponent = () => (
  <div>
    <MyErrorBoundary>
      <Suspense fallback={<div>Loading...</div>}>
        <section>
          <OtherComponent />
          <AnotherComponent />
        </section>
      </Suspense>
    </MyErrorBoundary>
  </div>
);
```

```jsx
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    // æ›´æ–° state ä½¿ä¸‹ä¸€æ¬¡æ¸²æŸ“èƒ½å¤Ÿæ˜¾ç¤ºé™çº§åçš„ UI
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    // ä½ åŒæ ·å¯ä»¥å°†é”™è¯¯æ—¥å¿—ä¸ŠæŠ¥ç»™æœåŠ¡å™¨
    logErrorToMyService(error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      // ä½ å¯ä»¥è‡ªå®šä¹‰é™çº§åçš„ UI å¹¶æ¸²æŸ“
      return <h1>Something went wrong.</h1>;
    }

    return this.props.children; 
  }
}
```



#### å‘½åå¯¼å‡º
è¿™é‡Œæœ‰ä¸€ä¸ªå‘å°±æ˜¯ lazyåªèƒ½æ”¯æŒé»˜è®¤å¯¼å‡º default export å¦‚æœæ˜¯ä½¿ç”¨name exportéœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸­é—´ï¼Œæ¨¡å—æ¥å¤„ç†

```jsx
// ManyComponents.js
export const MyComponent = /* ... */;
export const MyUnusedComponent = /* ... */;

// MyComponent.js
export { MyComponent as default } from "./ManyComponents.js";

// MyApp.js
import React, { lazy } from 'react';
const MyComponent = lazy(() => import("./MyComponent.js"));
```

#### åŸºäºè·¯ç”±çš„ä»£ç åˆ†å‰²
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨react-router é›†åˆlazyè¿›è¡Œç•™æœ‰çš„æ‡’åŠ è½½

```jsx
import React, { Suspense, lazy } from 'react';
import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';

const Home = lazy(() => import('./routes/Home'));
const About = lazy(() => import('./routes/About'));

const App = () => (
  <Router>
    <Suspense fallback={<div>Loading...</div>}>
      <Switch>
        <Route exact path="/" component={Home}/>
        <Route path="/about" component={About}/>
      </Switch>
    </Suspense>
  </Router>
);

```

### Context
#### è¯´æ˜æ—¶å€™ä½¿ç”¨å®ƒ
context å°±æ˜¯ä¸€ä¸ªä¸æ–­çš„å¾€ä¸‹ç©¿é€ä¼ é€’çš„prors ï¼Œå¦‚åŒvueä¸­çš„provid

#### API
+ creatContext

```plain
const MyContext = React.createContext(defaultValue);
// åˆ›å»ºä¸€ä¸ªcontent å…·æœ‰é»˜è®¤å€¼value æ³¨æ„é˜¿ å¦‚æœä½ ä¼ é€’äº†undefined ç»™value å°±æœ‰é—®é¢˜ï¼Œä½ çš„default valueä¸ä¼šç”Ÿæ•ˆ
// è¿™ä¸ªæ˜¯åŒå‘ç»‘å®šçš„ï¼Œè€Œä¸” shouldComponentUpdate ä¸èƒ½é˜»æ­¢ å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä¸€æ—¦contextæ”¹å˜æ‰€æœ‰çš„æ¶ˆè´¹è€…ç»„ä»¶éƒ½å°†é‡æ–°æ¸²æŸ“
```

+ class.contextType

```jsx
ä¼ ç»Ÿè¯­æ³•
const MyContext = React.createContext(defaultValue);

class MyClass extends React.Component {
  componentDidMount() {
    let value = this.context;
    /* åœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåï¼Œä½¿ç”¨ MyContext ç»„ä»¶çš„å€¼æ¥æ‰§è¡Œä¸€äº›æœ‰å‰¯ä½œç”¨çš„æ“ä½œ */
  }
  componentDidUpdate() {
    let value = this.context;
    /* ... */
  }
  componentWillUnmount() {
    let value = this.context;
    /* ... */
  }
  render() {
    let value = this.context;
    /* åŸºäº MyContext ç»„ä»¶çš„å€¼è¿›è¡Œæ¸²æŸ“ */
  }
}
MyClass.contextType = MyContext;


ä¾¿æ·è¯­æ³•
class MyClass extends React.Component {
  static contextType = MyContext;
  render() {
    let value = this.context;
    /* åŸºäºè¿™ä¸ªå€¼è¿›è¡Œæ¸²æŸ“å·¥ä½œ */
  }
}
æŒ‚è½½åœ¨ class ä¸Šçš„ contextType å±æ€§ä¼šè¢«é‡èµ‹å€¼ä¸ºä¸€ä¸ªç”± React.createContext() åˆ›å»ºçš„ Context å¯¹è±¡ã€‚è¿™èƒ½è®©ä½ ä½¿ç”¨ this.context æ¥æ¶ˆè´¹æœ€è¿‘ Context ä¸Šçš„é‚£ä¸ªå€¼ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•ç”Ÿå‘½å‘¨æœŸä¸­è®¿é—®åˆ°å®ƒï¼ŒåŒ…æ‹¬ render å‡½æ•°ä¸­ã€‚
```

+ context.consumer

```jsx
<MyContext.Consumer>
  {value => /* åŸºäº context å€¼è¿›è¡Œæ¸²æŸ“*/}
</MyContext.Consumer>
// å¦‚æœæ˜¯å¤šçº§åµŒå¥—çš„ä¹‹åªæ‹¿é‡Œè¿™ä¸ªcontextæœ€è¿‘çš„Provideræä¾›çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å°±æ˜¯default value
```

+ ä¸‹é¢è¿™ä¸ªapiæ˜¯å¯¹dev toolså·¥å…·å‹å¥½çš„

```jsx
// context å¯¹è±¡æ¥å—ä¸€ä¸ªåä¸º displayName çš„ propertyï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²ã€‚React DevTools ä½¿ç”¨è¯¥å­—ç¬¦ä¸²æ¥ç¡®å®š context è¦æ˜¾ç¤ºçš„å†…å®¹ã€‚

const MyContext = React.createContext(/* some value */);
MyContext.displayName = 'MyDisplayName';

<MyContext.Provider> // "MyDisplayName.Provider" åœ¨ DevTools ä¸­
<MyContext.Consumer> // "MyDisplayName.Consumer" åœ¨ DevTools ä¸­
```

#### ç¤ºä¾‹
```jsx
éœ€æ±‚ï¼šæˆ‘ä»¬è¦åšä¸€ä¸ªä¸»é¢˜å¯å®šåˆ¶åŒ–çš„ç»„ä»¶,è¦æ±‚å°±æ˜¯ä¼šç”¨context

// theme-context.js
export const themes = {
  light: {
    foreground: '#000000',
    background: '#eeeeee',
  },
  dark: {
    foreground: '#ffffff',
    background: '#222222',
  },
};
// ç¡®ä¿ä¼ é€’ç»™ createContext çš„é»˜è®¤å€¼æ•°æ®ç»“æ„æ˜¯è°ƒç”¨çš„ç»„ä»¶ï¼ˆconsumersï¼‰æ‰€èƒ½åŒ¹é…çš„ï¼
export const ThemeContext = React.createContext({
  theme: themes.dark,// é»˜è®¤å€¼
  toggleTheme: () => {},
});


// themed-button.js
import {ThemeContext} from './theme-context';

class ThemedButton extends React.Component {
  render() {
    let props = this.props;
    let theme = this.context;
    return (
      <button
        {...props}
        style={{backgroundColor: theme.background}}
      />
    );
  }
}
ThemedButton.contextType = ThemeContext;

export default ThemedButton;


// ä»contentä¸­è·å–ä¸€ä¸ªå‡½æ•°   theme-toggler-button.js

import {ThemeContext} from './theme-context';

function ThemeTogglerButton() {
  // Theme Toggler æŒ‰é’®ä¸ä»…ä»…åªè·å– theme å€¼ï¼Œå®ƒä¹Ÿä» context ä¸­è·å–åˆ°ä¸€ä¸ª toggleTheme å‡½æ•°
  return (
    <ThemeContext.Consumer>
      {
        ({theme, toggleTheme}) => (
        <button          onClick={toggleTheme}
          style={{backgroundColor: theme.background}}>
          Toggle Theme
        </button>
      )
      }
    </ThemeContext.Consumer>
  );
}

export default ThemeTogglerButton;


// app.js
import {ThemeContext, themes} from './theme-context';
import ThemedButton from './themed-button';
import ThemeTogglerButton from './theme-toggler-button';
// ä¸€ä¸ªä½¿ç”¨ ThemedButton çš„ä¸­é—´ç»„ä»¶
function Toolbar(props) {
  return (
    <ThemedButton onClick={props.changeTheme}>
      Change Theme
    </ThemedButton>
  );
}

class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      theme: themes.light,
    };

    this.toggleTheme = () => {
      this.setState(state => ({
        theme:
          state.theme === themes.dark
            ? themes.light
            : themes.dark,
      }));
    };
  }

  render() {
    // åœ¨ ThemeProvider å†…éƒ¨çš„ ThemedButton æŒ‰é’®ç»„ä»¶ä½¿ç”¨ state ä¸­çš„ theme å€¼ï¼Œ
    // è€Œå¤–éƒ¨çš„ç»„ä»¶ä½¿ç”¨é»˜è®¤çš„ theme å€¼
    return (
      <Page>
        <ThemeContext.Provider value={this.state.theme}>
          <Toolbar changeTheme={this.toggleTheme} />
          <ThemeTogglerButton />
        </ThemeContext.Provider>
        <Section>
          <ThemedButton />
        </Section>
      </Page>
    );
  }
}

ReactDOM.render(<App />, document.root);
```

+ æ¶ˆè´¹å¤šä¸ªå€¼

è¿™ä¸œè¥¿ä¸æ¨èï¼Œå¦‚æœè¦æ¶ˆè´¹å¤šå€¼ï¼Œå¯ä»¥å†™åˆ°ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ä¸­å» calss.contextTypeé‚£ç§

```jsx
// Theme contextï¼Œé»˜è®¤çš„ theme æ˜¯ â€œlightâ€ å€¼
const ThemeContext = React.createContext('light');

// ç”¨æˆ·ç™»å½• context
const UserContext = React.createContext({
  name: 'Guest',
});

class App extends React.Component {
  render() {
    const {signedInUser, theme} = this.props;

    // æä¾›åˆå§‹ context å€¼çš„ App ç»„ä»¶
    return (
      <ThemeContext.Provider value={theme}>
        <UserContext.Provider value={signedInUser}>
          <Layout />
        </UserContext.Provider>
      </ThemeContext.Provider>
    );
  }
}

function Layout() {
  return (
    <div>
      <Sidebar />
      <Content />
    </div>
  );
}

// ä¸€ä¸ªç»„ä»¶å¯èƒ½ä¼šæ¶ˆè´¹å¤šä¸ª context
function Content() {
  return (
    <ThemeContext.Consumer>
      {theme => (
        <UserContext.Consumer>
          {user => (
            <ProfilePage user={user} theme={theme} />
          )}
        </UserContext.Consumer>
      )}
    </ThemeContext.Consumer>
  );
}
```

#### æ³¨æ„å¦‚ä½•é¿å…é‡æ–°æ¸²æŸ“çš„å‘ç”Ÿ
ç­”æ¡ˆç®€å•ï¼Œå°±æ˜¯æŠŠstateæåˆ°çˆ¶ç»„ä»¶å»

```jsx
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      value: {something: 'something'},
    };
  }

  render() {
    return (
      <Provider value={this.state.value}>
        <Toolbar />
      </Provider>
    );
  }
}
```





### Refæœ‰ä»€ä¹ˆç”¨ï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ
è¿™ä¸œè¥¿å¯ä»¥ä½¿ä½ ç›´æ¥æ“ä½œç»„ä»¶æˆ–è€…dom

#### ç›´æ¥æ¢å‘åˆ°DOMä¸Š
```jsx
const FancyButton = React.forwardRef((props, ref) => (
  <button ref={ref} className="FancyButton">
    {props.children}
  </button>
));

// ä½ å¯ä»¥ç›´æ¥è·å– DOM button çš„ refï¼š
const ref = React.createRef();
<FancyButton ref={ref}>Click me!</FancyButton>;


```

#### æ³¨æ„
#### ä¸æ¨èä½¿ç”¨Ref
### 
### éå¸¸ç®€å•çš„åŠŸèƒ½Fragments
 Â  Â Â è¿™ä¸œè¥¿ä¸»è¦æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜

```jsx
class Columns extends React.Component {
  render() {
    return (
      <div>
        <td>Hello</td>
        <td>World</td>
      </div>
    );
  }
}

class Table extends React.Component {
  render() {
    return (
      <table>
        <tr>
          <Columns />
        </tr>
      </table>
    );
  }
}

<table>
  <tr>
    <div>
      <td>Hello</td>
      <td>World</td>
    </div>
  </tr>
</table>

```



å¦‚æœæ˜¯ä½¿ç”¨<font style="color:#000000;">FragmentsÂ </font>

```jsx
class Columns extends React.Component {
  render() {
    return (
      <>
        <td>Hello</td>
        <td>World</td>
      </>
    );
  }
}

// å¦‚æœä½ éœ€è¦åŠ key ä½ å¯ä»¥è¿™æ ·
class Columns extends React.Component {
  render() {
    return (
      <React.Fragment key={yourKey}>
        <td>Hello</td>
        <td>World</td>
      <React.Fragment/>
    );
  }
}

```



### é€»è¾‘å¤ç”¨å’ŒUIå¤ç”¨ï¼ˆå°è£…ï¼‰
> é«˜é˜¶ç»„ä»¶è¿˜æ˜¯ç›¸å¯¹æ¯”è¾ƒç®€å•çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬æ¥è¿™ç¯‡æ–‡æ¡£å°±å¤Ÿäº†
>

#### propçš„å‡ ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼
> render-props <font style="color:#000000;">å®ƒå¯ä»¥æŠŠç‰¹å®šè¡Œä¸ºæˆ–åŠŸèƒ½å°è£…æˆä¸€ä¸ªç»„ä»¶ï¼Œæä¾›ç»™å…¶ä»–ç»„ä»¶ä½¿ç”¨è®©å…¶ä»–ç»„ä»¶æ‹¥æœ‰è¿™æ ·çš„èƒ½åŠ›</font>
>

1. è¦å®ç°è¿™æ ·çš„æ–¹å¼è®¾è®¡æ–¹å¼ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨ æ‹¿åˆ°å…¬ç”¨çš„ç»„ä»¶çš„çŠ¶æ€stateï¼Œ<font style="color:rgba(0, 0, 0, 0.75);">åœ¨ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œæ·»åŠ ä¸€ä¸ªå€¼ä¸ºå‡½æ•°çš„propï¼Œé€šè¿‡å‡½æ•°å‚æ•°æ¥è·å–éœ€è¦è¢«æå–å‡ºæ¥å…¬å…±çš„çŠ¶æ€</font>

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597218050262-43e20f57-b6a3-4822-9c6c-55c3b27b9b73.png)

2. å¦‚ä½•æ¸²æŸ“ä»»æ„çš„uiå‘¢ï¼Ÿä¹Ÿéå¸¸çš„ç®€å•ï¼Œæœ‰äº†æ•°æ®ç›´æ¥æ¸²æŸ“å°±å¥½äº†

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597218128831-be9bc5b9-8e90-4f6a-b331-8f954aa6c40a.png)

```javascript
class Mouse extends React.Component {
    // é¼ æ ‡ä½ç½®çŠ¶æ€
    state = {
        x: 0,
        y: 0
    }

    // ç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶
    componentDidMount(){
        window.addEventListener('mousemove',this.handleMouseMove)
    }
    handleMouseMove = e => {
        this.setState({
            x: e.clientX,
            y: e.clientY
        })
    }
    render(){
        // å‘å¤–ç•Œæä¾›å½“å‰å­ç»„ä»¶é‡Œé¢çš„æ•°æ®ï¼Œé‡ç‚¹ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œå°±èƒ½æ¸²æŸ“ä»»æ„ç»“æ„çš„uiäº†ï¼ç§’å•Šï¼Œè€Œä¸”ä¹Ÿä¸ºé€»è¾‘çš„æ“ä½œéƒ½æ˜¯å†…éƒ¨å®ç°çš„ï¼å®Œå…¨è§£è€¦
        return this.props.render(this.state)
    }
}
class App extends React.Component {
    render() {
        return (
            <div>
                App
                <Mouse render={mouse => {
                    return <p>X{mouse.x}Y{mouse.y}</p>
                }}/>
            </div>
        )
    }
}
ReactDOM.render(<App />,document.getElementById('root'))
```

3. ä¼˜åŒ–æ³¨æ„äº‹é¡¹
+ æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨childrenæ¥ä»£æ›¿rednerå±æ€§å
+ æ¨èæŠŠpropsæ·»åŠ ä¸Šæ ¡éªŒè§„åˆ™
+ æ€§èƒ½è§’åº¦ ï¼Œç»„ä»¶é”€æ¯çš„æ—¶å€™è¦è§£ç»‘äº‹ä»¶

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597218348766-7a150ff5-8797-4018-aa45-5ad355646092.png)

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597218362434-f55e57a0-cc5c-44b1-9f17-e8815f10c978.png)

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597218396384-034dab15-231a-4136-857b-edc0e65f352b.png)

```javascript
class Mouse extends React.Component {
    // é¼ æ ‡ä½ç½®çŠ¶æ€
    state = {
        x: 0,
        y: 0
    }

    // ç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶
    componentDidMount(){
        window.addEventListener('mousemove',this.handleMouseMove)
    }
    handleMouseMove = e => {
        this.setState({
            x: e.clientX,
            y: e.clientY
        })
    },
     componentWillUnmount(){
			window.removeEvenListener("mousemove",this.handleMouserMove)
     }
    render(){
        // å‘å¤–ç•Œæä¾›å½“å‰å­ç»„ä»¶é‡Œé¢çš„æ•°æ®ï¼Œé‡ç‚¹ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œå°±èƒ½æ¸²æŸ“ä»»æ„ç»“æ„çš„uiäº†ï¼ç§’å•Šï¼Œè€Œä¸”ä¹Ÿä¸ºé€»è¾‘çš„æ“ä½œéƒ½æ˜¯å†…éƒ¨å®ç°çš„ï¼å®Œå…¨è§£è€¦
        return this.props.children(this.state)
    }
     
}
class App extends React.Component {
    render() {
        return (
            <div>
                App
                <Mouse children={mouse => {
                    return <p>X{mouse.x}Y{mouse.y}</p>
                }}/>
            </div>
        )
    }
}
ReactDOM.render(<App />,document.getElementById('root'))
```

#### é«˜é˜¶çš„ç»„ä»¶å°è£…
> HOCé«˜é˜¶ç»„ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œ<font style="color:rgba(0, 0, 0, 0.75);">å®ç°çŠ¶æ€é€»è¾‘å¤ç”¨ï¼Œé‡‡å–</font><font style="color:rgba(0, 0, 0, 0.75);">åŒ…è£…æ¨¡å¼</font>
>
> <font style="color:rgba(0, 0, 0, 0.75);">é«˜é˜¶ç»„ä»¶(HOCã€Higher-Order Component) æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶è¦åŒ…è£…çš„ç»„ä»¶ï¼Œè¿”å›å¢å¼ºåçš„ç»„ä»¶</font>
>

##### æ ¸å¿ƒæŠ€æœ¯
    - <font style="color:rgba(0, 0, 0, 0.75);">æ¥æ”¶è¦åŒ…è£…çš„ç»„ä»¶ï¼Œè¿”å›å¢å¼ºåçš„ç»„ä»¶</font>
    - ![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597218664266-1b8f8ac8-0ae4-4123-bfac-11333ff32102.png)
    - é«˜çº§ç»„ä»¶å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªç±»ç»„ä»¶
    - ![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597218694856-13116275-4b7d-4994-a691-b92b3952ba7c.png)

##### ä½¿ç”¨è¯´æ˜
+ åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œåç§°çº¦å®šä»¥withå¼€å¤´
+ æŒ‡å®šå‡½æ•°å‚æ•°ï¼Œå‚æ•°åº”è¯¥ä»¥å¤§å†™å­—æ¯å¼€å¤´
+ åœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªç±»ç»„ä»¶ï¼Œæä¾›å¤ç”¨çš„çŠ¶æ€é€»è¾‘ä»£ç ï¼Œå¹¶è¿”å›
+ åœ¨è¯¥ç»„ä»¶ä¸­ï¼Œæ¸²æŸ“å‚æ•°ç»„ä»¶ï¼ŒåŒæ—¶å°†çŠ¶æ€é€šè¿‡propä¼ é€’ç»™å‚æ•°ç»„ä»¶
+ è°ƒç”¨è¯¥é«˜é˜¶ç»„ä»¶ï¼Œä¼ å…¥è¦å¢å¼ºçš„ç»„ä»¶ï¼Œé€šè¿‡è¿”å›å€¼æ‹¿åˆ°å¢å¼ºåçš„ç»„ä»¶ï¼Œå¹¶å°†å…¶æ¸²æŸ“åˆ°é¡µé¢



åŒ…è£…å‡½æ•°

```javascript
// å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªç›¸åº”ç±»ç»„ä»¶
function withMouse(WrappedComponent) {
    // è¯¥ç»„ä»¶æä¾›å¤ç”¨çŠ¶æ€é€»è¾‘
    class Mouse extends React.Component {
        state = {
            x: 0,
            y: 0
        }
        // äº‹ä»¶çš„å¤„ç†å‡½æ•°
        handleMouseMove = (e) => {
            this.setState({
                x: e.clientX,
                y: e.clientY
            })
        }
        // å½“ç»„ä»¶æŒ‚è½½çš„æ—¶å€™è¿›è¡Œäº‹ä»¶ç»‘å®š
        componentDidMount() {
            window.addEventListener('mousemove', this.handleMouseMove)
        }
        // å½“ç»„ä»¶ç§»é™¤æ—¶å€™è§£ç»‘äº‹ä»¶
        componentWillUnmount() {
            window.removeEventListener('mousemove', this.handleMouseMove)
        }
        render() {
            // åœ¨renderå‡½æ•°é‡Œé¢è¿”å›ä¼ é€’è¿‡æ¥çš„ç»„ä»¶ï¼ŒæŠŠå½“å‰ç»„ä»¶çš„çŠ¶æ€è®¾ç½®è¿›å»
            return <WrappedComponent {...this.state} />
        }
    }
    return Mouse
}
```

<font style="color:rgba(0, 0, 0, 0.75);">åŠ å¼ºç»„ä»¶</font>

```javascript
function Position(props) {
    return (
        <p> // è¿™é‡Œçš„propå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬çš„é«˜é˜¶å‡½æ•°é‡Œçš„state
            X:{props.x}
            Y:{props.y}
        </p>
    )
}
// æŠŠposition ç»„ä»¶æ¥è¿›è¡ŒåŒ…è£…
let MousePosition = withMouse(Position)

class App extends React.Component {
    constructor(props) {
        super(props)
    }
    render() {
        return (
            <div>
                é«˜é˜¶ç»„ä»¶
                <MousePosition></MousePosition>
            </div>
        )
    }
}
```

##### ä¼˜åŒ–å’Œæ”¹è¿›
> ä½¿ç”¨é«˜é˜¶ç»„ä»¶å­˜åœ¨å¦‚ä¸‹çš„é—®é¢˜,
>

1. å­˜åœ¨ä¸¤ä¸ªåŒåç§°çš„ç»„ä»¶ï¼Œæ²¡æ³•åŒºåˆ†ï¼ˆåœ¨dev-toolsä¸­ï¼‰

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597219199569-59043615-d8ca-4285-9a70-c5570e56e95f.png)

ä¸ºä»€ä¹ˆå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597219233222-8cdff7f8-c4ab-4335-8252-7b3006b8130c.png)

```javascript
           // åœ¨renderå‡½æ•°é‡Œé¢è¿”å›ä¼ é€’è¿‡æ¥çš„ç»„ä»¶ï¼ŒæŠŠå½“å‰ç»„ä»¶çš„çŠ¶æ€è®¾ç½®è¿›å»
            return <WrappedComponent {...this.state} />
        }
    }
    return Mouse  // ä½ çœ‹éƒ½è¿”å›äº†Mouse
```

è§£å†³æ–¹æ¡ˆï¼Œè®¾ç½®åå­—

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597219293077-206f870f-6df0-4e70-ab96-9a591dcaea0a.png)

è¿™é‡Œçš„nameå°±æ˜¯ç»„ä»¶çš„åç§°ï¼Œæ³¨æ„å•Šï¼Œè¿™ä¸ªgetDispalyNameæ˜¯ä¸å†™åœ¨å¤–é¢çš„ï¼å†™åœ¨indexä¸­

```javascript
import React from 'react'
import ReactDOM from 'react-dom'

/* 
  é«˜é˜¶ç»„ä»¶
*/

import img from './images/cat.png'

// åˆ›å»ºé«˜é˜¶ç»„ä»¶
function withMouse(WrappedComponent) {
  // è¯¥ç»„ä»¶æä¾›å¤ç”¨çš„çŠ¶æ€é€»è¾‘
  class Mouse extends React.Component {
    // é¼ æ ‡çŠ¶æ€
    state = {
      x: 0,
      y: 0
    }

    handleMouseMove = e => {
      this.setState({
        x: e.clientX,
        y: e.clientY
      })
    }

    // æ§åˆ¶é¼ æ ‡çŠ¶æ€çš„é€»è¾‘
    componentDidMount() {
      window.addEventListener('mousemove', this.handleMouseMove)
    }

    componentWillUnmount() {
      window.removeEventListener('mousemove', this.handleMouseMove)
    }

    render() {
      return <WrappedComponent {...this.state} />
    }
  }

  // è®¾ç½®displayName
  Mouse.displayName = `WithMouse${getDisplayName(WrappedComponent)}`

  return Mouse
}

function getDisplayName(WrappedComponent) {
  return WrappedComponent.displayName || WrappedComponent.name || 'Component'
}

// ç”¨æ¥æµ‹è¯•é«˜é˜¶ç»„ä»¶
const Position = props => (
  <p>
    é¼ æ ‡å½“å‰ä½ç½®ï¼š(x: {props.x}, y: {props.y})
  </p>
)

// çŒ«æ‰è€é¼ çš„ç»„ä»¶ï¼š
const Cat = props => (
  <img
    src={img}
    alt=""
    style={{
      position: 'absolute',
      top: props.y - 64,
      left: props.x - 64
    }}
  />
)

// è·å–å¢å¼ºåçš„ç»„ä»¶ï¼š
const MousePosition = withMouse(Position)

// è°ƒç”¨é«˜é˜¶ç»„ä»¶æ¥å¢å¼ºçŒ«æ‰è€é¼ çš„ç»„ä»¶ï¼š
const MouseCat = withMouse(Cat)

class App extends React.Component {
  render() {
    return (
      <div>
        <h1>é«˜é˜¶ç»„ä»¶</h1>
        {/* æ¸²æŸ“å¢å¼ºåçš„ç»„ä»¶ */}
        <MousePosition />
        <MouseCat />
      </div>
    )
  }
}

ReactDOM.render(<App />, document.getElementById('root'))

```

2. æˆ‘ä»¬è¿˜æœ‰é—®é¢˜ï¼Œå°±æ˜¯propä¼ å‚çš„æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜
+ é—®é¢˜ï¼šå¦‚æœæ²¡æœ‰ä¼ é€’propsï¼Œä¼šå¯¼è‡´propsä¸¢å¤±é—®é¢˜
+ è§£å†³æ–¹å¼ï¼š æ¸²æŸ“WrappedComponentæ—¶ï¼Œå°†stateå’Œpropsä¸€èµ·ä¼ é€’ç»™ç»„ä»¶

![](https://cdn.nlark.com/yuque/0/2020/png/1627571/1597220461136-08b44bea-b36e-47ca-a753-e201d585df52.png)

```javascript
import React from 'react'
import ReactDOM from 'react-dom'

/* 
  é«˜é˜¶ç»„ä»¶
*/

// åˆ›å»ºé«˜é˜¶ç»„ä»¶
function withMouse(WrappedComponent) {
  // è¯¥ç»„ä»¶æä¾›å¤ç”¨çš„çŠ¶æ€é€»è¾‘
  class Mouse extends React.Component {
    // é¼ æ ‡çŠ¶æ€
    state = {
      x: 0,
      y: 0
    }

    handleMouseMove = e => {
      this.setState({
        x: e.clientX,
        y: e.clientY
      })
    }

    // æ§åˆ¶é¼ æ ‡çŠ¶æ€çš„é€»è¾‘
    componentDidMount() {
      window.addEventListener('mousemove', this.handleMouseMove)
    }

    componentWillUnmount() {
      window.removeEventListener('mousemove', this.handleMouseMove)
    }

    render() {
      console.log('Mouse:', this.props)
      return <WrappedComponent {...this.state} {...this.props} />
    }
  }

  // è®¾ç½®displayName
  Mouse.displayName = `WithMouse${getDisplayName(WrappedComponent)}`

  return Mouse
}

function getDisplayName(WrappedComponent) {
  return WrappedComponent.displayName || WrappedComponent.name || 'Component'
}

// ç”¨æ¥æµ‹è¯•é«˜é˜¶ç»„ä»¶
const Position = props => {
  console.log('Position:', props)
  return (
    <p>
      é¼ æ ‡å½“å‰ä½ç½®ï¼š(x: {props.x}, y: {props.y})
    </p>
  )
}

// è·å–å¢å¼ºåçš„ç»„ä»¶ï¼š
const MousePosition = withMouse(Position)

class App extends React.Component {
  render() {
    return (
      <div>
        <h1>é«˜é˜¶ç»„ä»¶</h1>
        <MousePosition a="1" />
      </div>
    )
  }
}

ReactDOM.render(<App />, document.getElementById('root'))

```

#### æ€»ç»“
+ ç»„ä»¶é€šè®¯æ˜¯æ„å»ºReactåº”ç”¨å¿…ä¸å¯å°‘çš„ä¸€ç¯
+ propsçš„çµæ´»æ€§è®©ç»„ä»¶æ›´åŠ å¼ºå¤§
+ çŠ¶æ€æå‡æ˜¯Reactç»„ä»¶çš„å¸¸ç”¨æ¨¡å¼
+ ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæœ‰åŠ©äºç†è§£ç»„ä»¶çš„è¿è¡Œè¿‡ç¨‹
+ é’©å­å‡½æ•°è®©å¼€å‘è€…å¯ä»¥åœ¨ç‰¹å®šçš„æ—¶æœºæ‰§è¡ŒæŸäº›åŠŸèƒ½
+ render props æ¨¡å¼å’Œé«˜é˜¶ç»„ä»¶éƒ½å¯ä»¥å®ç°ç»„ä»¶çŠ¶æ€é€»è¾‘çš„å¤ç”¨
+ ç»„ä»¶æç®€æ¨¡å‹ï¼š (state,props) => UI



#### å…³äºéƒ¨åˆ†çš„æ€§èƒ½ä¼˜åŒ–é—®é¢˜
> æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè§£å†³renderå¤šæ¬¡éå¿…è¦æ¸²æŸ“æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œ
>

shoulCompentUpadtaï¼ˆï¼‰{}

å¦‚æœè¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯fasleè¡¨ç¤ºä¸ä¼šè°ƒç”¨renderå‡½æ•°è¿›è¡Œé¡µé¢çš„é‡æ–°æ¸²æŸ“ï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°

ä¸Šä¸€ä¸ªçš„propï¼Œæœ€æ–°çš„propï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹æ¯”ä¸¤ä¸ªæ˜¯ä¸æ˜¯ä¸€æ ·å°±å¥½äº†ï¼Œä¸ä¸€æ ·å°±æ¸²æŸ“ï¼Œä¸€æ ·å°±ä¸æ¸²æŸ“



ç›®å‰è¿™ä¸ªä¸œè¥¿ï¼Œåœ¨Reactçš„æ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¥½åƒæ˜¯ä¸èƒ½ç”¨äº†ï¼Œäºæ˜¯è¿˜æœ‰å¦å¤–çš„æŠ€æœ¯æ‰‹æ®µæ¥è§£å†³è¿™ä¸ªé—®é¢˜

