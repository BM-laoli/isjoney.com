---
title: "iOS å¼€å‘å®æˆ˜ï¼šWkWebViewã€åŠ¨ç”»ä¸ç½‘ç»œè¯·æ±‚"
date: "2025-06-17"
summary: "è¯¦ç»†ä»‹ç» iOS ä¸­ WkWebView çš„ä½¿ç”¨ã€è§‚å¯Ÿè€…æ¨¡å¼å®ç°ã€åŠ¨ç”»å¼€å‘æŠ€å·§ã€ç½‘ç»œè¯·æ±‚å¤„ç†åŠ JSON æ•°æ®è§£æï¼ŒåŒ…å«å®Œæ•´ä»£ç ç¤ºä¾‹ã€‚"
status: "completed"
tech: ["iOS", "WkWebView", "Animation", "Network"]
github: "https://github.com/BM-laoli"
arxiv: ""
keyId: "App"
---

# 
# WkWebView
## åˆæ¬¡ä½¿ç”¨
### ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1635945691228-63d2d62b-05d5-4da1-9003-3af1430dd51a.png)

åœ¨IOSç³»ç»Ÿä¸­ ç³»ç»Ÿè‡ªå¸¦ä¸€ä¸ªWebView ç„¶åè¿˜è¿­ä»£å¦ä¸€ä¸ªWebViewï¼ˆç›®å‰ç”¨çš„æœ€æ–°çš„WebViewå°±æ˜¯å®ƒï¼‰

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1635945766806-8a3f74a1-5eeb-494e-a99a-f4af3542f73b.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1635945793305-d064c6b2-43d8-46df-891b-df5b7ca021f5.png)

å¦‚æœä½ å¯¹è·¨ç«¯å¼•æ“æ„Ÿå…´è¶£ å¯ä»¥å»å¥½å¥½çš„çœ‹çœ‹WebKitå¼•æ“ï¼ˆéœ€è¦ä½ ä¼šä¸€äº›C++ï¼‰ï¼Œå¦‚æœéœ€è¦è°ƒç”¨è¿™ä¸ªUIViewæˆ‘ä»¬éœ€è¦ä½¿ç”¨delegateæ¨¡å¼å“ˆ

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1635945876381-d626188a-fc96-47ff-8cff-2a6c4a97f55f.png)

ä¸‹é¢çš„æ­¥éª¤å°±æ˜¯å¦‚ä½•ä½¿ç”¨WkWebViewå»åŠ è½½ä¸€ä¸ªWebé¡µé¢

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1635950114190-161b6c7c-72a9-42ec-a995-306ec2f3c5de.png)

## 
### å®æˆ˜æŒ‡å—
> æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬åŸºäºåŸæ¥çš„ä»£ç  æŠŠTabâ€œé¦–é¡µâ€ä¸­çš„ç‚¹å‡»äº‹æƒ…ï¼Œè°ƒæ•´åˆ°äº†ä¸€ä¸ªæ–°é¡µé¢è¿™ä¸ªé¡µé¢ç”¨æ¥ä½œä¸ºâ€œå®¹å™¨â€ç››æ”¾æˆ‘ä»¬çš„WebView
>

```objectivec
//
//  WebViewViewController.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/3.
//

#import "WebViewViewController.h"
#import <WebKit/WebKit.h>  // å¼•å…¥webkit

@interface WebViewViewController () <WKNavigationDelegate>
@property(nonatomic, strong, readwrite) WKWebView *webView;
@end

@implementation WebViewViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
//    è®¾ç½®ä¸€ä¸ªWKWebView
    [self.view addSubview:({
        self.webView = [[WKWebView alloc] initWithFrame:CGRectMake(0, 88, self.view.frame.size.width, self.view.frame.size.height - 88)];
        self.webView;
    })];

//    è®¾ç½®å®ƒçš„delegate
    self.webView.navigationDelegate = self;

//    ç»™å®šä¸€ä¸ªç½‘é¡µå»åŠ è½½å®ƒ
    
    [self.webView loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@"https://www.baidu.com"]]];
}

- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler {
    // å»è°ƒç”¨ä¸€ä¸ªå›è°ƒ å¦‚æœä¸éœ€è¦é‡å†™ é‚£ä¹ˆè¯·ç›´æ¥æ‰ç”¨ è¿™äº›æ–¹æ³•çš„å‚æ•°éƒ½æœ‰å…·ä½“çš„å«ä¹‰çš„ï¼Œä¸è¿‡æˆ‘ä»¬ç›®å‰æ˜¯ç”¨ä¸åˆ°çš„ï¼Œç”¨åˆ°äº†å†è¯´
    decisionHandler(WKNavigationActionPolicyAllow );
    NSLog(@"è¦å¼€å§‹åŠ è½½äº†....");
    
};

- (void)webView:(WKWebView *)webView didFinishNavigation:(null_unspecified WKNavigation *)navigation {
    NSLog(@"åŠ è½½å®Œæ¯•...");
};

@end



## å‰å¾€æˆ‘ä»¬çš„ä¹‹å‰çš„ViewController.mæ–‡ä»¶ä¿®æ”¹ä¸€ä¸‹åŸæ¥çš„UIVIew
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
// è®¾ç½®ä¸€ä¸ªæ–°çš„UIView
//        Webvie *viewControoler = [[UIViewController alloc] init];
//        viewControoler.view.backgroundColor = [UIColor whiteColor];
//        viewControoler.navigationItem.title = [NSString stringWithFormat:@"æ ‡é¢˜ - %@", @(indexPath.row)];
        
            WebViewViewController *viewControoler = [[WebViewViewController alloc] init];
            viewControoler.view.backgroundColor = [UIColor whiteColor];
            viewControoler.navigationItem.title = [NSString stringWithFormat:@"æ ‡é¢˜ - %@", @(indexPath.row)];

        [self.navigationController pushViewController: viewControoler animated:YES];
};

```

## è§‚å¯Ÿè€…æ¨¡å¼
> å‰æœŸæè¦ï¼Œæœ‰å…³äº è§‚å¯Ÿè€…æ¨¡å¼ å’Œå‘å¸ƒè®¢é˜…æ¨¡å‹ åœ¨å‰ç«¯ä¹Ÿåº”ç”¨å¾ˆå¹¿ æ¯”å¦‚vueæºç ä¸­å°± æœ‰ç”¨åˆ°
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1635951992051-892fb7e1-fe90-4fca-b083-29be972ab1d1.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636385723901-287439cd-0bf0-4bc5-8f9e-d896bed17722.png)

åªè¦æ˜¯æœ‰key-value-oberstingçš„å±æ€§æè¿°ï¼Œå°±èƒ½å¯¹è¯¥å±æ€§è¿›è¡Œè§‚å¯Ÿ

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636385822625-90cf909b-0f82-461d-b736-88704180dad1.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636387560656-987569da-769d-45ca-818c-c3475a4c5eb0.png)

æˆ‘ä»¬å¯ä»¥å»ç”¨ä¸€äº›å¼€æºçš„KVOå‡å°‘ KVOçš„ç¹çæ“ä½œ

### å®æˆ˜æŒ‡å—
```objectivec
//
//  WebViewViewController.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/3.
//

#import "WebViewViewController.h"
#import <WebKit/WebKit.h>  // å¼•å…¥webkit

@interface WebViewViewController () <WKNavigationDelegate>
++++ æä¸€ä¸ªView ä¸Šå» UIProgressView å±•ç¤ºè¿›åº¦æ¡
@property(nonatomic, strong, readwrite) UIProgressView *webProgreess;
++++
@end

@implementation WebViewViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    +++++
    
//    æä¸Šä¸€ä¸ªKVOè§‚å¯Ÿè€…æ¨¡å¼ 1. æ³¨å†Œ ç›‘å¬æŸäº›å±æ€§çš„å˜åŒ–ï¼Œæ¯”å¦‚è¿™é‡Œç›‘å¬çš„æ˜¯estimatedProgresså˜åŒ–æ—¶ï¼Œè¯¥å±æ€§å¦‚ä½•å˜åŒ–æ—¶è§¦å‘æ–¹æ³•å‘¢(estimatedProgresså±æ€§æ–°å˜åŒ–çš„æ—¶å€™è§¦å‘)ï¼Ÿ éœ€è¦ä¼ é€’ä»€ä¹ˆå‚æ•°å‘¢,
    [self.webView addObserver:self forKeyPath:@"estimatedProgress" options:(NSKeyValueObservingOptionNew) context:(nil)];
    
    //    KVOè®¾ç½®ä¸€ä¸ªè¿›åº¦æ¡ 4. å»ºç«‹ä¸€ä¸ªè¿›åº¦æ¡ view
    [self.view addSubview:({
        self.webProgreess = [[UIProgressView alloc] initWithFrame:CGRectMake(0, 99, self.view.frame.size.width, 30) ];
        self.webProgreess;
    })];
}

+++++

//  åŠ ä¸€ä¸ªå›è°ƒ 2. æ³¨å†Œä¸€ä¸ªkvoäº‹ä»¶ ,æ–¹æ³•ä»addObserverjupmToè¿›æ¥çš„
- (void)observeValueForKeyPath:(nullable NSString *)keyPath ofObject:(nullable id)object change:(nullable NSDictionary<NSKeyValueChangeKey, id> *)change context:(nullable void *)context {
    //    KVOè®¾ç½®ä¸€ä¸ªè¿›åº¦æ¡ 5. ç»™è¿›åº¦æ¡ view è®¾ç½®å€¼
    self.webProgreess.progress = self.webView.estimatedProgress;
};

//  3. é”€æ¯çš„æ—¶å€™ç§»é™¤ç›‘å¬
-(void)dealloc {
    [self.webView removeObserver:self forKeyPath:@"estimatedProgress"];
};


@end

```



## ä¸€äº›é€šç”¨çš„æ¡†æ¶å±‚çš„å°è£…
### ç†è®ºçŸ¥è¯†
å®é™…ä¸Šè¿™äº›ä¸œè¥¿ å°±æ˜¯åœ¨UIViewControllerä¸Šæ¶äº†ä¸€å±‚çš„äº¤äº’è€Œå·²ï¼Œ<font style="color:#E8323C;">ä½†æ˜¯Flutterä¸ä¸€æ ·Flutter æœ‰è‡ªå·±çš„æ¸²æŸ“å™¨</font>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636389041739-62cf46c2-6cf4-4395-a13c-8ee27645f9df.png)

# åŠ¨ç”»ä½¿ç”¨
> åœ¨IOSä¸­åŠ¨ç”»æ˜¯æ¯”è¾ƒé‡è¦çš„
>

## åŸºç¡€çŸ¥è¯†IOSä¸­çš„åŠ¨ç”»
å®é™…ä¸ŠåŠ¨ç”»åœ¨IOSä¸­ç”¨çš„æ˜¯ä¸€ä¸ªå«åšCore Animationå®ç°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨çš„æ—¶å€™ç”¨çš„æ˜¯ä¸Šå±‚å°è£…

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636470826145-f4cf0f94-e4eb-4c37-bf01-71199bbc8d48.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636470991867-93a6455d-9152-44c4-a861-eb465479eb99.png)

UIViewæä¾›çš„animationæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œä½†æ˜¯å¯¹äºä¸­é—´çŠ¶æ€çš„æ§åˆ¶æ˜¯æ§åˆ¶ä¸åˆ°çš„

## å®è·µæŒ‡å—
> æˆ‘ä»¬çš„ç›®æ ‡å¦‚ä¸‹ï¼šä½¿ç”¨UIView å’Œä¸¤ç§Classé€šä¿¡æ–¹å¼ï¼ˆdelegate è®¾è®¡æ¨¡å¼  bolockè®¾è®¡æ¨¡å¼ï¼‰ + animation å®ç°ä¸€ä¸ªåŠ¨ç”»ï¼Œï¼ˆå…¨å±€çš„å¼¹å‡ºå±‚ï¼‰ï¼ˆå®ç°ä¸€ä¸ªè·Ÿéšç‚¹å‡»ä½ç½®çš„å¼¹å‡ºæ¡†ï¼‰ï¼ˆå®ç°åˆ é™¤cellçš„é€»è¾‘ï¼‰ï¼ˆå¤„ç†å¾ªç¯å¼•ç”¨ï¼‰
>

ä¸‹é¢çš„ä»£ç æœ‰ç‚¹å¾—å¤šï¼Œæˆ‘ä»¬è¿™é‡Œç”»äº†ä¸€ä¸ªå›¾ æ–¹ä¾¿å¤§å®¶ç†è§£ å·²ç»å­¦ä¹ å’Œè®°å¿†



1. å…ˆæŠŠæŒ‰é’®çš„class å’Œ é¡µé¢çš„viewContlor è¿›è¡Œé€šä¿¡ ï¼ˆä½¿ç”¨Delegateæ¨¡å¼ã€‚æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªDelegateï¼‰

```objectivec
## 1. åœ¨CGPtTableViewCell.H å’Œ.m ä¸­å…ˆå£°æ˜å·²ç»å®ç°
//
//  CGPtTableViewCell.h
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/10/23.
//

#import <UIKit/UIKit.h>

NS_ASSUME_NONNULL_BEGIN


//  è‡ªå®šä¹‰delegate 1ï¼Œå£°æ˜è¿™ç§å±æ€§
@protocol CGPtTableViewCellDelegate <NSObject>
- (void)tabViewCell: (UITableViewCell *)tabViewCell clickDeleteButton:(UIButton *)delegateButton;
@end



@interface CGPtTableViewCell : UITableViewCell
//  è‡ªå®šä¹‰delegate 2ï¼ŒåŸæ¥çš„ç±»ä¸Š åŠ ä¸Šè¿™ä¸ªå±æ€§ weakç±»å‹å“ˆ
@property(nonatomic, weak, readwrite) id<CGPtTableViewCellDelegate> delegate;
- (void) layoutInitCell;
@end

NS_ASSUME_NONNULL_END



.mæ–‡ä»¶
++++
- (void) myButtonClick {
//  åŠ è¿™æ®µåˆ¤æ–­çš„åŸå› æ˜¯ï¼šæˆ‘ä»¬çš„è‡ªå®šä¹‰çš„Delegateæ˜¯éå¿…é€‰çš„ï¼Œä¸ºäº†é¿å…æŠ¥é”™éœ€è¦è¿™æ ·æ¥å…œåº•å¤„ç†
    if(self.delegate && [self.delegate respondsToSelector:@selector(tabViewCell:clickDeleteButton:)]  ) {
        [self.delegate tabViewCell:self clickDeleteButton:self.myButton];
    }
}


## 2. åœ¨viewControllerä¸­ä½¿ç”¨Delegate å¹¶ä¸”å®ç°å…¶æ–¹æ³•ï¼Œåˆ«å¿˜è®°å»å¼•ç”¨å¤´æ–‡ä»¶
++++

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    
    CGPtTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"id"];
    if ( !cell ) {
        cell = [[CGPtTableViewCell alloc] initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:@"id"];
        cell.delegate = self; // æ‹¿åˆ°ä¸€ä¸ªdelegateã€é‡ç‚¹ã€‘
    }
    
    [cell layoutInitCell];
//    cell.textLabel.text =  [NSString stringWithFormat:@"ä¸»æ ‡é¢˜ - %@",@(indexPath.row)];
//    cell.detailTextLabel.text = @"å‰¯æ ‡é¢˜";
//    cell.imageView.image = [UIImage imageNamed:@"icon.bundle/video.png"];
    return cell;
};

//  å®ç°è‡ªå®šä¹‰çš„Delegate ã€é‡ç‚¹ã€‘
- (void)tabViewCell: (UITableViewCell *)tabViewCell clickDeleteButton:(UIButton *)delegateButton {
    NSLog(@"");
};
```



2. ç„¶åæˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªå¼¹å‡ºæ¡†

åˆ›å»ºæ–‡ä»¶çš„éƒ¨åˆ†çœç•¥

```objectivec
## 1. åˆ›å»ºä¸€ä¸ª ç‹¬ç«‹çš„æ–‡ä»¶è¡¨ç¤ºæµ®å±‚ ç»„ä»¶ ä¸‹é¢åˆ†åˆ«æ˜¯.m å’Œ.h
//
//  GTDeleteCellView.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/10.
//

#import "GTDeleteCellView.h"

@interface GTDeleteCellView ()
@property(nonatomic, strong, readwrite) UIView *backView;
@property(nonatomic, strong, readwrite) UIButton *deletButton;
@end



@implementation GTDeleteCellView

-(instancetype) initWithFrame:(CGRect) frame {
    
    self = [super initWithFrame:frame];
    
    if(self) {
        [self addSubview:({
            _backView = [[UIView alloc] initWithFrame:self.bounds];
            _backView.backgroundColor = [UIColor blackColor];
            _backView.alpha = 0.6;
            
//            åˆ«å¿˜è®°ç‚¹å‡»maskè¦æ·»åŠ æ‰‹åŠ¿çš„
            [_backView addGestureRecognizer:({
                UITapGestureRecognizer *tapGesture = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(dismissDeleteView)];
                tapGesture;
            })];
            
            _backView;

        })];
        
        [self addSubview:({
            _deletButton = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 200, 200)];
            [_deletButton addTarget:self action:@selector(_clickButton) forControlEvents:UIControlEventTouchUpInside];
            _deletButton.backgroundColor = [UIColor blueColor];
            _deletButton;
        })];
    }
    return  self;
}

// å®ç°æ–¹æ³•
- (void)_clickButton {
    [self removeFromSuperview];
}

- (void)showDeletView {
    [[UIApplication sharedApplication].keyWindow addSubview:self];
}

- (void)dismissDeleteView {
    [self removeFromSuperview];
}
@end


//
//  GTDeleteCellView.h
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/10.
//

#import <UIKit/UIKit.h>

NS_ASSUME_NONNULL_BEGIN

@interface GTDeleteCellView : UIView
- (void)showDeletView;
@end

NS_ASSUME_NONNULL_END



## 2. ç‚¹å‡»çš„æ—¶å€™è°ƒç”¨å®ƒviewControlleré‡Œ
+++
//  å®ç°è‡ªå®šä¹‰çš„Delegate
- (void)tabViewCell: (UITableViewCell *)tabViewCell clickDeleteButton:(UIButton *)delegateButton {
    GTDeleteCellView *deletViewDialog = [[GTDeleteCellView alloc] initWithFrame:self.view.bounds];
    [deletViewDialog showDeletView];
};



```

3. å®ç°ä¸€ä¸ªè·Ÿéšä½ç½®çš„å¼¹å‡ºå±‚

```objectivec
ç‚¹å‡»è“è‰²æŒ‰é’®éœ€è¦ä¸ViewCOntrolleré€šä¿¡ï¼Œå› ä¸ºå±•ç¤ºDiloagçš„é€»è¾‘æ˜¯åœ¨ViewControllerä¸­çš„ï¼Œæ‰€ä»¥ä½ è¿™ä¸ªå…³é—­ä¹Ÿæ˜¯åœ¨ViewControllerä¸­æ‰å¯¹

## 1. Dialogçš„.m æ–‡ä»¶ä¸­ï¼ˆä¹Ÿå°±ä¸Šæ–‡çš„GTDeleteCellView ï¼‰æŠŠ showæ–¹æ³•é€»è¾‘æ”¹ä¸€ä¸‹åŠ ä¸€ä¸ªåŠ¨ç”»ï¼ŒåŠ ä¸€ä¸ªbolockçš„æŒæœ‰é€»è¾‘(è¿™ä¸ªä¸œè¥¿å°±æƒ³ä¼ é€’äº†ä¸€ä¸ªå¼•ç”¨è¿›æ¥ æœ‰äº†åˆ«äººçš„å¼•ç”¨ä½ å°±èƒ½æ“ä½œåˆ«äººçš„ä¸œè¥¿)
++++
@interface GTDeleteCellView ()
@property(nonatomic, strong, readwrite) UIView *backView;
@property(nonatomic, strong, readwrite) UIButton *deletButton;
@property(nonatomic, copy, readwrite) dispatch_block_t delteBlock;
@end
++++
- (void)showDeletView:(CGPoint)point clickBlock:(dispatch_block_t) clickBlock{
    _deletButton.frame = CGRectMake(point.x, point.y, 0, 0)
        
    _delteBlock = [clickBlock copy];  // ç‚¹å‡»çš„æ—¶å€™æŒæœ‰è¿™ä¸ªBlock è¿™ä¸ªä¸œè¥¿å°±åƒä¸€ä¸ªå›è°ƒå‡½æ•°ä¸€æ · å…³é—­ä¹‹åè§¦å‘ è§ä¸‹é¢çš„dismissDeleteViewä¸­ 
    
    
    [[UIApplication sharedApplication].keyWindow addSubview:self];
    
//    é«˜çº§åŠ¨ç”»çš„ é€šè¿‡blockçš„æ–¹æ³• æ¥è¿›è¡ŒClassä¹‹é—´çš„é€šä¿¡
    [UIView animateWithDuration:1.f delay:0.f usingSpringWithDamping:0.5 initialSpringVelocity:0.5 options:UIViewAnimationOptionCurveEaseInOut animations:^{
            self.deletButton.frame = CGRectMake((self.bounds.size.width - 200) / 2, (self.bounds.size.height - 200) / 2, 200, 200);
        } completion:^(BOOL finished){
            NSLog(@"åŠ¨ç”»ç»“æŸäº†");
        }];
}

- (void)dismissDeleteView {
    [self removeFromSuperview];
    if(_delteBlock) {
        _delteBlock();
    }
}

+++
## .hæ–‡ä»¶ä¸­éœ€è¦æš´éœ²å‡ºå»
    @interface GTDeleteCellView : UIView
- (void)showDeletView:(CGPoint)point clickBlock:(dispatch_block_t) clickBlock;
@end

## 2.ä½¿ç”¨çš„æ—¶å€™å°±æ¯”è¾ƒçš„ç®€å• viewContialrä¸­
+++
- (void)tabViewCell: (UITableViewCell *)tabViewCell clickDeleteButton:(UIButton *)delegateButton {
    GTDeleteCellView *deletViewDialog = [[GTDeleteCellView alloc] initWithFrame:self.view.bounds];
    
//    æŠŠç‚¹å‡»ä½ç½®çš„åæ ‡ç³»è¿›è¡Œè½¬åŒ–è½¬åˆ°è‡ªå·±çš„çˆ¶å®¹å™¨ä¸­
    CGRect rect = [tabViewCell convertRect:delegateButton.frame toView:nil];
    [deletViewDialog showDeletView:rect.origin clickBlock:^{
        NSLog(@"99");
    } ];
};
    



```



4. å®ç° åˆ é™¤åˆ—è¡¨çš„itemçš„é€»è¾‘ï¼ˆå®ç°çš„è¿‡ç¨‹ä¸­ä¼šè§£å†³ä¸€ä¸ªå¾ªç¯å¼•ç”¨çš„ä¸€ä¸ªé—®é¢˜ï¼‰

```objectivec
## ä¸‹é¢çš„é€»è¾‘å…¨éƒ¨åœ¨VIewControllerä¸­å®ç°ï¼Œå› ä¸ºè¿™ä¸ªlistå°±æ˜¯ViewControllerçš„

# 1.æŠŠåŸæ¥å†™æ­»çš„20item æ¢æˆä¸€ä¸ªArray å¹¶ä¸”åœ¨initçš„æ—¶å€™åˆå§‹åŒ–å®ƒ
+++++
@interface ViewController ()<UITableViewDataSource, UITableViewDelegate, CGPtTableViewCellDelegate>
// æŠŠtabViewå˜æˆä¸€ä¸ªå±æ€§
@property(nonatomic, strong, readwrite) UITableView *tabView;
// æŠŠåŸæ¥çš„ä¸ªæ•°å˜æˆä¸€ä¸ªæ•°ç»„   å› ä¸ºå¾…ä¼šåˆ é™¤çš„æ—¶å€™æ˜¯ä¸€ç‚¹ç‚¹çš„pop
@property(nonatomic, strong, readwrite) NSMutableArray *dataArray;
@end

@implementation ViewController

- (instancetype)init{
    self = [super init];
    if(self){
        //    åˆå§‹åŒ–ç»™æ•°ç»„åŠ 20
        _dataArray = @[].mutableCopy;
        for (int i = 0; i < 20; i++) {
            [_dataArray addObject:@(i)];
        }
    }
    return self;
};
+++++
## 2. ç»™åŸæ¥çš„ä¸œè¥¿æŠŠ20 å†™æ­»çš„é¢æ”¹æ‰
    - (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return _dataArray.count;
};

+++++

## 3. å¢åŠ åˆ é™¤çš„é€»è¾‘
- (void)tabViewCell: (UITableViewCell *)tabViewCell clickDeleteButton:(UIButton *)delegateButton {
    GTDeleteCellView *deletViewDialog = [[GTDeleteCellView alloc] initWithFrame:self.view.bounds];
    
    //    å¤„ç†å¾ªç¯å¼•ç”¨
    __weak typeof (self) weself = self;
    //    æŠŠç‚¹å‡»ä½ç½®çš„åæ ‡ç³»è¿›è¡Œè½¬åŒ–è½¬åˆ°è‡ªå·±çš„çˆ¶å®¹å™¨ä¸­
    CGRect rect = [tabViewCell convertRect:delegateButton.frame toView:nil];
    [deletViewDialog showDeletView:rect.origin clickBlock:^{
        __strong typeof(self) strongSelf = weself;
        //    åˆ é™¤Itemçš„é€»è¾‘
        [strongSelf.dataArray removeLastObject];
        [strongSelf.tabView deleteRowsAtIndexPaths:@[[strongSelf.tabView indexPathForCell:tabViewCell]] withRowAnimation:UITableViewRowAnimationAutomatic];
    }];
    
};
```

## CALayer
### ç†è®ºçŸ¥è¯†
å®ƒæ˜¯ä¸€ä¸ªç±» ï¼Œç”¨æ¥æ”¯æ’‘åŠ¨ç”»ä¹Ÿæ˜¯æ”¯æ’‘ç•Œé¢ç»˜åˆ¶çš„ä¸€ä¸ªç±»ï¼Œé™¤å»CALayer è¿˜æ˜¯å„ç§çš„Layerä»–ä»¬åœ¨IOSä¸­éƒ½æ˜¯ç”¨äºåº•å±‚æ¸²æŸ“å’ŒGUIç»˜åˆ¶ï¼Œä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹CALayerä¹Ÿæ˜¯æ¯”è¾ƒçš„ å¥½çš„ ä½†æ˜¯ç¼ºç‚¹å°±æ˜¯åœ¨Xcodeçš„è‡ªå®šä¹‰çš„ç»˜åˆ¶Debugerçš„æ—¶å€™çœ‹ä¸åˆ°ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯ä¸ä¼šè‡ªæ¥ç”¨å“ˆã€‚

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636559883079-8e9376eb-895e-4520-83c4-8318b08ac212.png)

ä¸€èˆ¬æ¥è¯´ä¸ä¼šç›´æ¥å¼€å‘è€…å»ä½¿ç”¨CALayer

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636559971656-50486577-a187-49cc-a6dc-bda92c27f890.png)

### å®æˆ˜æŒ‡å—
1.æŠŠåˆ é™¤çš„æŒ‰é’®å˜æˆåœ†è§’çš„ å†æ”¹ä¸€ä¸ªè¾¹æ¡†

```objectivec
## CGPtTableViewCell.m æ–‡ä»¶ä¸­
++++
//        è¿™é‡Œæˆ‘ä»¬æ¥åŠ ä¸€ä¸ªUIButton
        [self.contentView addSubview:({
            self.myButton = [[UIButton alloc] initWithFrame:CGRectMake(260, 35, 30, 30)];
            [self.myButton setTitle:@"X" forState:UIControlStateNormal];
            [self.myButton setTitle:@"V" forState:UIControlStateHighlighted];
            self.myButton.backgroundColor = [UIColor systemBlueColor];
//            æ·»åŠ ä¸€ä¸ªäº‹ä»¶
            [self.myButton addTarget:self action:@selector(myButtonClick) forControlEvents:UIControlEventTouchUpInside];
            
//            å®ç°åœ†è§’
            self.myButton.layer.cornerRadius = 10 ;
            self.myButton.layer.masksToBounds = YES ;
            self.myButton.layer.borderColor = [UIColor lightGrayColor ].CGColor;
            self.myButton.layer.borderWidth = 2;
            self.myButton;
        })];
```

## CoreAnimation
è¿™ä¸ªæ˜¯ä¸€ä¸ªç±»ä¸‹é¢è¿˜æœ‰å¾ˆå¤šçš„å­ç±»ï¼Œç”¨äºå®ç°ä¸€äº› â€œå¼ºè¿«ç—‡â€çš„åŠ¨ç”»ã€‚ä½†æ˜¯ç”¨UIVIiewå°±è¶³å¤Ÿäº†ï¼Œä½†å¦‚æœä½ ç¡¬è¦ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ï¼Œä¸‹é¢çš„åˆ—å‡ ä¸ª å¸¸ç”¨çš„

### ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636560929784-46f371a3-1328-44b6-b0c1-5a75fc20f0a2.png)

![ç”»æ¿](https://cdn.nlark.com/yuque/0/2021/jpeg/1627571/1636561018288-daf50286-18fb-420f-a3bb-609f2dc6c08d.jpeg)

æ›´å¤šçš„åŠ¨ç”» å¯ä»¥å»çœ‹å¼€æºçš„ä¸€äº›ä¸œè¥¿ã€‚ä¸šç•Œä¸»æµå¼€å‘æ–¹å‘æœ‰å“¦ä¸¤ä¸ª

  1. å°è£…IOSç³»ç»Ÿæä¾›çš„

2. è‡ªæ¥è‡ªæ¥å†™æ›´åº•å±‚çš„å®ç°

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636561026280-b628d6d0-e842-434b-81a4-2f0b09b89137.png)

# ä»£ç è§„èŒƒå’Œé‡æ„
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636724051866-baa14a3d-39db-432a-9b93-50223f632e0a.png)

ä¸»è¦æ˜¯ä»¥ä¸‹é¢çš„ä¸‰ä¸ªç»´åº¦æ¥è¿›è¡Œé‡æ„ï¼š

æ‰¹é‡ä¿®æ”¹ rename

æ³¨é‡Šæœ‰è®²ç©¶ h å¤´æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªç±» åº”è¯¥æ³¨é‡Šéœ€è¦å®ç°ä»€ä¹ˆæ ·çš„åŠŸèƒ½  å¯¹äºæ–¹æ³•æ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·çš„ æœ€å¥½æ˜¯ä¸å†™æ³¨é‡Š

å¦‚ä½•æ”¶é½æ–¹æ³•å’Œç±»ï¼Ÿ

ä¸€é”®é‡å‘½å





å…³äºå‘½åï¼Ÿ

è¯­è¨€æ¸…æ™°å°±å¤Ÿäº†

ä¸éœ€è¦çš„ä¸œè¥¿æ³¨é‡Š





æ–‡ä»¶å¤¹çš„ç»“æ„ä»æ–°å½’ç±»



# ç½‘ç»œè¯·æ±‚
## ç”¨ä¸€ä¸‹è¯•è¯•çœ‹
### ç†è®ºçŸ¥è¯†
> äº‹ä»¶ä¸ŠNSURLå°±æ˜¯å¯¹ è¯·æ±‚stringçš„å°è£…å°±åƒajax å¯¹XHttpRequeçš„å°è£…
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636725506140-7d1d47ff-d030-4aff-99ad-ad823c401a51.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636725612061-a701080d-e35c-4934-b438-7b240c64c098.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636725655440-542c9e15-38bb-4cb9-acd6-df6a62f064ad.png)

### å®æˆ˜æŒ‡å—
> ä¸‹é¢æˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªHttpè¯·æ±‚ä½“ ï¼ˆæš‚æ—¶ä¸å‘åªæ˜¯åˆ›å»ºå®ƒï¼‰
>
> 
>

```objectivec
# æˆ‘ä»¬æ–°å»ºç«‹äº†ä¸€ä¸ªæ–‡ä»¶Loadçš„æ–‡ä»¶å¤¹ä¸‹é¢çš„loaderå°±æ˜¯å’ŒæœåŠ¡å™¨æ‰“äº¤é“çš„ä¸€ä¸ªä¸­é—´å±‚

.h
//
//  GTListLoader.h
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/12.
//

#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

///  åˆ—è¡¨è¯·æ±‚
@interface GTListLoader : NSObject
- (void) loadListData;
@end

NS_ASSUME_NONNULL_END


.m
//
//  GTListLoader.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/12.
//

#import "GTListLoader.h"

@implementation GTListLoader

- (void)loadListData{
    //    1.ç”Ÿæˆä¸€ä¸ªè¯·æ±‚ URLå¯¹è±¡ NSURLå¯¹è±¡
    NSString *urlStr = @"http://yapi.smart-xwork.cn/mock/48537/test/api/project/get";
    //    2.å‘é€ä¸€ä¸ªè¯·æ±‚ ä½¿ç”¨ä¸€ä¸ªNSURLRequest å¯¹è±¡
    NSURL *listURl = [NSURL URLWithString:urlStr];
        
    //    2.å‘é€ä¸€ä¸ªè¯·æ±‚ ä½¿ç”¨ä¸€ä¸ªNSURLRequest å¯¹è±¡ è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªRequestäº† ä½ å¯ä»¥æ¥è®¾ç½®å®ƒçš„æ›´å¤šçš„ä¸œè¥¿
    __unused NSURLRequest *listRequesst = [NSURLRequest requestWithURL:listURl];
    NSLog(@"");
};

@end


## åœ¨åŸæ¥çš„liståˆ—è¡¨ä¸­åˆå§‹åŒ–çš„æ—¶å€™ä½¿ç”¨å®ƒ

#import "NewsController.h"
#import "CGPtTableViewCell.h"
#import "GTDeleteCellView.h"
#import "WebViewViewController.h"
#import "GTListLoader.h"


@interface NewsController ()<UITableViewDataSource, UITableViewDelegate, CGPtTableViewCellDelegate>
// æŠŠtabViewå˜æˆä¸€ä¸ªå±æ€§
@property(nonatomic, strong, readwrite) UITableView *tabView;
// æŠŠåŸæ¥çš„ä¸ªæ•°å˜æˆä¸€ä¸ªæ•°ç»„   å› ä¸ºå¾…ä¼šåˆ é™¤çš„æ—¶å€™æ˜¯ä¸€ç‚¹ç‚¹çš„pop
@property(nonatomic, strong, readwrite) NSMutableArray *dataArray;
@property(nonatomic, strong, readwrite) GTListLoader *listLoader;
@end

@implementation NewsController

++++
- (void)viewDidLoad {
++++
//    å¼€å§‹å»åŠ è½½çœŸå®çš„ç½‘ç»œæ•°æ®
    self.listLoader = [[GTListLoader alloc] init];
    [self.listLoader loadListData];
}
```

è°ƒè¯•å°æŠ€å·§ æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨çš„å»éšæ—¶çš„æ‰“æ—¥å¿— å“ˆå“ˆå“ˆ ç§’

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636727933013-80660865-b859-4ec1-891e-0b2c06cf577c.png)

## å‡†å¤‡å‘é€çœŸæ­£çš„è¯·æ±‚
ä»è¿™é‡Œå¼€å§‹æˆ‘ä»¬å°±æ¶‰åŠåˆ° å¼‚æ­¥å’Œå¹¶å‘é—®é¢˜äº†

### ç†è®ºçŸ¥è¯†


![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636728017045-52ea315b-4401-4854-9a27-cfcb0a3a7a15.png)



NSURLSessionå°±åƒä¸€ä¸ªè¯·æ±‚ç»„ç»Ÿä¸€è°ƒåº¦å’Œç®¡ç†

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636728222676-9d4962bb-ed23-4549-aaa4-45432caec753.png)

ä¸‹é¢çš„å°±æ˜¯NSURlSession å°±æ˜¯ä¸€ä¸ª å•ä¾‹äº†

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636728300388-2b94ec27-719f-4cd7-9aaf-48765d2d51e5.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636728355579-140d9d75-6c06-4cac-94ed-7508021b4143.png)

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨NSURLSessionTask è¿™åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½æ˜¯å¤Ÿç”¨çš„

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636728667403-99f16293-a323-476f-9103-eb97b7a87f32.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636728771715-32af6da9-e809-4eb2-aae4-c61eb2862005.png)

**<font style="color:#E8323C;">ä½ éœ€è¦è§£å¼€éHTTPSçš„è¯·æ±‚åœ¨IOS9 ä¹‹åé»˜è®¤å¼ºåˆ¶éƒ½è¦Https</font>**

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1636728901070-1b554ab5-33e5-496c-8bc3-7edd59325ca1.png)

### å®è·µæŒ‡å¯¼
```objectivec
//
//  GTListLoader.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/12.
//

#import "GTListLoader.h"

@implementation GTListLoader

- (void)loadListData{
    //    1.ç”Ÿæˆä¸€ä¸ªè¯·æ±‚ URLå¯¹è±¡ NSURLå¯¹è±¡
//    NSString *urlStr = @"http://yapi.smart-xwork.cn/mock/48537/test/api/project/get";
    NSString *urlStr = @"http://www.tianqiapi.com/api?version=v1&appid=23035354&appsecret=8YvlPNrz";
    //    2.å‘é€ä¸€ä¸ªè¯·æ±‚ ä½¿ç”¨ä¸€ä¸ªNSURLRequest å¯¹è±¡
    NSURL *listURl = [NSURL URLWithString:urlStr];
        
    //    3.å‘é€ä¸€ä¸ªè¯·æ±‚ ä½¿ç”¨ä¸€ä¸ªNSURLRequest å¯¹è±¡ è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªRequestäº† ä½ å¯ä»¥æ¥è®¾ç½®å®ƒçš„æ›´å¤šçš„ä¸œè¥¿
    __unused NSURLRequest *listRequesst = [NSURLRequest requestWithURL:listURl];
//    4. è®¾ç½®seesion
    NSURLSession * sessionx = [NSURLSession sharedSession];
//    5. åˆ›å»ºTask
    NSURLSessionDataTask *dataTask1 = [sessionx dataTaskWithRequest:listRequesst completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
        NSLog(@"");
    }]; // è¿™ä¸ªNSURLSessionDataTask å±äºsession1ä¸‹çš„ session1æ˜¯ä¸€ä¸ªå•ä¾‹
    
    // 6 å‘èµ·
    [dataTask1 resume];
    
    NSLog(@"");
};

@end

```

## å¤ªéº»çƒ¦äº†æœ‰æ²¡æœ‰ç±»ä¼¼å‰ç«¯fetch æˆ–è€…axiosçš„ä¸œè¥¿ï¼Ÿ
> è¿™ç§ä¸œè¥¿æ˜¯æœ‰çš„ï¼Œåœ¨IOSä¸­çš„å¯ä»¥çš„ ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹çœ‹ è¿™æ ·çš„ä¸€ä¸ªä¸œè¥¿ NSNetWorkingï¼Œ
>
> åœ¨IOSå¼€å‘ä¸­ï¼Œè¿™äº›é›†æˆè¿›æ¥çš„ä¸œè¥¿ï¼Œé€šå¸¸ä¸ºï¼šxxxæ¡†æ¶ã€‚    
>



### ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637076040840-fa70b439-8790-4c10-94ce-252bfa69d5d2.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637167134743-c1875bca-6ff6-41f8-b4fe-ee990ca702fe.png)

ä¸€èˆ¬æ¥è¯´ å¦‚æœä½ éœ€è¦é›†æˆæŸä¸ªå¼€æºçš„æ¡†æ¶ï¼Œä½ å§ä¸‹è½½ä¸‹æ¥çš„å¼€æºæ¡†æ¶ï¼ˆå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„Projectï¼‰æŠŠå®ƒ æ‹–æ‹½åˆ°è‡ªå·±çš„é¡¹ç›®workSpaceå°±å¥½äº†ã€

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637167273628-30e76b1b-a952-4adf-812d-05ed40de05fe.png)

cocapods å°±æ˜¯è¿™ç§ ç±»ä¼¼äºä¸€ä¸ªnpm ï¼Œä¸»è¦åŠŸèƒ½å°±æ˜¯å¯ä»¥æŠŠå¤šä¸ª projectåˆæˆä¸€ä¸ªworkSpace



![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637167332689-10126ab0-052c-463a-ae8d-b7901713be35.png)







å®ƒè¿™ä¸ªä¸œè¥¿å°±æ˜¯ ç±»ä¼¼npm  ï¼Œä¸»è¦æ˜¯åšä¸¤ä»¶äº‹ 1. ä¸‹è½½ä»£ç ç‰‡æ®µ 2. åˆå¹¶æˆä¸€ä¸ªPods æœ€ååˆå¹¶åˆ° è‡ªå·±çš„é¡¹ç›® worksapce é‡Œå»

### å®æˆ˜æŒ‡å—


// å‰ç½®å®‰è£…

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637168202771-d858398a-8edb-4520-b4db-96960495bef2.png)





é¦–å…ˆæˆ‘ä»¬è¦æš‚æ—¶çš„å…ˆå…³é—­ Xcodeï¼Œåœ¨é¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œå†™ä¸€ä¸ªpodfile æ–‡ä»¶ï¼ˆè¿™ä¸ªä¸œè¥¿å°±æ˜¯OC Cocapadçš„åŒ…ç®¡ç†æ–‡ä»¶ ç±»å±äºå‰ç«¯å¾—packag.jsonï¼‰

```tsx
target 'SimpelApp' do 
  pod 'AFNetworking'   // è¿™ä¸ªå°±æ˜¯ä½ çš„åŒ…
end
```



ç„¶åæˆ‘ä»¬è¿›å…¥æ§åˆ¶å° è¿è¡Œä¸‹é¢çš„å‘½ä»¤( å‰æƒ…æç¤ºï¼Œå¦‚æœä½ ä¸çŸ¥é“pod xxx è¿™äº›ä¸œè¥¿ é‚£ä¹ˆä½ æœ€å¥½å»çœ‹çœ‹cocapadçš„æ–‡æ¡£  )

```shell
pod install 
# è¿™ä¸ªæ‰§è¡Œå®Œæ¯•ä¹‹åå°±ä¼šå¾—å‡ºæƒ³çš„æ–‡ä»¶å¤¹ç»“æ„
Podif.lock 
# è¿™ä¸ªæ–‡ä»¶æ˜¯è¿è¡Œä¸Šè¿°å‘½ä»¤åç”Ÿæˆçš„ï¼Œä¸»è¦æ˜¯å¤šäººå¼€å‘çš„æ—¶å€™é”å®šç‰ˆæœ¬ğŸ”’
```

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637592455097-ac492f3a-62a1-4d92-a32f-22c717516fc3.png)

å®ƒå®é™…ä¸Šçš„åšäº‹æƒ…å°±æ˜¯ ï¼Œå§åŸæ¥çš„é¡¹ç›® ç»“åˆ cocapad ç»“åˆåœ¨ä¸€èµ·ç”Ÿæˆä¸€ä¸ªæ–°çš„å·¥ä½œåŒº ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å†æ¬¡æ‰“å¼€çš„æ—¶å€™åº”è¯¥ç‚¹å‡»wcworlsapce æ–‡ä»¶å¤¹è€Œä¸æ˜¯åŸæ¥çš„codeprojå·¥ä½œåŒº

æˆ‘ä»¬çš„ç¬¬ä¸‰æ–¹çš„å¼€æºå·¥å…· å°±æ˜¯åœ¨Podsæ–‡ä»¶å¤¹ä¸­

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637592546155-c3240627-4ead-4e7a-aecc-32dde33be45d.png)

å†ä¹‹åå‘¢ï¼Œæˆ‘ä»¬å°±ä»¥å‰ç«¯å¾—æ–¹æ³•å»å¼•å…¥æ–‡ä»¶å°±å¥½äº†

/loader/GTlist.m

```objectivec
//
//  GTListLoader.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/12.
//

#import "GTListLoader.h"
#import "AFNetworking.h"  // è¿™ä¸ªå°±æ˜¯ä½ çš„åŒ…

@implementation GTListLoader

- (void)loadListData{
    //    1.ç”Ÿæˆä¸€ä¸ªè¯·æ±‚ URLå¯¹è±¡ NSURLå¯¹è±¡
//    NSString *urlStr = @"http://yapi.smart-xwork.cn/mock/48537/test/api/project/get";
    NSString *urlStr = @"http://www.tianqiapi.com/api?version=v1&appid=23035354&appsecret=8YvlPNrz";
    NSURL *listURl = [NSURL URLWithString:urlStr];
    
    
    //    2.å‘é€ä¸€ä¸ªè¯·æ±‚ ä½¿ç”¨ä¸€ä¸ªNSURLRequest å¯¹è±¡ è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªRequestäº† ä½ å¯ä»¥æ¥è®¾ç½®å®ƒçš„æ›´å¤šçš„ä¸œè¥¿
    __unused NSURLRequest *listRequesst = [NSURLRequest requestWithURL:listURl];
//    3. è®¾ç½®seesion
    NSURLSession * sessionx = [NSURLSession sharedSession];
//    4. åˆ›å»ºTask
    NSURLSessionDataTask *dataTask1 = [sessionx dataTaskWithRequest:listRequesst completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
        NSLog(@"");
    }]; // è¿™ä¸ªNSURLSessionDataTask å±äºsession1ä¸‹çš„ session1æ˜¯ä¸€ä¸ªå•ä¾‹
    
    // 5 å‘èµ·
    [dataTask1 resume];
    
    NSLog(@"");
    
//    ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶ ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶å°±æ–¹ä¾¿äº†å¾ˆå¤š
    [[AFHTTPSessionManager manager] GET: @"http://www.tianqiapi.com/api?version=v1&appid=23035354&appsecret=8YvlPNrz" parameters:nil headers:nil progress:^(NSProgress * _Nonnull downloadProgress) {
        NSLog(@"");
    } success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {
        NSLog(@"");
    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
        NSLog(@"");
    }];
};

@end

```



ä»¥ä¸Šå°±æ˜¯å¦‚ä½•ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶çš„è¯´æ˜ ï¼Œå…¶ä»–ç±»å‹çš„æ¡†æ¶éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯è¿™æ ·å»ç”¨å°±å¥½äº†

## 
# JSONæ•°æ®å¦‚ä½•è§£æï¼Ÿ
> ä¸Šè¯‰æˆ‘ä»¬ä»¥åŠè·å–åˆ°äº†æ•°æ®ï¼Œç°åœ¨æˆ‘ä»¬è€ƒè™‘å¦‚ä½•è§£æå®ƒï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†çš„è¯´æ˜äº†
>

## ç†è®ºæŒ‡å¯¼å¿«é€Ÿä¸Šæ‰‹
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637592923250-45733181-7d23-4864-8e1a-2b0241ff5c98.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637593196538-2ddf34e4-9182-44c2-ab69-5f9c0baf5745.png)



é‚£ä¹ˆæˆ‘ä»¬å…ˆç¹ä¸ºå¿«ï¼Œçœ‹çœ‹å¦‚ä½•å†™è¿™ä¸ªä»£ç 

```objectivec
//
//  GTListLoader.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/12.
//

#import "GTListLoader.h"

@implementation GTListLoader

- (void)loadListData{
+++++

    NSURLSessionDataTask *dataTask1 = [sessionx dataTaskWithRequest:listRequesst completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
        NSError *jsonError;
        id jsonObj = [NSJSONSerialization JSONObjectWithData:data options:0 error:&jsonError];
        
        NSLog(@"");
    }]; // è¿™ä¸ªNSURLSessionDataTask å±äºsession1ä¸‹çš„ session1æ˜¯ä¸€ä¸ªå•ä¾‹
    
    [dataTask1 resume];
    NSLog(@"");
};

@end

```

ç„¶åæˆ‘ä»¬æ‰“ä¸ªæ–­æ‰è°ƒè¯•ä¸€ä¸‹å°±å˜æˆè¿™æ ·äº†

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637593626758-f98256e1-ac23-4d0e-ba6e-c443d8cfde3e.png)



## åŸºäºModelçš„æ•°æ®æµå¤„ç†
> æ„æ€æ˜¯æŠŠJSONç»™åŒ…è£…æˆOcçš„Object è¿™ç§ç»“æ„åŒ–çš„ä¹¦ç±
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637594456856-f2392ede-2b96-4b5a-bff0-c2b659ba9203.png)

è‡ªå·±å†™æ˜¯å¯ä»¥å®ç°çš„ï¼Œä½†ä¹Ÿæœ‰ç¤¾åŒºçš„å¼€æºæ–¹æ¡ˆï¼šå…·ä½“å¦‚ä¸‹

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637770102855-2111ddad-4d03-487c-8fd3-778ded284dca.png)

æ¨èä½¿ç”¨YYModelè¿™äº›å¼€æºé¡¹ç›®ä¸»è¦æ˜¯ä¸ºäº†é¢„é˜²ç±»å‹å¼‚å¸¸å‡ºç°å¯¼è‡´çš„é—®é¢˜

æˆ‘ä»¬å…ˆæ¥è°ƒæ•´æ–‡ä»¶å¤¹ç»„ç»‡ç»“æ„



### ä»£ç å®ç°
> ä¸‹é¢çš„ä»£ç ä¸»è¦å¹²è¿™å‡ ä»¶äº‹æƒ…
>
>   1. è°ƒæ•´åŸæ¥çš„ç›®å½•ç»“æ„æŠŠnews èšåˆèµ·æ¥æˆä¸€ä¸ªMVC ç»“æ„ï¼ŒæŠŠå¤–é¢çš„loaderä¹Ÿæ‹¿è¿›æ¥
>
> 2. åˆ›å»ºçˆ±ä½ ä¸€ä¸ªModel ç”¨æ¥ç»“æ„åŒ–JSONæ•°æ®
> 3. è®¾ç½®æ­¤Modelçš„å®ç°çš„ç±»å‹å£°æ˜
> 4. åœ¨æ¥å£å¤„ï¼Œè¿˜å®ƒèµ‹å€¼
>



![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637771581118-466be0e9-e743-4be4-9e01-2a354ddfddf2.png)

```objectivec
# hå£°æ˜æ–‡ä»¶
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN
/**
 åˆ—è¡¨ç»“æ„åŒ–æ•°æ®
 */
@interface GTLIstItem : NSObject

@property(nonatomic, copy, readwrite ) NSString *category;
@property(nonatomic, copy, readwrite ) NSString *picUrl;
@property(nonatomic, copy, readwrite ) NSString *uniqueKey;
@property(nonatomic, copy, readwrite ) NSString *title;
@property(nonatomic, copy, readwrite ) NSString *date;
@property(nonatomic, copy, readwrite ) NSString *authorName;
@property(nonatomic, copy, readwrite ) NSString *articleUrl;

- (void) configWithDictionary: (NSDictionary *)dictionary;
@end

NS_ASSUME_NONNULL_END



# å®ç°mæ–‡ä»¶
#import "GTLIstItem.h"

@implementation GTLIstItem

- (void) configWithDictionary: (NSDictionary *)dictionary {
   
#warning ç±»å‹åŒ¹é…å’Œå®¹é”™
   self. category = [dictionary objectForKey:@"category"];
   self. picUrl = [dictionary objectForKey:@"picUrl"];
   self. uniqueKey = [dictionary objectForKey:@"uniqueKey"];
   self. title = [dictionary objectForKey:@"title"];
   self. date = [dictionary objectForKey:@"date"];
   self. authorName = [dictionary objectForKey:@"authorName"];
   self. articleUrl = [dictionary objectForKey:@"articleUrl"];
};
@end

```

```objectivec
//
//  GTListLoader.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/12.
//
 
++++++
//    6. è§£ææ•°æ®
        NSError *jsonError;
        id jsonObj = [NSJSONSerialization JSONObjectWithData:data options:0 error:&jsonError];
        
//        7. èµ‹å€¼ç»“æ„åŒ– dataArrayå°±æ˜¯ä½ çš„ç»“æ„åŒ–æ•°æ®å•¦
        NSArray *dataArray = [  (
                                 (NSDictionary *)[ (
                                                    (NSDictionary *)jsonObj  // å…ˆå¼ºåˆ¶è£…æ¢åˆ°NSDictionary
                                                    ) objectForKey:@"res" ] // è°ƒç”¨objectForKeyæ–¹æ³•å¾—åˆ°åˆä¸€ä¸ªJSONç„¶åå†æ¬¡å¼ºè½¬åˆ°NSDictionary
                                 ) objectForKey:@"data"   ]; // å†è°ƒç”¨key å–å€¼
        NSMutableArray *listItemArray = @[].mutableCopy;
        for (  NSDictionary *info in dataArray ) {
            GTLIstItem *listItem = [[GTLIstItem alloc] init];
            [listItem configWithDictionary:info];
            [listItemArray addObject:listItem];
        }

        
        NSLog(@"");
    }]; // è¿™ä¸ªNSURLSessionDataTask å±äºsession1ä¸‹çš„ session1æ˜¯ä¸€ä¸ªå•ä¾‹
    
    // 5 å‘èµ·
    [dataTask1 resume];
    
    NSLog(@"");
};

@end

```

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638369106614-38588cce-3d7b-46a2-8298-c9338fade889.png)

## 
## æŠŠåŠ è½½å¥½çš„æ•°æ®æ¸²æŸ“åˆ°é¡¹ç›®ä¸­å»
> ä¸»è¦æ˜¯è®²ä¸€ä¸‹å¦‚ä½•æ¸²æŸ“æ•°æ®
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637848764530-d351bd18-5f58-436e-a70c-a142cb061bf1.png)

### å®è·µæŒ‡å—
å–‚äº†æˆ‘ä»¬çš„ListContainerèƒ½æ›´æ–¹ä¾¿çš„è·å–åˆ°æˆ‘ä»¬çš„Modelæ•°æ®æˆ‘ä»¬ä½¿ç”¨ blockæ¥è¿›è¡Œæ“ä½œ

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638369727396-23de6f61-e768-42c2-b4b9-be6f460f12e6.png)

ä½ å¯ä»¥ä½¿ç”¨å¿«æ·çš„Xcodeæ“ä½œï¼Œç›´æ¥æ‹–å…¥ä¸€ä¸ªBlockå¿«å°±å¥½äº†

 

```objectivec
#   GTListLoader.h

#import <Foundation/Foundation.h>
@class GTLIstItem; // ä¸ºäº†é¿å…åœ¨Hæ–‡ä»¶ä¸­è¿‡åº¦çš„å¼•å…¥ä¾èµ–æˆ‘ä»¬å£°æ˜ä¸€ä¸‹å°±å¥½äº†ï¼Œå…·ä½“ç”¨åˆ°çš„æ—¶å€™å†è‡ªå·±å»å¼•å…¥
typedef void(^GTLisrLoaderFinishBlock)(BOOL success, NSArray<GTLIstItem *> *dataArray); // å®šä¸€ä¸ªä¸€ä¸ªCè¯­è¨€ç±»å‹çš„Block è¿”å›å€¼è¯´void ï¼Œå‚æ•°ä¸€ä¸ªBOOLï¼Œè¿”å›å€¼è¯´ä¸€ä¸ªNSArray
NS_ASSUME_NONNULL_BEGIN

///  åˆ—è¡¨è¯·æ±‚
@interface GTListLoader : NSObject
- (void)loadListDataWithFinishBlock: (GTLisrLoaderFinishBlock)finishBlock; // å®ç°è¿™ä¸ªå‡½æ•° è¿™ä¸ªå‡½æ•°è°ƒç”¨çš„æ—¶å€™å›åœ¨å›æ‰çš„æ—¶å€™è¿”å›ä¸€ä¸ªç»è¿‡ç½‘ç»œå’ŒmodalåŒ…è£…å¥½çš„ä¹¦ç±ç»“æ„ç»™ä½ 
@end

NS_ASSUME_NONNULL_END



#   GTListLoader.m
#import "GTListLoader.h"
#import "AFNetworking.h"
#import "GTListItem.h"
@implementation GTListLoader

- (void)loadListDataWithFinishBlock: (GTLisrLoaderFinishBlock)finishBlock {
+++++
  //  8 è¿›è¡Œæ•°æ®åŒ…è£…å¤„ç† æ³¨æ„ä¸ºäº†ä½“éªŒå’Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ“ä½œæ”¾åˆ°ä¸»çº¿å±‚å»å› ä¸ºåˆ—è¡¨çš„ç»˜åˆ¶ä¹Ÿåœ¨ä¸»çº¿ç¨‹
        dispatch_async(dispatch_get_main_queue(), ^{
            if(finishBlock){
                finishBlock(error === nil, listItemArray.copy);
            };
        });
++++++
};

@end



# ç„¶åæˆ‘ä»¬å»è°ƒç”¨çš„åœ°æ–¹çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ è¯·å…³æ³¨é‡ç‚¹ä»£ç     NewsController.m
#import "NewsController.h"
#import "CGPtTableViewCell.h"
#import "GTDeleteCellView.h"
#import "WebViewViewController.h"
#import "GTListLoader.h"


@interface NewsController ()<UITableViewDataSource, UITableViewDelegate, CGPtTableViewCellDelegate>
// æŠŠtabViewå˜æˆä¸€ä¸ªå±æ€§
@property(nonatomic, strong, readwrite) UITableView *tabView;
// æŠŠåŸæ¥çš„ä¸ªæ•°å˜æˆä¸€ä¸ªæ•°ç»„   å› ä¸ºå¾…ä¼šåˆ é™¤çš„æ—¶å€™æ˜¯ä¸€ç‚¹ç‚¹çš„pop
@property(nonatomic, strong, readwrite) NSArray *dataArray;
@property(nonatomic, strong, readwrite) GTListLoader *listLoader;
@end

@implementation NewsController

- (instancetype)init {
	self = [super init];  // è¿™é‡Œå»æ‰äº†åŸæ¥çš„ä¸œè¥¿æ¢æˆçœŸå®çš„æ•°æ®
	return self;
};


- (void)viewDidLoad {
	[super viewDidLoad];
	self.view.backgroundColor = [UIColor whiteColor];

	_tabView = [[UITableView alloc] initWithFrame:self.view.bounds];
	[self.view addSubview: _tabView];

	// æ‹¿åˆ°UITabViewçš„DataSource delegate
	_tabView.dataSource = self;
	// æ‹¿åˆ°UITabViewçš„ delegate
	_tabView.delegate = self;

//    å¼€å§‹å»åŠ è½½çœŸå®çš„ç½‘ç»œæ•°æ®
	self.listLoader = [[GTListLoader alloc] init];

//    ä¾ç„¶è¦å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ ï¼ˆé‡ç‚¹ï¼‰++++
	__weak typeof(self) weself = self;
	[self.listLoader loadListDataWithFinishBlock:^(BOOL success, NSArray<GTLIstItem *> *dataArray) {
	         __strong typeof(self) strongSelf = weself;
	         // èµ‹å€¼å’Œrelaod
	         strongSelf.dataArray = dataArray;
	         [strongSelf.tabView reloadData];
	 }];
}

#pragma mark NewsController

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
	return _dataArray.count;
};

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
	WebViewViewController *viewControoler = [[WebViewViewController alloc] init];
	viewControoler.view.backgroundColor = [UIColor whiteColor];
	viewControoler.navigationItem.title = [NSString stringWithFormat:@"æ ‡é¢˜ - %@", @(indexPath.row)];

	[self.navigationController pushViewController: viewControoler animated:YES];
};

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath {
	return 100.0;
};

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {

	CGPtTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"id"];
	if ( !cell ) {
		cell = [[CGPtTableViewCell alloc] initWithStyle:UITableViewCellStyleSubtitle reuseIdentifier:@"id"];
		cell.delegate = self; // 
	}
  
	// é‡ç‚¹+++++
    [cell layoutInitCellWithItem:[self.dataArray objectAtIndex: indexPath.row] ];  // ä¾æ®æ•°æ®æ¥æ¸²æŸ“UIè¯•å›¾

	return cell;
};
 
- (void)tabViewCell: (UITableViewCell *)tabViewCell clickDeleteButton:(UIButton *)delegateButton {
};
@end


# ç„¶åæˆ‘ä»¬å»åˆ°æ¯ä¸€ä¸ªcellæ¸²æŸ“çš„åœ°æ–¹ æŠŠå¯¹åº”çš„æ•°æ®æ‹¿è¿‡å»ï¼Œéšä¾¿æ”¹æ”¹æ ·å¼ä»€ä¹ˆçš„ è¯·å…³æ³¨ é‡ç‚¹+++
//
//  CGPtTableViewCell.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/10/23.
//

#import "CGPtTableViewCell.h"
#import "GTLIstItem.h"  // é‡ç‚¹+++

@interface CGPtTableViewCell ()

@property(nonatomic, strong, readwrite) UILabel *titleLabel;
@property(nonatomic, strong, readwrite) UILabel *sourceLabel;
@property(nonatomic, strong, readwrite) UILabel *commentLabel;
@property(nonatomic, strong, readwrite) UILabel *timeLabel;
@property(nonatomic, strong, readwrite) UIImageView *rightImageView;
@property(nonatomic, strong, readwrite) UIButton *myButton;

@end

@implementation CGPtTableViewCell
+++++
- (void) layoutInitCellWithItem: (GTLIstItem *) item { 
    self.titleLabel.text = item.title;
    self.sourceLabel.text = item.authorName;
    
    self.commentLabel.text = item.category;
    [self.commentLabel sizeToFit];
    self.commentLabel.frame = CGRectMake(self.sourceLabel.frame.origin.x + self.sourceLabel.frame.size.width + 15,  self.commentLabel.frame.origin.y , self.commentLabel.frame.size.width,self.commentLabel.frame.size.height);
    
    self.timeLabel.text = item.date;
    [self.timeLabel sizeToFit];
    self.timeLabel.frame = CGRectMake(self.commentLabel.frame.origin.x + self.commentLabel.frame.size.width + 15,  self.timeLabel.frame.origin.y , self.timeLabel.frame.size.width,self.timeLabel.frame.size.height);
    
    
    // æˆ‘ä»¬ä½¿ç”¨ç½‘ç»œå›¾ç‰‡çš„åŠ è½½
#warning æš‚æ—¶è¿™æ ·å†™å…ˆ
    UIImage *image = [UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:item.picUrl]]];
    
    self.rightImageView.image = image;
    //  è¿™ä¸ªä¼šè¿”å›ä¸€ä¸ªUIImageç±»
//        self.rightImageView.image = [UIImage imageNamed:@"icon.bundle/home.png"];
}

- (void) myButtonClick {
//  åŠ è¿™æ®µåˆ¤æ–­çš„åŸå› æ˜¯ï¼šæˆ‘ä»¬çš„è‡ªå®šä¹‰çš„Delegateæ˜¯éå¿…é€‰çš„ï¼Œä¸ºäº†é¿å…æŠ¥é”™éœ€è¦è¿™æ ·æ¥å…œåº•å¤„ç†
    if(self.delegate && [self.delegate respondsToSelector:@selector(tabViewCell:clickDeleteButton:)]  ) {
        [self.delegate tabViewCell:self clickDeleteButton:self.myButton];
    }
}
@end

```

ä¸Šé¢çš„æˆ‘ä»¬åªæ˜¯æŠŠListæå®šäº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥å¤„ç†ä¸€ä¸‹ç¦»mainçš„ä¸€ä¸ªWebviewçš„URLåœ°å€

```javascript
//
//  NewsController.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/10/20.
//

#import "NewsController.h"
#import "CGPtTableViewCell.h"
#import "GTDeleteCellView.h"
#import "WebViewViewController.h"
#import "GTListLoader.h"
#import "GTLIstItem.h"


@interface NewsController ()<UITableViewDataSource, UITableViewDelegate, CGPtTableViewCellDelegate>
// æŠŠtabViewå˜æˆä¸€ä¸ªå±æ€§
@property(nonatomic, strong, readwrite) UITableView *tabView;
// æŠŠåŸæ¥çš„ä¸ªæ•°å˜æˆä¸€ä¸ªæ•°ç»„   å› ä¸ºå¾…ä¼šåˆ é™¤çš„æ—¶å€™æ˜¯ä¸€ç‚¹ç‚¹çš„pop
@property(nonatomic, strong, readwrite) NSArray *dataArray;
@property(nonatomic, strong, readwrite) GTListLoader *listLoader;
@end

@implementation NewsController


+++++

#pragma mark NewsController
++++

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    GTLIstItem *item = [self.dataArray objectAtIndex: indexPath.row];
	WebViewViewController *viewControoler = [[WebViewViewController alloc] initWithUrlString:item.picUrl];
	viewControoler.view.backgroundColor = [UIColor whiteColor];
	viewControoler.navigationItem.title = [NSString stringWithFormat:@"æ ‡é¢˜ - %@", @(indexPath.row)];

	[self.navigationController pushViewController: viewControoler animated:YES];
};
++++
@end



//
//  WebViewViewController.m

#import "WebViewViewController.h"
#import <WebKit/WebKit.h>  // å¼•å…¥webkit

@interface WebViewViewController () <WKNavigationDelegate>
@property(nonatomic, strong, readwrite) WKWebView *webView;
@property(nonatomic, strong, readwrite) UIProgressView *webProgreess;
@property(nonatomic, copy, readwrite) NSString *articleUrl;

@end

@implementation WebViewViewController


-(instancetype) initWithUrlString : (NSString *)urlString {
    self = [super init];
    if (self) {
        self.articleUrl = urlString;
    };
    return  self;
};

#pragma DidLoad
- (void)viewDidLoad {
	  +++++
    [self.webView loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:self.articleUrl]]];
    +++++

@end

```



