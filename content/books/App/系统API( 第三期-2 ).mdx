---
title: "iOS å¼€å‘å®è·µï¼šæ–‡ä»¶ç®¡ç†ä¸å¤šçº¿ç¨‹å¤„ç†"
date: "2024-12-19"
summary: "æ·±å…¥è®²è§£ iOS æ²™ç›’æ–‡ä»¶ç®¡ç†æœºåˆ¶ã€åºåˆ—åŒ–å­˜å‚¨ã€NSUserDefaults ä½¿ç”¨ï¼Œä»¥åŠ NSThread å’Œ GCD å¤šçº¿ç¨‹ç¼–ç¨‹å®è·µã€‚"
status: "completed"
tech: ["iOS", "FileManager", "GCD", "Multithreading"]
github: "https://github.com/BM-laoli"
arxiv: ""
keyId: "App"
---



# IOSä¸­çš„æ–‡ä»¶ç®¡ç†
## IOSä¸­çš„æ–‡ä»¶ç®¡ç†ï¼ˆ1ï¼‰
### ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637850250853-8ac65203-c5b2-494d-9188-3a2369da534f.png)

ç”±äºIOS çš„å®‰å…¨æ¯”è¾ƒç‰¹æ®Šï¼Œæˆ‘ä»¬çš„æ¯ä¸ªAppéƒ½æœ‰æ¯ä¸€ä¸ªå›ºå®šçš„æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬çš„Appçš„å­˜å‚¨ç©ºé—´æ˜¯ç‹¬ç«‹çš„å¹¶ä¸”å’Œå…¶ä»–Appæ˜¯ä¸åŒçš„ï¼Œæ¯ä¸ªAppçš„ç©ºé—´åˆåˆ†ä¸¤ç±» éBundlesï¼ˆä¸ç”¨ç®¡ï¼‰ å’ŒDatasï¼ˆé‡è¦ï¼‰ï¼Œä¸‹é¢å°±æ˜¯Datasä¸‹å¸¸ç”¨çš„æ–‡ä»¶å¤¹ç»“æ„

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637850367624-447be435-2248-4bd9-b5d5-7d44391ae02f.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637850498993-baee388c-ce5e-43d5-9791-db7e49ea2430.png)

ä¸‹é¢çš„è¿™ä¸ªè·å–æ–¹å¼ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªâ€œå®â€

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637850660077-1350353d-a1a8-49ef-a712-e1347f58a4ee.png)







### å®è·µæŒ‡å—
> ä¸‹é¢çš„ä»£ç å°±è¯´åœ¨IOSæ¨¡æ‹Ÿå™¨ä¸­ é€šè¿‡ä¸Šé¢è®²çš„æ–¹æ³•æ¥è·å–å¯¹åº”çš„æ²™ç›’åœ°å€
>



```objectivec
//
//  GTListLoader.m
//  SimpelApp
//
//  Created by æä»•å¢ on 2021/11/12.
//

#import "GTListLoader.h"
#import "AFNetworking.h"
#import "GTListItem.h"
@implementation GTListLoader

- (void)loadListDataWithFinishBlock: (GTLisrLoaderFinishBlock)finishBlock {
+++++
    
    // è°ƒè¯•æ²™ç›’ç³»ç»Ÿ
    [self _getSanBoxPath];
};

- (void) _getSanBoxPath {
    NSArray *NsArray= NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
    NSLog(@"");
 // åœ¨è¿™é‡Œæ‰“ä¸€ä¸ªæ–­ç‚¹ è·å–é“æ–‡ä»¶å¤¹è·¯å¾„ğŸ“ ç„¶åå›åˆ°ç”µè„‘çš„æ¡Œé¢ï¼Œç‚¹å‡»â€œå‰å¾€â€ -> "å‰å¾€æ–‡ä»¶å¤¹" è¾“å…¥è·å–é“çš„åœ°å€å°±
  èƒ½å‰å¾€äº†ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œçš„æ˜¯
    
    
}
@end
 

```

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638889117881-a63d2af9-c565-4747-a5c5-ae1e05a65c47.png)

ç„¶åä½ å°±èƒ½çœ‹å‰å¾€è¿™ä¸ªAppçš„æ²™ç›’æ–‡ä»¶å¤¹äº†

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638889153885-f2c28991-4358-46d4-a1f0-db686e9e9533.png)

## IOSä¸­çš„æ–‡ä»¶ç®¡ç†ï¼ˆ2ï¼‰
> ä¸Šé¢æˆ‘ä»¬åªæ˜¯é€šè¿‡ç®€å•çš„å­¦ä¹ è·å–åˆ°äº† æ²™ç›’åœ°å€ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ æ“ä½œä¸€ä¸‹è¿™äº›æ–‡ä»¶
>



### ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637851226294-29aa003a-6b91-471d-a13f-ef43e1ce8780.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637851245633-3e580352-adf5-42c7-9860-9a2166bb2796.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637851385065-dbc5794a-3cff-41d0-b9a0-6a99d38f35ac.png)

FileManager æ˜¯ä¸€ä¸ªå•ä¾‹



### å®è·µæŒ‡å—
> ä¸‹é¢çš„å°±æ˜¯ ä½¿ç”¨ä¸Šé¢çš„ä¸¤ä¸ªç±»  ä¿å­˜æˆ‘ä»¬çš„åŸæ¥Listçš„æ•°æ®é“cacheä¸­å»
>

```objectivec
+++++ 
NSArray *path= NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES);
    NSString *cachePath = [path firstObject];
    
    NSFileManager *fileManager = [NSFileManager defaultManager];
    
//    cahcheæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½•
    NSString *dataPath = [cachePath stringByAppendingPathComponent:@"GTDAta"];
    NSError *createError;
    [fileManager createDirectoryAtPath:dataPath withIntermediateDirectories:YES attributes:nil error:&createError];
    
//    ç„¶åæˆ‘ä»¬å»åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„åœ°å€
    NSString *listDataPath = [dataPath stringByAppendingPathComponent:@"list"];
//    æœ€åæˆ‘ä»¬æŠŠæ•°æ®å†™å…¥è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶
    NSData *listData = [@"abccccccc000111" dataUsingEncoding:NSUTF8StringEncoding]; // æ–‡å­—ä»€ä¹ˆçš„éƒ½æ˜¯UTF8ç¼–ç æ ¼å¼
    [fileManager createFileAtPath:listDataPath contents:listData attributes:nil]; // åˆ›å»ºä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®
++++
```

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638890490940-cf76b7b0-742f-417e-86c9-d76bd20decf2.png)

ä¸‹é¢å‘¢æˆ‘ä»¬æ¥çœ‹çœ‹æ›´å¤šçš„æ“ä½œï¼Œæ¯”å¦‚åˆ é™¤ æˆ–è€…åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå’Œè¿½åŠ æ–‡ä»¶å†…å®¹åˆ°å·²ç»å­˜åœ¨çš„æ–‡ä»¶ä¸­å»ã€‚



```objectivec
+++++
    NSArray *path= NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES);
    NSString *cachePath = [path firstObject];
    
    NSFileManager *fileManager = [NSFileManager defaultManager];
    
//    cahcheæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½•
    NSString *dataPath = [cachePath stringByAppendingPathComponent:@"GTDAta"];
    NSError *createError;
    [fileManager createDirectoryAtPath:dataPath withIntermediateDirectories:YES attributes:nil error:&createError];
    
//    ç„¶åæˆ‘ä»¬å»åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„åœ°å€
    NSString *listDataPath = [dataPath stringByAppendingPathComponent:@"list"];
//    æœ€åæˆ‘ä»¬æŠŠæ•°æ®å†™å…¥è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶
    NSData *listData = [@"abccccccc000111" dataUsingEncoding:NSUTF8StringEncoding]; // æ–‡å­—ä»€ä¹ˆçš„éƒ½æ˜¯UTF8ç¼–ç æ ¼å¼
    [fileManager createFileAtPath:listDataPath contents:listData attributes:nil]; // åˆ›å»ºä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®

//    æŸ¥è¯¢æ–‡ä»¶å‘¢ï¼Ÿ
    BOOL fileExist = [fileManager fileExistsAtPath:listDataPath]; // æ˜¯å¦å­˜åœ¨è¿™ä¸ªfileè·¯å¾„åœ°å€
    
//    åˆ é™¤ä¹Ÿæ˜¯ä¸€æ ·çš„
//    if(fileExist){
//        [fileManager removeItemAtPath:listDataPath error:nil];
//    }
    
//    ä¸Šè¿°çš„éƒ½æ˜¯fileMangerç›¸å…³çš„ æˆ‘ä»¬æ¥çœ‹çœ‹ fileHandlerå¦‚ä½•å¾€å‰é¢çš„æ•°æ®ä¸­ è¿½åŠ æ•°æ®ï¼›
    NSFileHandle *filerHander = [NSFileHandle fileHandleForUpdatingAtPath:listDataPath];
    
    [filerHander seekToEndOfFile];
    [filerHander writeData:[@"def" dataUsingEncoding:NSUTF8StringEncoding]];
    
    [filerHander synchronizeFile]; // åˆ·æ–°ä¸€ä¸‹ æŠŠè¿½åŠ çš„å†…å®¹è¿½åŠ è¿›å»
    [filerHander closeFile];
    NSLog(@"");
+++++
```

## IOSä¸­çš„æ–‡ä»¶ç®¡ç†ï¼ˆ3ï¼‰
### ç†è®ºçŸ¥è¯†
> æˆ‘ä»¬è¿™é‡Œå¼€å§‹çœ‹çœ‹å¦‚ä½•æŠŠä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ å­˜å‚¨ä¸‹æ¥ã€ä¸»è¦å°±æ˜¯äºŒè¿›åˆ¶æµä¹‹é—´çš„è½¬åŒ–ã€‘
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637939860731-47c86aad-da9f-43ae-ac02-a64dd6e47a92.png)

è¿™ä¸ªæ˜¯IOSä¸­åºåˆ—åŒ–æœ€æ›´æœ¬çš„API ç”±ç³»ç»Ÿæä¾›ï¼ˆä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ç”¨è¿™ä¸ªï¼Œè€Œæ˜¯ç”¨ä»–çš„æ‰©å±•ç±»ï¼‰ï¼Œå®é™…ä¸Šè¿™ä¸ªå°±åƒå‰ç«¯çš„JSON.paseå’Œstringfy



![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637940817960-9de5acd6-08ce-4156-8704-7a5f6183a815.png)

keyä½œç”¨ç±»ä¼¼äºæŒ‡é’ˆ

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637940969498-919431b7-e0a5-4fcc-b6ad-581e38908963.png)  
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1637941217926-807bdccb-b75b-4bbc-83c0-31e6d6022e34.png)

å¤§è‡´çš„è¿‡ç¨‹å°±æ˜¯ ä½¿ç”¨ä¸¤ä¸ªå‡½æ•°è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–å‡½æ•°ï¼Œç„¶åè¦åºåˆ—çš„å¯¹è±¡ éœ€è¦å®ç°NSCodingåè®® ã€

NSCoder NSKeyedArciver NScodingåè®®ã€‘

### å®è·µæŒ‡å—
> ä¸‹é¢çš„ä¾‹å­å°±æ˜¯æŠŠ ä¸€ä¸ªâ€œå¯¹è±¡â€å­˜è¿›å»ï¼Œ( æ³¨æ„æˆ‘ä»¬è¿™é‡Œç”±äºæœ‰ç‚¹BUGæ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œç°åœ¨æˆ‘ä»¬ç®€åŒ–å¤„ç†å“ˆ )
>

```objectivec
# æ–°å»ºäº†ä¸€ä¸ªTestCoding ç„¶åå»å®ç°å¯¹åº”çš„é€»è¾‘
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

@interface TestCoding : NSObject<NSCoding, NSSecureCoding>

@property (nonatomic, copy) NSString *cityId;
@property (nonatomic, copy) NSString *name;

@end

NS_ASSUME_NONNULL_END


#import "TestCoding.h"

@implementation TestCoding

- (instancetype)initWithCoder:(NSCoder *)aDecoder {
    if (self = [super init]) {
        self.cityId = [aDecoder decodeObjectForKey:@"cityId"];
        self.name = [aDecoder decodeObjectForKey:@"name"];
     }
    return self;
}

- (void)encodeWithCoder:(NSCoder *)aCoder {
    [aCoder encodeObject:self.cityId forKey:@"cityId"];
    [aCoder encodeObject:self.name forKey:@"name"];
}

// æ­¤æ–¹æ³•å¿…é¡»æ·»åŠ 
+ (BOOL)supportsSecureCoding {
    return YES;
}

@end


# åºåˆ—åŒ–å’Œååºåˆ—åŒ–
// GTListLoader.m æ–‡ä»¶ä¸­
+++++
- (void) _archvieListDataWithArray: (NSArray<GTLIstItem *> *)array {
+++++
// -------æµ‹è¯•ä»£ç 
//
    TestCoding *cod1 = [TestCoding alloc];
    cod1.cityId = @"cdu";
    cod1.name = @"2Name";

    TestCoding *cod2 = [TestCoding alloc];
    cod2.cityId = @"cdu";
    cod2.name = @"2Name";

    NSArray *listValueData = @[cod1, cod2];
    
    NSData *data = [NSKeyedArchiver archivedDataWithRootObject:listValueData requiringSecureCoding:YES error:nil];

//    [data writeToFile:listDataPath atomically:YES];
    NSArray *historyArr1 = [NSKeyedUnarchiver unarchivedObjectOfClasses:[NSSet setWithObjects:[NSArray class], [TestCoding class], nil] fromData:data error:nil];

    NSLog(@"%d",10/3);
}

```



## æœ‰æ²¡æœ‰â€œè½®å­â€ï¼Ÿ
> è¿™ä¸ªä¸œè¥¿å½“ç„¶æ˜¯æœ‰çš„å•¦ï¼Œè¿™ç‚¹ä¸å¿…æ‹…å¿ƒ
>

### ç†è®ºçŸ¥è¯†
ç³»ç»Ÿè¿˜æä¾›äº†ä¸€ä¸ªéå¸¸çš„ç®€å•çš„å­˜å‚¨é€»è¾‘

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638367247849-c35e8260-f7d3-41e6-aeb3-f53170ec69b5.png)



è¿™ä¸ªå°±æ˜¯æ‰€è°“çœŸæ­£çš„JSONStringå•¦åœ¨OCä¸­å’ŒIOSå¼€å‘ä¸­å°±æ˜¯è¿™ä¸ªä¸œè¥¿ã€‚å®é™…ä¸Šå­˜å‚¨çš„åº•å±‚è¿˜æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æµï¼ˆNSDataï¼‰ å®é™…ä¸Šè¿™ä¸ªæ˜¯æ›´ä¸Šå±‚çš„å°è£…

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638367739686-f5fd7257-f60c-4b10-a40d-c11c09d7c285.png)

åœ¨ä½¿ç”¨å¼€æºçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›´åŠ å¸¸ç”¨çš„å°±æ˜¯FMDBã€

æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼š

![ç”»æ¿](https://cdn.nlark.com/yuque/0/2021/jpeg/1627571/1639059089212-402a6743-0cb4-43d4-9991-28af96d822cc.jpeg)

### å®è·µæŒ‡å—ğŸ§­
```objectivec
// GTListLoader.m æ–‡ä»¶ä¸­ è¿™é‡Œæˆ‘ä»¬å®ç°çš„å­˜å‚¨å°±å­˜å‚¨åˆ°ç³»ç»Ÿæä¾›çš„key-valueä¸­
+++++
//    [[NSUserDefaults standardUserDefaults] setObject:@"abc" forKey:@"test"];
//    NSString *test = [[NSUserDefaults standardUserDefaults] stringForKey:@"test" ];
//    å–å‡ºæ¥å°±æ˜¯ abc
//    åŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥å­˜å‚¨äºŒè¿›åˆ¶çš„ä¸œè¥¿
    [[NSUserDefaults standardUserDefaults] setObject:data forKey:@"scalue"];
    NSData *test2 = [[NSUserDefaults standardUserDefaults] dataForKey:@"scalue" ];
//
    NSArray *historyArr2 = [NSKeyedUnarchiver unarchivedObjectOfClasses:[NSSet setWithObjects:[NSArray class], [TestCoding class], nil] fromData:test2 error:nil];
```

# 
## æˆ‘ä»¬ä½¿ç”¨KeyValueç»“åˆæœ¬åœ°æ–‡ä»¶å­˜å‚¨æ¥åšä¸€æ¬¡å®è·µ
### ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638368035716-e1e6b430-fef9-4560-8533-e15ab0ea36a6.png)

### å®è·µæŒ‡å—
> ç”±äºä¸€äº›å…¶å®ƒçš„å€Ÿå£é™åˆ¶æˆ‘ä»¬å°±ä¸åšè¿™æ¬¡å¤„ç†äº†ï¼Œé€»è¾‘å¦‚ä¸‹
>

![ç”»æ¿](https://cdn.nlark.com/yuque/0/2021/jpeg/1627571/1639059627103-b63e9c24-57e1-4152-bc34-ae2dc5c163f7.jpeg)



# Appå¼€å‘é‡ç‚¹çº¿ç¨‹ç®¡ç†
## å¿«é€Ÿå…¥é—¨
### ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638368186386-e538e73d-b497-407b-a097-77cc13f1e252.png)

> å¯¹äº	å‰ç«¯æ¥è¯´ æµè§ˆå™¨å°±æ˜¯çš„jså¼•æ“å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„DOMç»˜åˆ¶ ä¼šå¯¹UIæœ‰å½±å“ã€‚
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1638368355780-be3188bc-35ef-41ce-80a5-4eff78eb10b0.png)

åœ¨IOSå¼€å‘ä¸­NSThreadå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œ



### ä»£ç æŒ‡å—
> ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç å¦‚ä½•è½åœ° NSThread`
>

```objectivec
  
# --- CGPtTableViewCell.m
++++++
    // æˆ‘ä»¬ä½¿ç”¨ç½‘ç»œå›¾ç‰‡çš„åŠ è½½
#warning æš‚æ—¶è¿™æ ·å†™å…ˆ  // è¿™æ ·çš„å†™æ³•ä¼šæœ‰æ»šåŠ¨ï¼Œå› ä¸ºâ€œ[NSData dataWithContentsOfURL:[NSURL URLWithString:item.picUrl]]];â€ä¸€ç›´åœ¨ä¸»çº¿ç¨‹è¿è¡Œ å¯¼è‡´å¡é¡¿
    
//    ç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹è¿™ä¸ªä»£ç  æŠŠè¿™ä¸ªæ“ä½œæ”¾åˆ°è‡ªå·±çš„å­çº¿ç¨‹ä¸­ è¿™é‡Œä½¿ç”¨Blockçš„æ–¹æ³• æ”¾å…¥å…¶ä¸­,ä½†æ˜¯ä¼šæœ‰è­¦å‘Šè¯´è¿™ä¸ªUIæ“ä½œä¸åœ¨ä¸»çº¿ç¨‹ä¸­
    NSThread *dowloadImgThread = [[NSThread alloc] initWithBlock:^{
        UIImage *image = [UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:item.picUrl]]];
        self.rightImageView.image = image;
    }];
    
//    åœ¨æ§åˆ¶å°æ‰§è¡Œ ã€NSThread currentTherdã€‘.isMain å°±èƒ½çœ‹åˆ°æ˜¯å¦è¯´ä¸»çº¿ç¨‹
    dowloadImgThread.name = @"dowloadImgThread";
    [dowloadImgThread start];
++++++
```

## GCDç®€å•çš„ä»‹ç»
### ç†è®ºçŸ¥è¯†
> ä¸Šé¢çš„å†…å®¹æ˜¯æœ€ç®€å•çš„å®ç°äº†ä¸€ä¸ª å¤šçº¿ç¨‹ ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿæä¾›çš„APIæ¥æ“ä½œï¼Œæœ¬è´¨ä¸ŠGCDæ˜¯å¯¹ç°åœºçš„â€œé˜Ÿåˆ—åŒ–â€æ“ä½œ  Threads Pool çº¿ç¨‹æ±  ç®¡ç† åº•å±‚å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± 
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1639060558532-ecf924f9-9298-4a1b-a0fe-dfb8f95d5923.png)

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1639060673945-fb79c701-52f3-4428-9747-bf5b5c31db18.png)

> è‡ªå®šä¹‰çš„é˜Ÿåˆ—å¯ä»¥è‡ªå®šä¸ºï¼šâ€œå¹¶å‘çš„â€ è¿˜æ˜¯ â€œä¸²è¡Œçš„â€
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1639060873211-a595752b-d01d-420e-b191-338d09cf2b1f.png)

> åŒæ ·çš„è¿™äº›ä¸šåŠ¡é€»è¾‘ ä¹Ÿæ˜¯Block 
>

### ä»£ç æŒ‡å—
> è¿™é‡Œçš„éœ€æ±‚ï¼šâ€œæ—¢è¦ä¿è¯ é«˜è€—æ—¶ ä¸åœ¨ä¸»çº¿ç¨‹ ï¼Œåˆä¿è¯ä¸åœ¨éä¸»çº¿å±‚ æ“ä½œUIâ€
>

```objectivec
# --- CGPtTableViewCell.m
+++++
//   ä½¿ç”¨ GCD æ–¹æ¡ˆè§£å†³è¿™ä¸ªé—®é¢˜
    dispatch_queue_global_t doloadQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);  // éä¸»é˜Ÿåˆ— æ‰§è¡Œé«˜è€—æ—¶æ“ä½œ å‚æ•°å°±æ˜¯ æ‰§è¡Œçš„ä¼˜å…ˆçº§ï¼ˆä¸€å…±å››ç§ï¼‰
    dispatch_queue_main_t mianQueue = dispatch_get_main_queue();  // ä¸»çº¿å±‚ åˆ·å…¥å›¾ç‰‡
//    å¤šçº¿ç¨‹å¼€å§‹
    dispatch_async(doloadQueue, ^{
        UIImage *image = [UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:item.picUrl]]];
        dispatch_async( mianQueue, ^{
            self.rightImageView.image = image;
        });
    });
+++++
```

> ä¸Šé¢æ˜¯æœ€ç®€å•çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬è¿˜æœ‰é«˜çº§æä½œï¼
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1639061676980-686b970c-6b8e-4f48-b8de-475b9016b033.png)



## æ€»ç»“
> ä¸Šé¢çš„CGD æ²¡åŠæ³•å¤„ç†æ›´å¤æ‚çš„ä¸šåŠ¡ æ¯”å¦‚å¤šçº¿ç¨‹åŒæ­¥ åˆ‡æ¢ ä¸­æ–­ç­‰....ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªå¯¹GCDçš„é¢å‘å¯¹è±¡çš„å°è£…
>

### ç†è®ºçŸ¥è¯†


![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1639061891499-5587f839-7724-46c4-ae83-ea24dc1a57c8.png)![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1639062059358-8b1c1dc7-a371-4317-8918-323ac2b98dc7.png)

ä¸Šé¢çš„ä¸œè¥¿å°±åƒæ˜¯jsä¸­çš„äº‹ä»¶å¾ªç¯â™»ï¸ï¼Œä¹Ÿæ˜¯çº¿ç¨‹ åº•å±‚çš„å®ç°æ–¹å¼ï¼Œä¸‹é¢çš„å›¾æ˜¯ä»å·¦åˆ°å³æ€»ç»“äº†ä¸€ä¸‹ æ•´ä¸ªIOSä¸­å¤šçº¿ç¨‹çš„è®¾è®¡æ¡†æ¶

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1639062197043-a3513ae4-9a34-418c-9eed-1a1e0a91b4b0.png)

> ä¸‹é¢çš„ä¸œè¥¿å°±æ˜¯æˆ‘ä»¬åˆšæ‰çš„å›¾ç‰‡å¤„ç† æˆ‘ä»¬çš„ dispatch_async å°±æ˜¯åˆ‡æ¢çº¿ç¨‹ç”¨çš„
>

![](https://cdn.nlark.com/yuque/0/2021/png/1627571/1639062293354-c8983690-476e-40ae-88f3-50969d99b825.png)

### 


