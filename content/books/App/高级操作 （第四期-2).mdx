---
title: "iOS å¼€å‘å®è·µï¼šä½ç½®æƒé™ã€æ¨é€é€šçŸ¥ä¸æ‰©å±•å¼€å‘"
date: "2024-12-19"
summary: "æ·±å…¥è®²è§£ iOS ä½ç½®æƒé™è·å–ã€æ¨é€é€šçŸ¥å®ç°ã€App å›¾æ ‡ç®¡ç†åŠ Extension å¼€å‘ï¼ŒåŒ…å«å®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µã€‚"
status: "completed"
tech: ["iOS", "CoreLocation", "UserNotifications", "AppExtension"]
github: "https://github.com/BM-laoli"
arxiv: ""
keyId: "App"
---

# å…³äºä½ç½®æƒé™çš„è·å–
## ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642410413335-1d207d41-2c5b-4606-aaf2-fa80cbcfa575.png)

    å¯¹äºå®šä½æƒé™ï¼Œæœ‰æ€»çš„ å’Œ appå†…éƒ¨çš„ï¼Œappå†…éƒ¨è¿˜å›æœ‰ç»†åˆ†å¾ˆå¤šçš„æƒé™ï¼Œä½¿ç”¨AppæœŸé—´ï¼Œä»…æ­¤ä¸€æ¬¡ï¼Œå§‹ç»ˆ

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642411060548-7e1b16f1-fb93-4a70-ae20-4f6498834de3.png)

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642412316429-5ffea912-645e-4f6b-a093-7df47fb5413d.png)

> ä¸Šé¢çš„CLLoactionManager æ˜¯ ä½ç½®å›è°ƒ çš„delegate
>

## ä»£ç å®è·µ
> æˆ‘ä»¬çš„å®šä½æƒé™ï¼Œå®é™…ä¸Š å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå•åˆ©ï¼Œå› ä¸ºå’ŒæŸä¸ªé¡µé¢æ²¡æœ‰å…³ç³»ï¼Œç´ å…¨å±€ç»Ÿä¸€çš„ç®¡ç†çš„ï¼Œæ³¨æ„å¦‚æœè¦ç”¨loactoiinï¼Œé‚£ä¹ˆä½ éœ€è¦ä½¿ç”¨ ç³»ç»Ÿæä¾›çš„Framwork
>

å¯¹äºæˆ‘ä»¬å¼€å‘æ¥è¯´ï¼Œæƒé™æœ‰ä¸‹é¢å‡ ç§æƒ…å†µ  1. ç³»ç»Ÿçš„æƒé™æ²¡æœ‰å¼€å¯ï¼Œ 2.Appå†… æƒé™æœªçŸ¥   3.Appå†… å…·ä½“çš„æƒé™ï¼ˆå§‹ç»ˆï¼Œä½¿ç”¨æœŸï¼Œä»…æ­¤ä¸€æ¬¡ï¼‰ï¼Œå…·ä½“çš„æƒé™çš„æç¤ºæ–‡æ¡ˆæ˜¯åœ¨info.plist

```objectivec
# h
//
//  GTLocation.h
//  SampleApp
//
//  Created by dequanzhu on 2019.
//  Copyright Â© 2019 dequanzhu. All rights reserved.
//

#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

/**
 Appä¸­ç»Ÿä¸€çš„ä½ç½®ä¿¡æ¯ç®¡ç†
 */
@interface GTLocation : NSObject

+ (GTLocation *)locationManager;

- (void)checkLocationAuthorization;

@end

NS_ASSUME_NONNULL_END


# m
//
//  GTLocation.m
//  SampleApp
//
//  Created by dequanzhu on 2019.
//  Copyright Â© 2019 dequanzhu. All rights reserved.
//

#import "GTLocation.h"
#import <CoreLocation/CoreLocation.h>

@interface GTLocation()<CLLocationManagerDelegate>
@property(nonatomic, strong, readwrite) CLLocationManager *manager;
@end

@implementation GTLocation

+ (GTLocation *)locationManager{
    static GTLocation *location;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        location = [[GTLocation alloc] init];
    });
    return location;
}

- (instancetype)init{
    self = [super init];
    if (self) {
        self.manager = [[CLLocationManager alloc] init];
        self.manager.delegate = self;
    }
    return self;
}

- (void)checkLocationAuthorization{
    
    //åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å¼€å¯
    if(![CLLocationManager locationServicesEnabled]){
        //å¼•å¯¼å¼¹çª—
        //
    }
    
    if([CLLocationManager authorizationStatus] == kCLAuthorizationStatusNotDetermined){
        [self.manager requestWhenInUseAuthorization];
    }
}

#pragma mark - delegate

- (void)locationManager:(CLLocationManager *)manager didChangeAuthorizationStatus:(CLAuthorizationStatus)status{
    if (status == kCLAuthorizationStatusAuthorizedWhenInUse) {
        //
        [self.manager startUpdatingLocation];
        
    }else if (status == kCLAuthorizationStatusDenied){
        //
    }
}

- (void)locationManager:(CLLocationManager *)manager
     didUpdateLocations:(NSArray<CLLocation *> *)locations {
    // è¿™ä¸ªå›è°ƒ è¿”å›çš„çš„æ˜¯ç»çº¬åº¦ï¼Œç»çº¬åº¦å¯ä»¥ç”±ç³»ç»Ÿæä¾›çš„å¦ä¸€ä¸ªæ–¹æ³•æ¥ è¿›è¡Œå„ç§è½¬æ¢ é€šè¿‡è¿™ä¸ªDeletage
    //åœ°ç†ä¿¡æ¯
    CLLocation *location = [locations firstObject];
    
    CLGeocoder *coder = [[CLGeocoder alloc] init];
    
    [coder reverseGeocodeLocation:location completionHandler:^(NSArray<CLPlacemark *> * _Nullable placemarks, NSError * _Nullable error) {
        //åœ°æ ‡ä¿¡æ¯
    }];
    
    // å»ºè®®ä¸è¦ä¸€ç›´ å¼€å¯ éƒ½åœ¨è·å– ç”¨æˆ·ä½ç½®
     [self.manager stopUpdatingLocation];
}

@end


## ä½¿ç”¨çš„æ—¶å€™ä¹Ÿéå¸¸çš„ç®€å•
//
//  AppDelegate.m
//  SampleApp
//
//  Created by dequanzhu on 2019.
//  Copyright Â© 2019 dequanzhu. All rights reserved.
//

#import "AppDelegate.h"
#import "GTNewsViewController.h"
#import "GTVideoViewController.h"
#import "GTRecommendViewController.h"
#import "GTSplashView.h"
#import "GTStaicTest.h"
#include <execinfo.h>
#import "GTLocation.h"
#import "GTNotification.h"
#import "GTMineViewController.h"
#import <TencentOpenAPI/TencentOAuth.h>

@interface AppDelegate ()<UITabBarControllerDelegate>

@end

@implementation AppDelegate


- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  ++++++
    //å®šä½å’Œpush
    [[GTLocation locationManager] checkLocationAuthorization];
    [[GTNotification notificationManager] checkNotificationAuthorization];
    
```



// æœ‰å…³äºinfo.plist

```xml
+++
	<key>NSLocationWhenInUseUsageDescription</key>
	<string>éœ€è¦æ‚¨çš„ä½ç½®ä¿¡æ¯æ¨èåœ°æ–¹æ–°é—»</string>
+++
```



> æ‰€ä»¥æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹å“ˆï¼š
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642412601487-7a66919e-5da3-4e84-acc4-24f0731135ed.png)

# å…³äºIOSçš„æ¨é€
## ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642417443643-3a87d70a-e018-49a0-816f-75f31ae68cad.png)

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642417700425-87ead69f-68b3-401b-9d56-21a26cb80044.png)

> æ³¨æ„ è¿™ä¸ªæ˜¯å¯¹äºios9é«˜ç‰ˆæœ¬ æ¥ç”¨çš„ï¼Œå¦‚æœæ˜¯ä¸€äº›ä½ç‰ˆæœ¬å°±ä¸ç®¡äº†ï¼Œè·å–æƒé™å°±è¯´ä¸Šé¢çš„å‡ ä¸ªåŸºæœ¬çš„æ­¥éª¤ï¼Œå¦‚ä½•æ“ä½œæ•°æ®æ˜¯ä¸‹é¢æ¥ç€è¦è¯´çš„
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642418560017-7847c7e4-97c8-409c-a1a7-fcba38cadc5a.png)

> contentæ˜¯å†…å®¹ï¼Œtiggeræ˜¯æ¨é€çš„æ—¶æœº ï¼Œæœ€ååˆ°æˆ‘ä»¬å¼€å‘è€…æ‰‹ä¸­ï¼Œéƒ½æ˜¯è¦æ¥ç€å°è£…å°è£…çš„
>

 ![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642418956167-8bd4015d-4e09-45be-a413-707ee4018a19.png)

> å¤§æ¦‚çš„æµç¨‹å°±èšåˆå¦‚ä¸‹é¢æµç¨‹ Content -> Trigger -> Req -> Center _ ____> Delegate
>



> å…³äºè¿œç¨‹çš„æ¨é€çš„å®ç°ï¼Œä¸»è¦æ˜¯è§£å†³ è¿›ç¨‹æ€æ‰è¿˜ç»§ç»­æ¨é€é€šçŸ¥ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªé•¿è¿æ¥ï¼ŒAPNsæ˜¯IOSçš„ä¸€ä¸ªæœåŠ¡ï¼Œæ‰€æœ‰çš„æ¨é€æ“ä½œ éƒ½è¦å»å¯¹æ¥Apns ï¼ŒAPNSæ˜¯IOSä¸­å”¯ä¸€çš„ä¸€ä¸ªæ¨é€é•¿è¿æ¥ï¼Œä¸€ä¸ªPUSHé€šé“ï¼Œå†ç”±å®ƒ æ¨é€åˆ°è®¾å¤‡ å’Œ App 
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642509849941-04b997cc-b3fb-4daa-aec5-ed2dbb0d4ba0.png)

> å…·ä½“æˆ‘ä»¬è¦åšçš„ï¼šé…ç½®UUIDï¼ˆéœ€è¦Capabilities è¯ä¹¦ï¼‰ ï¼Œé…ç½®åå°æ•°æ® ï¼Œæ¥å—å¹¿æ’­
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642510538081-67b7cfb6-01ec-4207-9101-042340f8724a.png)

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642510618535-3e00b1de-32e2-49ef-84aa-2cb218e0e632.png)

> æˆ‘ä»¬ä¹Ÿæœ‰ä¸€äº›æ¨é€çš„SDK å¯ä»¥ä½¿ç”¨ï¼Œå°±ç›®å‰ä½“éªŒå’Œä»£ç¨³å®šæ€§æ¥è¯´è…¾è®¯çš„XG ï¼Œè´¨é‡æ¯”è¾ƒå¥½ ï¼Œä½†æ˜¯ä¹Ÿæ¯”è¾ƒè´µï¼Œè¿™äº›ç¬¬ä¸‰æ–¹çš„è¿˜æ˜¯éå¸¸ç®€å•çš„ã€‚
>

## ä»£ç å®ç°
> å’Œloactionä¸€æ ·è¿™ä¸ªä¸œè¥¿ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨å•ä¾‹æ¥å®ç°ï¼Œä¹ŸåŒæ ·éœ€è¦çœ‹çœ‹å…¨å±€çš„æƒé™æœ‰æ²¡æœ‰å¼€ï¼Œå†çœ‹çœ‹Appå†…çš„æƒé™æœ‰æ²¡æœ‰å¼€
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642511089836-e04916f3-6a83-4282-b2ff-8e6e541348c4.png)

```objectivec
## hæ–‡ä»¶
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

/**
 APP æ¨é€ç®¡ç†
 */
@interface GTNotification : NSObject

+ (GTNotification *)notificationManager;

- (void)checkNotificationAuthorization;

@end

NS_ASSUME_NONNULL_END


## mæ–‡ä»¶
#import "GTNotification.h"
// æ¡Œæ³¨æ„å•Šï¼Œæˆ‘ä»¬ä¹Ÿè¦ä½¿ç”¨ ç³»ç»Ÿæä¾›çš„åº“ æ¥å®ç°ï¼Œinfo.pliistä¹Ÿæ˜¯éœ€è¦é…ç½®äº†ï¼Œè¿™é‡Œå°±ä¸å¤šè¯¦ç»†çš„è¯´äº†
#import <UserNotifications/UserNotifications.h>
#import <UIKit/UIKit.h>

@interface GTNotification ()<UNUserNotificationCenterDelegate>  // å®ç°è¿™ä¸ªDelegate

@end

@implementation GTNotification

+ (GTNotification *)notificationManager{
    static GTNotification *manager;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        manager = [[GTNotification alloc] init];
    });
    return manager;
}

- (void)checkNotificationAuthorization{
    
    UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];
    center.delegate = self;
    // UNAuthorizationOptionBadge åˆä¸Šè§’çš„çº¢ç‚¹ï¼Œå’Œå£°éŸ³UNAuthorizationOptionSound
    [center requestAuthorizationWithOptions:UNAuthorizationOptionBadge | UNAuthorizationOptionSound completionHandler:^(BOOL granted, NSError * _Nullable error) {
        
        if (granted) {
            //æœ¬åœ°æ¨é€  ï¼ˆæœ‰æƒé™çš„æ—¶å€™å…ˆè§¦å‘ä¸€æ¬¡æœ¬åœ°æ¨é€PUSHï¼‰
            [self _pushLocalNotification];
            
            //è¿œç¨‹æ¨é€ ï¼ˆå¦‚ä½•è§¦å‘ä¸€æ¬¡ è¿œç¨‹æ¨é€ ï¼‰è¿œç¨‹çš„PUSHï¼Œç¬¬ä¸€æ­¥è¦æ›´IOSçš„APNs è·å–token
            dispatch_async(dispatch_get_main_queue(), ^{ // è¿™ä¸ªä»£ç éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šè·‘
                [[UIApplication sharedApplication] registerForRemoteNotifications];
            });
            
            // ç„¶åä½¿ç”¨delegaet æ¥è¿›è¡Œå›è°ƒé€»è¾‘è§¦å‘
        }
    }];
}

#pragma mark -

- (void)_pushLocalNotification{
    
    UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];
    content.badge = @(1);
    content.title = @"æå®¢æ—¶é—´";
    content.body = @"ä»0å¼€å‘ä¸€æ¬¾iOS App"; 
    content.sound = [UNNotificationSound defaultSound];
     // è¿™é‡Œéƒ½æ˜¯åœ¨ç”Ÿäº§-> Centent
    
    
    // ç”Ÿäº§æ—¶æœº æ—¶é—´é—´éš” 30.f  ï¼ˆ30sï¼‰
    UNTimeIntervalNotificationTrigger *trigger =  [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:30.f repeats:NO];
    
    // Req
    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:@"_pushLocalNotification" content:content trigger:trigger];
    
    // Center
    [[UNUserNotificationCenter currentNotificationCenter] addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) {
    //
    }];
}

#pragma mark -

- (void)userNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(UNNotificationPresentationOptions options))completionHandler{
    completionHandler(UNNotificationPresentationOptionAlert);
}


- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void(^)(void))completionHandler {
    
    //å¤„ç†badgeå±•ç¤ºé€»è¾‘
    //ç‚¹å‡»ä¹‹åæ ¹æ®ä¸šåŠ¡é€»è¾‘å¤„ç†
    //[UIApplication sharedApplication].applicationIconBadgeNumber = 100;

    //å¤„ç†ä¸šåŠ¡é€»è¾‘  è¿™ä¸ªå°±æ˜¯ç‚¹å‡»é€šçŸ¥çš„æ—¶å€™ è¦è¿›è¡Œçš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ‰“å¼€xxxåº•å±‚é¡µé¢ä¸Šé¢çš„
    completionHandler();
}

@end


## æˆ‘ä»¬å†æ¥çœ‹çœ‹ å†AppDelegaet.m çš„æ—¶å€™ä¹Ÿæ˜¯éœ€è¦çš„ å’Œ Loactioinå®šä½æƒé™æ˜¯ä¸€æ ·çš„ç”¨æ³• å’Œé€»è¾‘ 
 
++++

#pragma mark - PUSH

- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken{
    //å°½é‡æ”¶æ•›åˆ°GTNotificationä¸­å®ç°
    //æ³¨å†ŒæˆåŠŸ  æ‹¿åˆ°äº†deviceToken å‘ç»™ä½ çš„æœåŠ¡ï¼Œä½ çš„æœåŠ¡å™¨ è¿›è¡Œæ¶ˆæ¯æ¨é€å°±å¥½äº† ï¼Œæœ‰ä¸€ä¸ªå°å·¥å…· å¯ä»¥
    // æ‹¿æ¥å½“åšæœåŠ¡å™¨ï¼ŒPusher
}

- (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error {
    //æ³¨å†Œå¤±è´¥
}

```

> å®é™…ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬è¿˜æ˜¯å»ºè®®å…¬å¸è‡ªç ” ï¼Œæ¯•ç«Ÿæ§åˆ¶æƒåœ¨æˆ‘ä»¬è‡ªå·±çš„æ‰‹ä¸Š
>



# APPå›¾æ ‡çš„é—®é¢˜
## ç†è®ºçŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642511399926-bd99b882-8b7b-4fa0-9ca1-02a91b8f77c9.png)

> æœ‰ä¸€äº›å·¥å…· ğŸ”§å¯ä»¥ä¸€é”®ç”ŸæˆIOSAppçš„å›¾æ ‡ï¼Œæ¯”å¦‚Perpo ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠç”Ÿäº§çš„å›¾ç‰‡ ä¸¢åˆ°Assetä¸­çš„AppIconä¸­å°±å¥½äº†ï¼ŒNotification çš„ICONä¹Ÿæ˜¯å¯ä»¥æ›´æ”¹çš„ï¼Œå›¾æ ‡æ•°å­—Brgith å¦‚ä½•åšå®šåˆ¶åŒ–å‘¢ï¼Ÿå¦‚ä½•+-1æ“ä½œå‘¢ï¼Ÿä¸»è¦æ˜¯è¯´ç³»ç»Ÿæä¾›çš„ä¸€ä¸ªå® 
>

```objectivec
- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void(^)(void))completionHandler {
    
    //å¤„ç†badgeå±•ç¤ºé€»è¾‘
    //ç‚¹å‡»ä¹‹åæ ¹æ®ä¸šåŠ¡é€»è¾‘å¤„ç†
    //[UIApplication sharedApplication].applicationIconBadgeNumber = 100;

    //å¤„ç†ä¸šåŠ¡é€»è¾‘  è¿™ä¸ªå°±æ˜¯ç‚¹å‡»é€šçŸ¥çš„æ—¶å€™ è¦è¿›è¡Œçš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ‰“å¼€xxxåº•å±‚é¡µé¢ä¸Šé¢çš„
    completionHandler();
}

```

> åœ¨IOS10.3 + ä¹‹åï¼ŒIOSçš„Appèƒ½åŠ¨æ€çš„æ›´æ”¹å›¾æ ‡ ï¼Œä½†æ˜¯å›å¼¹å‡ºä¸€ä¸ªçª—å£ï¼ˆç½‘ä¸Šæœ‰éå¸¸é¸¡è´¼çš„æ•™ç¨‹ï¼‰
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642511766816-72ca2539-5040-4dbc-a64b-a167f4bcd700.png)

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642511922000-b7165052-2e3f-4491-83f6-d479634dd2da.png)

ä¸»è¦æ˜¯æŠŠè¦æ›´æ”¹çš„å›¾ç‰‡ æ¢åœ¨Buildä¸­ï¼Œä½¿ç”¨info.list å»ç®¡ç†ï¼Œå†ç”¨ä¸€ä¸ªå‡½æ•° å»æ‰‹åŠ¨çš„æ›¿æ¢å›¾æ ‡

```objectivec
++++
- (void)tabBarController:(UITabBarController *)tabBarController didSelectViewController:(UIViewController *)viewController{
    NSLog(@"did select");

    //æµ‹è¯•æ›´æ¢å›¾æ ‡
    //[self _changeIcon];
}
++++
- (void)_changeIcon{
    //åŠ¨æ€æ›´æ¢å›¾æ ‡
    if ([UIApplication sharedApplication].supportsAlternateIcons) {
        [[UIApplication sharedApplication] setAlternateIconName:@"ICONBLACK" completionHandler:^(NSError * _Nullable error) {
            //å›è°ƒ
        }];
    }
}
```



# Applicatoon Extension
> è¿™ä¸ªæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ æˆ‘ä»¬ä¹‹å‰çš„å¼€å‘Appéƒ½æ˜¯åœ¨Appä¸­è°ƒç”¨ç³»ç»Ÿçš„Apiæ¥æ“ä½œå“¦ï¼Œç°åœ¨æˆ‘ä»¬çœ‹çœ‹Appå¦‚ä½•æä¾› åŠŸèƒ½ç»™ç³»ç»Ÿï¼Œç»å…¸çš„åœºæ™¯ å°±æ˜¯è‡ªå®šä¹‰åˆ†äº«ï¼Œè‡ªå®šä¹‰é”®ç›˜ï¼Œ-1 å±é€šçŸ¥æ“ä½œï¼ŒShare ç­‰....
>

## åŸºç¡€çŸ¥è¯†


![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642512164441-59554a52-4dbf-4d23-9770-9836ddb11137.png)

> æ³¨æ„ï¼âš ï¸ Extesnion å’ŒAppè¿è¡Œæ—¶æ— å…³ï¼ŒAppçš„ä½œä¸ºç‹¬ç«‹äºŒè¿›åˆ¶ æ¥è¿è¡Œçš„ï¼Extensionæ—¶ç‹¬ç«‹çš„
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642512345088-b2f829cf-6151-45e6-86f0-7c6e3d5cf3a3.png)

> å®¿ä¸»App HostApp è°ƒç”¨Extesion ï¼Œç”±Extendsion å¯åŠ¨è¢«å”¤é†’ï¼Œè¿›è¡Œä¸€äº›ContaiingAppçš„é€»è¾‘æˆ–è€…åŠŸèƒ½ï¼ŒåŠŸèƒ½ç”¨å®Œä¹‹åå¥½ï¼Œç³»ç»Ÿä¼šæŠŠå®ƒè‡ªåŠ¨killæ‰
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642512519089-c70dfc91-3284-4239-8230-4d33d9d147cf.png)

ä»£ç å…±äº« ï¼Œå°±æ˜¯é€šè¿‡embededFrmaewrok è¿›ä»£ç å…±äº«ï¼Œextensoinæ—¶ä½œä¸ºä¸»Appçš„åŠŸèƒ½è¡ç”Ÿ



## å®ç°ä¸€ä¸ªä»£ç å’Œæ•°æ®å…±äº«Extesion
> å…ˆå»åˆ›å»ºä¸€ä¸ª
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642512671587-51b86716-0979-4240-9113-03b32a586373.png)

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642512834032-2a4e9f6c-0676-4536-b1c3-de6672d4f320.png)

å»å®ç°å…·ä½“ä¸šåŠ¡é€»è¾‘çš„ä»£ç 

```objectivec
//
//  TodayViewController.m
//  GTToday
//
//  Created by dequanzhu on 2019.
//  Copyright Â© 2019 dequanzhu. All rights reserved.
//

#import "TodayViewController.h"
#import <NotificationCenter/NotificationCenter.h>
#import <TencentOpenApi/QQApiInterface.h>  // ä»£ç å…±äº«

@interface TodayViewController () <NCWidgetProviding>

@end

@implementation TodayViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    [self.view addSubview:({
        UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(100, 0, 200, 100)];
        [button setTitle:@"ç‚¹å‡»è·³è½¬" forState:UIControlStateNormal];
        [button setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
        [button addTarget:self action:@selector(_openSampleApp) forControlEvents:UIControlEventTouchUpInside];
        button;
    })];
    
    //è¿›è¡Œæ•°æ®å…±äº«
    NSUserDefaults *userDeault = [[NSUserDefaults alloc] initWithSuiteName:@"group.com.dequanzhu.sample"];
//    [userDeault setObject:@"ä»0å¼€å‘ä¸€æ¬¾iOS App" forKey:@"title"];
    __unused NSString *shareTitle = [userDeault objectForKey:@"title"];

}

// é¡µé¢æœ‰æ›´æ–°çš„æ—¶å€™ ä¼šè¿›å…¥è¿™ä¸ªå›è°ƒ
- (void)widgetPerformUpdateWithCompletionHandler:(void (^)(NCUpdateResult))completionHandler {
    // Perform any setup necessary in order to update the view.
    
    // If an error is encountered, use NCUpdateResultFailed
    // If there's no update required, use NCUpdateResultNoData
    // If there's an update, use NCUpdateResultNewData

    completionHandler(NCUpdateResultNewData);
}

#pragma mark -

- (void)_openSampleApp{
    //è·³è½¬åˆ°ä¸»App
    [self.extensionContext openURL:[NSURL URLWithString:@"GTTest://"] completionHandler:^(BOOL success) {
        
    }];
}

@end


## .m 
#import <UIKit/UIKit.h>

@interface TodayViewController : UIViewController

@end


```

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642513287698-16ff4763-6ca7-4f91-9c06-cd44c2aced17.png)

> å¦‚æœéœ€è¦åŒç»„çš„Appæ•°æ®å…±äº«ï¼Œå°±éœ€è¦å»çœ‹æä¸€äº›è¯ä¹¦ç›¸å…³çš„ä¸œè¥¿
>
> ![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642513417295-abf97f03-5185-4291-a75b-85ba5c8fe57e.png)
>

åœ¨ç›¸åŒçš„gruopä¸‹ï¼ŒAppçš„éƒ¨åˆ†æ•°æ®æ—¶å¯ä»¥å…±äº«çš„



```objectivec
   ++++
    //Extension å…±äº«æ•°æ®
    NSUserDefaults *userDeault = [[NSUserDefaults alloc] initWithSuiteName:@"group.com.dequanzhu.sample"];
    [userDeault setObject:@"ä»0å¼€å‘ä¸€æ¬¾iOS App" forKey:@"title"];

## ç„¶åæˆ‘ä»¬å¯ä»¥å» åˆ«çš„å…±äº«ä»£ç é‡Œå–åˆ°è¿™äº›æ•°æ®  
+++
    
@implementation TodayViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    [self.view addSubview:({
        UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(100, 0, 200, 100)];
        [button setTitle:@"ç‚¹å‡»è·³è½¬" forState:UIControlStateNormal];
        [button setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
        [button addTarget:self action:@selector(_openSampleApp) forControlEvents:UIControlEventTouchUpInside];
        button;
    })];
    
    //è¿›è¡Œæ•°æ®å…±äº«
    NSUserDefaults *userDeault = [[NSUserDefaults alloc] initWithSuiteName:@"group.com.dequanzhu.sample"];
//    [userDeault setObject:@"ä»0å¼€å‘ä¸€æ¬¾iOS App" forKey:@"title"];
    __unused NSString *shareTitle = [userDeault objectForKey:@"title"];

}
```

# UIKitä¸­æ¯”è¾ƒå¤æ‚çš„ç»„ä»¶ï¼ˆç”¨æˆ·è¾“å…¥&é”®ç›˜ï¼‰
## åŸºç¡€çŸ¥è¯†
![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642513830882-6a900749-3d05-46cc-a16a-f957de936489.png)

> å°±æ‹¿RN æ¥è¯´ï¼ŒRNçš„TextInput Mutilept å¯¹è¿™ä¸ªæ”¯æŒå°±éå¸¸çš„å®Œå–„ã€‚ä¹Ÿä¸ç”¨è¿™ä¹ˆå¤æ‚ 
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642514940164-69776039-52a3-4255-b8c8-070555d4f5ef.png)

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1642514986743-48e1a8ae-252a-4fcc-8dfa-e6ed7f9c335c.png)

> å¯¹äºå’Œé”®ç›˜çš„äº¤äº’ ï¼ŒRN ä¹Ÿæœ‰ç›¸å…³çš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿæ¯”è¾ƒçš„ç®€å•ï¼Œ
>

## ä»£ç å®ç°
> æ€»ä½“æ¥è¯´ï¼Œä»£ç å®ç°è§’åº¦æ¥è¯´ï¼Œä¹Ÿç›¸å¯¹çš„æ¯”è¾ƒç®€å•
>

```objectivec
//  GTSearchBar.m
#import "GTSearchBar.h"
#import "GTScreen.h"

@interface GTSearchBar ()<UITextFieldDelegate>

@property(nonatomic, strong, readwrite) UITextField *textField;

@end

@implementation GTSearchBar

- (instancetype)initWithFrame:(CGRect)frame{
    self = [super initWithFrame:frame];
    if (self) {
        [self addSubview:({
            _textField = [[UITextField alloc] initWithFrame:CGRectMake(UI(10), UI(7), frame.size.width - UI(10) *2, frame.size.height - UI(7) *2)];
            _textField.backgroundColor = [UIColor whiteColor];
            _textField.delegate = self;
            _textField.leftView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"search"]];
            _textField.leftViewMode = UITextFieldViewModeUnlessEditing;
            _textField.clearButtonMode = UITextFieldViewModeAlways;
            _textField.placeholder = @"ä»Šæ—¥çƒ­ç‚¹æ¨è";
            _textField;
        })];
    }
    return self;
}

#pragma mark -

// ä¸¤ä¸ªé”®ç›˜å®è·µ âŒ¨ï¸
- (void)textFieldDidBeginEditing:(UITextField *)textField{
    //
}

- (void)textFieldDidEndEditing:(UITextField *)textField{
    //
}

- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string{
    //å¸¸ç”¨ä¸šåŠ¡é€»è¾‘ - å­—æ•°åˆ¤æ–­ å¯ä»¥åœ¨æ­¤å‡½æ•°ä¸­å®ç°
    return YES;
}

- (BOOL)textFieldShouldReturn:(UITextField *)textField{
    [_textField resignFirstResponder];
    return YES;
}

@end

### .m æ–‡ä»¶çš„å®ç°
//  GTSearchBar.h
#import <UIKit/UIKit.h>

NS_ASSUME_NONNULL_BEGIN

/**
 æœç´¢æ¡
 */
@interface GTSearchBar : UIView

@end

NS_ASSUME_NONNULL_END

### æˆ‘ä»¬å¯ä»¥ç ¸viewWillApperarçš„ç”Ÿå‘½å‘¨æœŸä¸­è´´åˆ°Viewä¸­å»
// GTNewsViewController.m
- (void)viewWillAppear:(BOOL)animated{
    [super viewWillAppear:animated];
    [self.tabBarController.navigationItem setTitleView:({
        GTSearchBar *searchBar = [[GTSearchBar alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH - UI(20), self.navigationController.navigationBar.bounds.size.height)];
        searchBar;
        
        //æ‹‰èµ·é”®ç›˜å’Œè¾“å…¥æ¡†
//        UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH - UI(20), self.navigationController.navigationBar.bounds.size.height)];
//        button.backgroundColor = [UIColor lightGrayColor];
//        [button addTarget:self action:@selector(_showCommentView) forControlEvents:UIControlEventTouchUpInside];
//        button;
    })];
}

```

