---
title: "React Navigation å®ç°æ–¹æ¡ˆï¼šè·¯ç”±ç®¡ç†ä¸é¡µé¢è·³è½¬"
date: "2024-12-19"
summary: "è¯¦ç»†ä»‹ç» React Navigation åœ¨ React Native é¡¹ç›®ä¸­çš„å®Œæ•´å®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ Stackã€Drawerã€Tab å¯¼èˆªçš„é…ç½®ä¸ä½¿ç”¨ï¼Œä»¥åŠè·¯ç”±çŠ¶æ€ç®¡ç†å’Œé¡µé¢è·³è½¬é€»è¾‘ã€‚"
status: "completed"
tech: ["React Native", "Navigation", "Router"]
github: "https://github.com/BM-laoli"
arxiv: ""
keyId: "App"
---

> å‰é¢æˆ‘ä»¬ä»…ä»…æ˜¯å®Œæˆäº† éå¸¸ç®€å•çš„ä¸œè¥¿ï¼Œä½†æ˜¯å¯¹äºRouter æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„å®ç°å‡ºæ¥ ï¼Œå®Œæ•´çš„å®ç°å‡ºæ¥ï¼Œè¯´ç™½äº†ï¼Œç°åœ¨çš„è¿™ä¸ªé¡¹ç›®è¿˜æ˜¯ä¸€ä¸ª ä¸å®Œæ•´çš„é¡¹ç›®ï¼Œå®ƒè¿0.0.1 çš„ç‰ˆæœ¬éƒ½ç®—ä¸ä¸Š. ç°åœ¨æˆ‘ä»¬æ¥å®Œå–„å®ƒï¼Œ**<font style="color:#E8323C;">æŠŠnavigation å®Œå–„æ‰</font>**
>

# å…³äº router navigation çš„é…ç½®
## æ€»ä½“çš„è®¾è®¡æ–¹æ¡ˆå’Œæ€è·¯
> æ€»ä½“çš„æ€è·¯æ¯”è¾ƒçš„ç®€å•ï¼Œæˆ‘ä»¬ç”¨åŸç”Ÿå¤„ç†å¤šä¸ªViewè§†å›¾ï¼ˆä¸ç®¡æ˜¯Androidè¿˜æ˜¯IOSï¼‰å¹¶ä¸”æŠŠä»–ä»¬å­˜å‚¨åœ¨ä¸€ä¸ªArrayä¸­æ¨¡æ‹ŸStuck ï¼Œpush å°±å¾€é‡Œé¢åŠ ï¼Œpop å°±å¼¹å‡ºå»ï¼› åœ¨RNç«¯æˆ‘ä»¬ä½¿ç”¨react-navigation å¤„ç† ä¸»æ¨¡å—ã€‚å®Œæˆä¾§è¾¹æ  + bar-navigation + ä¸€äº›é‡è¦çš„æ¨¡å—ã€‚å…¶ä»–çš„éƒ¨åˆ†éƒ½è‡ªå·±å»å®Œæˆ stuck æ“ä½œå°±å¥½ ï¼Œå°±ä¸è¦ç”¨å…¶ä»–çš„navigationäº†åªè¦ ä¸€ç§stuck å°±å¥½
>



```typescript
// è¿™ä¸ªè¦åˆ°mobx é‡Œé¢å»
navigation = {
  statick:{} // è¿™é‡Œä¿å­˜ æœ¬æ¨¡å— navigation çš„å®ä¾‹ æˆ–è€…ä¸€äº›ä¸œè¥¿
  // stuck æ“ä½œ
  push:() => {},
  back:() => {},
  // tab æ 
  barNavigation: () => {},
}
```



## IOS å®ç°ç»†èŠ‚


## RNçš„é›†æˆNavigation
> æ˜ç¡®æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥å®ç°seller App ä¸€æ ·çš„æ•ˆæœ
>

![](https://cdn.nlark.com/yuque/0/2022/png/1627571/1668142710191-b190a494-40a3-46b3-8712-710cdb0ae6eb.png)

é‚£ä¹ˆå…¶é‡è¦çš„ç»†èŠ‚å¦‚ä¸‹ ï¼Œä¸‹é¢æ˜¯éƒ¨åˆ†å‚è€ƒä»£ç 



### å‚è€ƒ
```tsx
// ç‹¬ç«‹é¡µé¢åœ¨æ­¤æ³¨å…¥è·¯ç”±
const AppStack = {
  default: 'AppStack',
  initialRouteName: 'Guide',
  Screen: [
    {
      // å…¨å±€çš„ä¸€äº›äº›å—éƒ½å¹³é“ºå¼€
      name: 'Guide',
      option: {headerShown: false},
      components: Guide,
    },
    {
      name: 'PDF',
      option: {headerShown: false},
      components: PDF,
    },
    {
      name: 'WebViewSDK',
      option: {headerShown: false},
      components: WebViewSDK,
    },
    {
      name: 'AfterSalesDetails',
      option: {
        headerShown: false,
        headerTransparent: true,
      },
      components: AfterSalesDetails,
    },
    // åˆ‡æ¢åº•éƒ¨å¯¼èˆªæŠ½å±‰
    {
      name: 'ScanLayout',
      option: {headerShown: false},
      components: ScanLayout,
    },
    // AppStack -> æŠ½å±‰ -> å¯¼èˆª
    {
      name: 'Dre',
      option: {headerShown: false},
      components: DrawerStackNavigator,
    },
  ],
};

const AppModules = createNativeStackNavigator();
function AppStackComponent() {
  if (Platform.OS === 'android') {
    StatusBar.setBackgroundColor('#00000000');
  }
  return (
    <AppModules.Navigator {...AppStack}>
      {AppStack.Screen.map((item, index) => {
        const localoptions = Platform.OS === 'android' ? {...item.option, statusBarStyle: 'dark'} : item.option;
        return (
          //@ts-ignore
          <AppModules.Screen
            key={index}
            // @ts-ignore
            options={localoptions}
            listeners={{
              state: (e) => {
                DrawerCode.hide();
              },
            }}
            name={item.name}
            component={RouterComponent(item)}
          />
        );
      })}
    </AppModules.Navigator>
  );
}

// è¿™ä¸ªRouterCompoent æ˜¯ä¸€ä¸ªå…¨å±€çš„layout
import {useEffect} from 'react';
import {useNavigation} from '@react-navigation/native';
import store from '@/module/Main/store';

const {routerStore} = store;

const RouterComponent = (props: any) => {
  // ä¿å­˜å½“å‰çŠ¶æ€åˆ°RouterStore 
  const navigation = useNavigation();
  useEffect(() => {
    routerStore.setNavigation(navigation);
  }, []);
  return props.components;
};

export default RouterComponent;

// routerStore
import {makeAutoObservable, observable} from 'mobx';
import {NavigationProp} from '@react-navigation/native';

class RouterStore {
  constructor() {
    makeAutoObservable(this, {
      navigation: observable,
    });
  }

  navigation: NavigationProp<ReactNavigation.RootParamList> | undefined = undefined;

  setNavigation = (newNavigation: NavigationProp<ReactNavigation.RootParamList>) => {
    this.navigation = newNavigation;
  };
}
const routerStore = new RouterStore();

export default routerStore;

// store
import routerStore from './routerStore';
export default {
  routerStore
}

```

```tsx

import {createBottomTabNavigator} from '@react-navigation/bottom-tabs';

const TabNai = createBottomTabNavigator();
const TabNavigator: React.FC<{}> = (props) => {
  const {t} = useTranslation();
  const {unRed} = useLocalObservable(() => store.messageStore);

  const newEgg = t('g-newegg');
  const message = t('g-message');
  const headline = t('g-headline');
  const tabBarLayout = (iconSource: any, isRed?: boolean) => {
    return (
      <View style={styles.icon}>
        {isRed && <View style={[styles.noRed]}></View>}
        <Image style={{width: '100%', height: '100%'}} source={iconSource} />
      </View>
    );
  };

  // Tabéœ€è¦é…ç½®é¡¹
  const TabStackConfig = {
    name: 'TabStackConfig',
    initialRouteName: 'NavTestHome',
    Screen: [
      {
        name: 'TabNewEgg',
        option: {
          headerShown: false,
          tabBarLabel: newEgg,
          tabBarIcon: (info: any) => {
            const {focused} = info;
            const imgSourcePath = focused
              ? require('../../assets/images/activeICON/default.png')
              : require('../../assets/images/notAcitve/default.png');
            return tabBarLayout(imgSourcePath);
          },
        },
        components: Home,
      },
      {
        name: 'TabMessage',
        option: {
          headerShown: false,
          tabBarLabel: message,
          tabBarIcon: (info: any) => {
            const {focused} = info;
            const imgSourcePath = focused
              ? require('../../assets/images/activeICON/message.png')
              : require('../../assets/images/notAcitve/message.png');
            return tabBarLayout(imgSourcePath, Boolean(unRed));
          },
        },
        components: Community,
      },
      // {
      //   name: 'TabHeadline',
      //   option: {
      //     headerShown: false,
      //     tabBarLabel: headline,
      //     tabBarIcon: (info: any) => {
      //       const {focused} = info;
      //       const imgSourcePath = focused
      //         ? require('../../assets/images/activeICON/nx.png')
      //         : require('../../assets/images/notAcitve/nx.png');
      //       return tabBarLayout(imgSourcePath);
      //     },
      //   },
      //   components: nx,
      // },
    ],
  };
  return (
    <TabNai.Navigator
      screenOptions={() => ({
        tabBarActiveTintColor: globalStyle.colors.orange6,
        tabBarInactiveTintColor: globalStyle.colors.gray7,
      })}
    >
      {TabStackConfig.Screen.map((item, index) => {
        return <TabNai.Screen key={index} options={item.option} name={item.name} component={RouterComponent(item)} />;
      })}
    </TabNai.Navigator>
  );
};

export default observer(TabNavigator);

// ä¸‹é¢æ˜¯ä¸‰ä¸ªtab
// Tabéœ€è¦é…ç½®é¡¹
const CommunityStackConfig = {
  name: 'CommunityStackConfig',  // è¿™ä¸ªä¸œè¥¿ä¹Ÿè®¸ä¸éœ€è¦ğŸ¤” 
  initialRouteName: 'NavTestHome',
  Screen: [
    {
      name: 'Community',
      option: {headerShown: false},
      components: Community,
    },
  ],
};

const CommunityStackNavigator = createNativeStackNavigator();
const CommunityStack = () => {
  return (
    <CommunityStackNavigator.Navigator {...CommunityStackConfig}>
      {CommunityStackConfig.Screen.map((item, index) => {
        return (
          <CommunityStackNavigator.Screen
            key={index}
            options={item.option}
            name={item.name}
            component={RouterComponent(item)}
          />
        );
      })}
    </CommunityStackNavigator.Navigator>
  );
};

export default CommunityStack;

// Tabéœ€è¦é…ç½®é¡¹
const HomeStackConfig = {
  name: 'NewEggStackConfig',
  Screen: [
    {
      name: 'NewEgg',
      option: {headerShown: false},
      components: Home,
    },
  ],
};

const HomeStackNavigator = createNativeStackNavigator();

const HomeStack = () => {
  return (
    <HomeStackNavigator.Navigator {...HomeStackConfig}>
      {HomeStackConfig.Screen.map((item, index) => {
        return (
          <HomeStackNavigator.Screen
            key={index}
            options={item.option}
            name={item.name}
            component={RouterComponent(item)}
          />
        );
      })}
    </HomeStackNavigator.Navigator>
  );
};


// Tabéœ€è¦é…ç½®é¡¹ (è¿™ä¸ªæ˜¯ä¸ºäº†æ‰“ç®—åšçš„Newsæ¨¡å—ï¼Œç›®å‰æš‚æ—¶æ²¡æœ‰)
const NeweggStackStackNavigatorConfig = {
  name: 'HeadlineStackConfig',
  Screen: [
    {
      name: 'Headline',
      option: {headerShown: false},
      components: NX,
    },
  ],
};

const NeweggStackStackNavigator = createNativeStackNavigator();
export const NeweggStackStack = () => {
  return (
    <NeweggStackStackNavigator.Navigator {...NeweggStackStackNavigatorConfig}>
      {NeweggStackStackNavigatorConfig.Screen.map((item, index) => {
        return (
          <NeweggStackStackNavigator.Screen
            key={index}
            options={item.option}
            name={item.name}
            component={RouterComponent(item)}
          />
        );
      })}
    </NeweggStackStackNavigator.Navigator>
  );
};


```

```tsx
import {RouterComponent} from '@/common/components/container';
const DrawerStackConfig = {
  name: 'DrawerStack',  // æ€è€ƒä¸€ä¸‹ è¿™ä¸ªåœ°æ–¹æ˜¯å¦å¯ä»¥éƒ½å»æ‰ï¼Œç›´æ¥ç”¨å¤–é¢å¹³é“ºçš„ä¸œè¥¿ï¼Ÿ
  Screen: [
    {
      name: 'AccountDrawer',
      option: {
        headerShown: false,
        drawerStyle: {width: '86%'},
      } as DrawerNavigationOptions,
      components: TabNavigator,
    },
  ],
};

// æŠ½å±‰
const StackDrawer = createDrawerNavigator();
const DrawerStackNavigator = (props: any) => {
  return (
    <StackDrawer.Navigator drawerContent={(props) => <SettingDrawer {...props} />} initialRouteName="DrawerStack">
      {DrawerStackConfig.Screen.map((item, index) => {
        return (
          <StackDrawer.Screen
            key={index}
            options={{...item.option, drawerType: 'front'}}
            name={item.name}
            component={RouterComponent(item)}
          />
        );
      })}
    </StackDrawer.Navigator>
  );
};

export default DrawerStackNavigator;

```



å…³äºrouter å¦‚ä½•è·³è½¬

```typescript
import {makeAutoObservable, observable} from 'mobx';
import {NavigationProp} from '@react-navigation/native';

class RouterStore {
  constructor() {
    makeAutoObservable(this, {
      navigation: observable,
    });
  }

  navigation: NavigationProp<ReactNavigation.RootParamList> | undefined = undefined;

  setNavigation = (newNavigation: NavigationProp<ReactNavigation.RootParamList>) => {
    this.navigation = newNavigation;
  };
}
const routerStore = new RouterStore();

export default routerStore;

// 
const navigateTo = (routeName: string, params?: any) => {
  RouterEvent({
    navigation: routerStore.navigation!,
    action: StackActions.push(routeName, params),
  });
};


import {NavigationAction, NavigationProp, NavigationState} from '@react-navigation/native';
interface RouterAction {
  navigation: NavigationProp<ReactNavigation.RootParamList>;
  Route?: 'AppStack' | 'DrawerStack' | 'TabStack';
  action: NavigationAction | ((state: NavigationState) => NavigationAction);
}

// çˆ¶ç±»
const RouterEvent = (prams: RouterAction) => {
  const {navigation, Route = '', action} = prams;
  if (!Route) {
    navigation.dispatch(action);
    return;
  }
  findRoute(navigation, Route).dispatch(action);
};

//  é€’å½’å›æº¯ æ‰¾åˆ°ä½ éœ€è¦çš„Routeå±‚çº§
const findRoute = (
  navigation: RouterAction['navigation'],
  RouteName: 'AppStack' | 'DrawerStack' | 'TabStack',
): RouterAction['navigation'] => {
  const RouteList: Array<RouterAction['navigation']> = [];
  const find = (navigation: RouterAction['navigation']) => {
    if (!navigation?.getParent()?.getState()) {
      RouteList.push(navigation);
      return;
    }
    RouteList.push(navigation);
    find(navigation.getParent());
  };
  find(navigation);

  enum MapNames {
    'AppStack' = 'WebViewSDK',
    'DrawerStack' = 'drawer1',
    'TabStack' = 'æ–°è›‹',
  }
  const fish = RouteList.find((item) => item.getState()?.routeNames.find((it) => it === MapNames[RouteName]));
  return fish || navigation;
};

// AppEntryEvent
const entryEvent = () => {};

export {RouterEvent, entryEvent};

```

å¥½ä»¥ä¸Šï¼Œå°±æ˜¯Seller App çš„æ ·å­ï¼Œå…¶ä¸­çš„ä»£ç éƒ½æ˜¯åšæ¥éšç§ä¿æŠ¤ï¼Œæ²¡æœ‰å…¨éƒ¨çš„æºç ï¼Œåªæ˜¯éƒ¨åˆ†æ ¸å¿ƒ



### å®ç°
#### è®¾è®¡
> é‡è¦è¯´æ˜
>

1. index åªæ”¾ä¸»è¦çš„main æ¨¡å—
2. å…¶ä»–çš„æ¨¡å—éƒ½è‡ªå·±å»å¼•ç”¨ ä¸è¦ï¼Œæ”¾åˆ°index å»å¼•ï¼Œä¹Ÿä¸éœ€è¦æ¨¡å—ä¹‹å‰ç›¸äº’å¼•
3. å…¬å…±æ¨¡å—å’Œç»„ä»¶ ï¼Œè¯·ä¸¢common åŒ…ä¸­



> navigation åˆ†ç±»
>

1.  ä»¥stuck ä¸ºä¸»ï¼Œåœ¨Main ä¸­åˆ†äº† navigation barï¼Œå’Œdrawï¼Œ (å¯¹äºä¾§è¾¹æ  æˆ‘ä»¬éœ€è¦è°ƒæ•´åŸæ¥çš„IOSä¾§ æ‹†åŒ…æ–¹æ¡ˆï¼Œè®©å®ƒèƒ½å¤Ÿæ”¯æŒ reanimated)-ç›¸å…³çš„Issues [Reanimatedæ¥å…¥é—®é¢˜ Â· Issue #10 Â· ljunb/rn-relates](https://github.com/ljunb/rn-relates/issues/10)

[https://github.com/software-mansion/react-native-reanimated/issues/846#issuecomment-943267584](https://github.com/software-mansion/react-native-reanimated/issues/846#issuecomment-943267584)ï¼Œä½†æ˜¯ç›®å‰æˆ‘ä»¬çš„å°è¯•è¿˜æ˜¯å…·æœ‰å±€é™æ€§çš„å°±æ˜¯ï¼Œå·¦æ»‘åŠ¨è¿”å› éœ€è¦ç¦ç”¨ åŸç”Ÿviewçš„è¿”å›ï¼Œè¦ä¸ç„¶å½“RN-Navigation å»æ¥ç®¡çš„æ—¶å€™å›å¼•å‘ å·¦ä¾§åªæ‰§è¡Œ åŸç”Ÿview çš„back è€Œä¸ä¼šæ‰§è¡Œ RN-Navigation çš„back ï¼Œå¦‚æœæˆ‘ä»¬ç¦ç”¨åŸç”Ÿçš„View back ï¼Œé‚£ä¹ˆåœ¨æ¨¡å—ä¸»stuck çš„æ—¶å€™æ— æ³•å·¦æ»‘ back å…¶ä½™éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ç›®å‰è¿˜æ²¡æœ‰éå¸¸å¥½çš„æ–¹å¼å»æ§åˆ¶å®ƒ

2.  å…¶ä»–æ¨¡å—è¯·å…¨éƒ¨ä½¿ç”¨ stuck ï¼Œå¦‚æœæœ‰drawéœ€æ±‚ï¼Œè¯·ä½¿ç”¨drawç»„ä»¶ 



> ç»Ÿä¸€çš„navigation å¤„ç†æ‰€æœ‰è·³è½¬ç­‰ä¸šåŠ¡é€»è¾‘
>

ä¸ºäº†ç»Ÿä¸€æ‰€æœ‰çš„page è·³è½¬è¡Œä¸ºï¼Œæˆ‘å»ºè®®å°è£…ä¸€ä¸ªè‡ªå·±ç”¨çš„ï¼Œä½†æ˜¯è¿™ä¸ªå°è£…è¦æ³¨æ„ï¼å¾—æ”¯æŒåœ¨é ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚å…¨å±€æ‹¦æˆªå™¨ä¸­ä¹Ÿæƒ³æ§åˆ¶è·³è½¬ï¼Œä½†....ä»–æ˜¯ä¸ªtså­˜é€»è¾‘ï¼Œå½“ç„¶å¯ä»¥ä½¿ç”¨rxjs çš„æ–¹å¼å‘é€ç»™æ ¹ç»„ä»¶ï¼Œæ‰§è¡Œè·³è½¬ä¹Ÿokï¼Œå…·ä½“çœ‹è®¾è®¡ï¼Œæœ‰ä¸¤ç§ï¼Œä¸‹é¢çš„ä¾‹å­å°±æ˜¯ä½¿ç”¨äº† mobx å¤„ç†çš„

```typescript

  if (inMaintain.includes(ResponseCode)) {
    RouterEvent({
      navigation: routerStore.navigation!,
      Route: 'AppStack',
      action: StackActions.replace('Maintain', {
        startTime: timeArr[0] || '2021-10-29T02:04:31.105Z',
        entTime: timeArr[1] || '2021-10-30T07:19:00.000Z',
      }),
    });
    return true;
  }
```



#### å‰ç½®æ¨¡å—
1. å‰ç½®æ¨¡å—å®‰è£…



```shell
# ä½¿ç”¨stuck éœ€è¦è¿™äº›æ¨¡å—  https://reactnavigation.org/docs/getting-started 
yarn add react-native-screens react-native-safe-area-context 
# ä½¿ç”¨draw éœ€è¦è¿™äº›æ¨¡å— https://reactnavigation.org/docs/drawer-navigator/
yarn add react-native-gesture-handler react-native-reanimated
# ä½¿ç”¨button éœ€è¦è¿™äº›æ¨¡å— https://reactnavigation.org/docs/material-bottom-tab-navigator ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹ ä½ éœ€è¦icon æœ€å¥½ç”¨è¿™ä¸ªï¼‰
yarn add @react-navigation/material-bottom-tabs react-native-paper react-native-vector-icons
```



2. é…ç½® å¯¹äº Â react-native-reanimated æˆ‘ä»¬è¦é…ç½® è¦ä¸ç„¶ä¼šå¼•å‘ä¸‹é¢çš„é—®é¢˜



[https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/installation/](https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/installation/)



```javascript
[Sat Nov 12 2022 16:17:10.780]  ERROR    Error: Failed to initialize react-native-reanimated library, make sure you followed installation steps here: https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/installation/ 
1) Make sure reanimated's babel plugin is installed in your babel.config.js (you should have 'react-native-reanimated/plugin' listed there - also see the above link for details) 
2) Make sure you reset build cache after updating the config, run: yarn start --reset-cache
[Sat Nov 12 2022 16:17:10.782]  ERROR    Invariant Violation: Module AppRegistry is not a registered callable module (calling runApplication)
[Sat Nov 12 2022 16:17:10.783]  ERROR    Invariant Violation: Module AppRegistry is not a registered callable module (calling runApplication)
[Sat Nov 12 2022 16:18:12.743]  ERROR    Invariant Violation: Module AppRegistry is not a registered callable module (calling unmountApplicationComponentAtRootTag)
[Sat Nov 12 2022 16:18:13.786]  ERROR    Invariant Violation: Module AppRegistry is not a registered callable module (calling runApplication)
```



3. æ­£ç¡®çš„å¤„ç† éœ€è¦åœ¨bableä¸­åŠ ä¸Šé…ç½®



```javascript

module.exports = {
  presets: ['module:metro-react-native-babel-preset'],
  plugins: [
    [
      'module-resolver',
      {
        extensions: ['.tsx', '.ts', '.js', '.json'],
        alias: {
          [pak.name]: path.join(__dirname, '..', pak.source),
        },
      },
    ],
    ['react-native-reanimated/plugin'],
  ],
};
```



_å¦‚æœå¯èƒ½å»ºè®®ä½¿ç”¨ Â yarn start --reset-cache --port=8082_è¿è¡Œ

#### å…·ä½“ç»†èŠ‚
```tsx
/*------------------------------router.ts------*/
/* eslint-disable no-undef */
import DrawerStackNavigator from '../Drawer';
import M1 from '../modules/page/Modules1';
import M2 from '../modules/page/Modules2';

export interface InterRouterItem {
  default: string;
  initialRouteName: string;
  Screen: Array<InterScreen>;
}

interface InterScreen {
  name: string;
  component: () => React.ReactNode;
  options?: any;
}

//  Stuck
const AppStack: InterRouterItem = {
  default: 'AppStack',
  initialRouteName: 'Drawer',
  Screen: [
    {
      name: 'M1',
      component: M1,
      options: {
        headerShown: true, // é»˜è®¤æŠŠå¤´éƒ¨å¤„ç†æ‰ï¼Œå› ä¸ºå®ƒçš„å¤´éƒ¨ è¿˜æ˜¯å¸Œæœ›äº¤ç»™å®ƒè‡ªå·±å¤„ç†/å…¬ç”¨ç»„ä»¶
      },
    },
    {
      name: 'M2',
      component: M2,
      options: {
        headerShown: true,
      },
    },
    // æ³¨æ„ dre ä¸‹å¥— tab æ‰èƒ½è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœ
    {
      name: 'Drawer',
      options: {
        headerShown: false,
      },
      component: DrawerStackNavigator,
    },
  ],
};

export default AppStack;

/*------------------------------App.js------*/
/* eslint-disable @typescript-eslint/no-unused-vars */
import * as React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';
import { SafeAreaProvider } from 'react-native-safe-area-context';
import 'react-native-gesture-handler';
import 'react-native-reanimated';

import AppStack from './routes';

const RouterComponent = (props: any) => {
  return props.component;
};

// æ”¶å£
const AppModules = createNativeStackNavigator();
const Router = () => {
  return (
    <AppModules.Navigator {...AppStack}>
      {AppStack.Screen.map((item) => {
        return (
          <AppModules.Screen
            key={item.name}
            name={item.name}
            options={item.options}
            component={RouterComponent(item)}
          />
        );
      })}
    </AppModules.Navigator>
  );
};

export default function App() {
  return (
    <SafeAreaProvider>
      <NavigationContainer>
        <Router />
      </NavigationContainer>
    </SafeAreaProvider>
  );
}



```

```tsx
/*------------------------------Drawer,js------*/
/* eslint-disable @typescript-eslint/no-unused-vars */
import {
  createDrawerNavigator,
  DrawerNavigationOptions,
} from '@react-navigation/drawer';
import TabNavigation from './TabNavigation';
import React from 'react';
import { Button, Text, View } from 'react-native';

const DrawerStackConfig = {
  name: 'DrawerStack', // æ€è€ƒä¸€ä¸‹ è¿™ä¸ªåœ°æ–¹æ˜¯å¦å¯ä»¥éƒ½å»æ‰ï¼Œç›´æ¥ç”¨å¤–é¢å¹³é“ºçš„ä¸œè¥¿ï¼Ÿ
  Screen: [
    {
      name: 'DrawerStack',
      options: {
        headerShown: false,
        drawerStyle: { width: '86%' },
      } as DrawerNavigationOptions,
      component: TabNavigation,
    },
  ],
};

const SettingDrawer = (props: any) => {
  return (
    <View>
      <Text>2</Text>
      <Button title="x" />
    </View>
  );
};

const RouterComponent = (props: any) => {
  // ä¿å­˜å½“å‰çŠ¶æ€åˆ°RouterStore
  // const navigation = useNavigation();
  // useEffect(() => {
  //   routerStore.setNavigation(navigation);
  // }, []);
  return props.component;
};

// æŠ½å±‰
const StackDrawer = createDrawerNavigator();
const DrawerStackNavigator = () => {
  return (
    <StackDrawer.Navigator
      id="LeftDrawer"
      drawerContent={(props) => <SettingDrawer {...props} />}
      initialRouteName="DrawerStack"
    >
      {DrawerStackConfig.Screen.map((item, index) => {
        return (
          <StackDrawer.Screen
            key={index}
            options={{ ...item.options, drawerType: 'front' }}
            name={item.name}
            component={RouterComponent(item)}
          />
        );
      })}
    </StackDrawer.Navigator>
  );
};

export default DrawerStackNavigator;


```

```tsx
/*------------------------------index,js------*/
/* eslint-disable prettier/prettier */
import React from 'react';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import { Button, Text, View } from 'react-native';
import { CommonActions, useNavigation } from '@react-navigation/native';
import { SafeAreaView } from 'react-native-safe-area-context';

const B1 = () => {
  const navigate = useNavigation();
  return (
    <SafeAreaView>
      <View>
        <Text>B1</Text>
        <View>
          <Button
            title="OPEN_D"
            onPress={() => {
              const drawerNavigation = navigate.getParent(
                'LeftDrawer' as any
              ) as any;
              drawerNavigation.openDrawer();
            }}
          />
        </View>
        <View>
          <Button
            title="GO_M1"
            onPress={() => {
              navigate.dispatch(
                CommonActions.navigate({
                  name: 'M1',
                  params: {},
                })
              );
            }}
          />
        </View>
      </View>
    </SafeAreaView>
  );
};

const B2 = () => {
  return (
    <View>
      <Text>B2</Text>
    </View>
  );
};

const B3 = () => {
  return (
    <View>
      <Text>B3</Text>
    </View>
  );
};

const B4 = () => {
  return (
    <View>
      <Text>B4</Text>
    </View>
  );
};

const B5 = () => {
  return (
    <View>
      <Text>B5</Text>
    </View>
  );
};

const RouterComponent = (props: any) => {
  // ä¿å­˜å½“å‰çŠ¶æ€åˆ°RouterStore
  // const navigation = useNavigation();
  // useEffect(() => {
  //   routerStore.setNavigation(navigation);
  // }, []);
  return props.component;
};

const TabNai = createBottomTabNavigator();
const TabNavigator: React.FC<{}> = () => {
  // Tabéœ€è¦é…ç½®é¡¹
  const TabStackConfig = {
    name: 'TabStackConfig',
    initialRouteName: 'B3',
    Screen: [
      {
        name: 'B1',
        option: {
          headerShown: false,
          // tabBarLabel: <></>,
        },
        component: B1,
      },
      {
        name: 'B2',
        option: {
          headerShown: false,
          // tabBarLabel: <></>,
        },
        component: B2,
      },
      {
        name: 'B3',
        option: {
          headerShown: false,
          // tabBarLabel: <></>,
        },
        component: B3,
      },
      {
        name: 'B4',
        option: {
          headerShown: false,
          // tabBarLabel: <></>,
        },
        component: B4,
      },
      {
        name: 'B5',
        option: {
          headerShown: false,
          // tabBarLabel: <Text>2</Text>,
        },
        component: B5,
      },
    ],
  };

  return (
    <TabNai.Navigator
    // screenOptions={() => ({
    //   tabBarActiveTintColor: '#F06C00',
    //   tabBarInactiveTintColor: '#858585',
    // })}
    >
      {TabStackConfig.Screen.map((item, index) => {
        return (
          <TabNai.Screen
            key={index}
            options={item.option}
            name={item.name}
            component={RouterComponent(item)}
          />
        );
      })}
    </TabNai.Navigator>
  );
};

export default TabNavigator;


```



ğŸ¤”æˆ‘ä»¬èƒ½ä¸èƒ½å»æ‰å¤šä½™çš„å…¨å±€stuck å…¨ç”¨ä¸€ä¸ªDrawer å…¶ä»–çš„å…¨éƒ¨ä¸¢å®ƒé‡Œé¢å°±å¥½å•¦å‘¢ï¼Ÿ

....

## Android å®ç°ç»†èŠ‚


# Layoutçš„è®¾è®¡
```tsx
/* eslint-disable sonarjs/cognitive-complexity */
/*
 * @Author: aoda
 * @Date: 2021-10-20 19:27:50
 * @Description: appå¤´éƒ¨ç»„ä»¶
 */
import React, {memo, ReactNode, useEffect} from 'react';
import {StatusBar, View, Text, Image, ScrollView, TouchableWithoutFeedback, Platform, ViewStyle} from 'react-native';
import {useState} from 'react';
import styles from './style';
import {useNavigation} from '@react-navigation/core';
import RNExitApp from 'react-native-exit-app';
import {SafeAreaView} from 'react-native-safe-area-context';

type codeType = string | number | ReactNode;
interface props {
  leftCode?: codeType; // å·¦è¾¹code
  leftEvent?: () => void; // å·¦è¾¹äº‹ä»¶
  titleCode: codeType; // ä¸­é—´code
  rightCode?: codeType; // å³è¾¹æ ‡é¢˜
  rightEvent?: () => void; // å³è¾¹äº‹ä»¶
  children: ReactNode; //  --------V2-----æ–°å¢çš„å±æ€§
  scroll?: boolean; // æ˜¯å¦æ”¯æŒæ»šåŠ¨
  immersive?: {
    // æ˜¯å¦éœ€è¦æ²‰æµ¸å¼çš„ç”¨æˆ·ä½“éªŒ
    backgroundColor: string; // èƒŒæ™¯é¢œè‰²
  };
  // Header åº•éƒ¨ è‡ªå®šä¹‰æ¸²æŸ“  ä¸€èˆ¬ éœ€è¦å’Œ needHeadLind ä¸€èµ·ä½¿ç”¨
  needBodyStyle?: boolean; // æ˜¯å¦éœ€è¦bodyçš„æ•´ä¸ªpaddingè·ç¦»
  needHeadLind?: boolean; // æ˜¯å¦å…è®¸æœ‰åº•éƒ¨è¾¹æ¡†
  renderHeaderFooter?: ReactNode;
  wrapBgStyle?: ViewStyle;
  content?: React.ReactNode; //  å®Œå®Œå…¨å…¨çš„è‡ªå®šä¹‰
  notSafe?: false; // å»æ‰å®‰å…¨åŒºåŸŸï¼Ÿ
}

const PageLayout: React.FC<props> = (props) => {
  const {scroll = true, needHeadLind = true, needBodyStyle = true, renderHeaderFooter} = props;
  const route = useNavigation();
  const [isTopNav, setIsTopNav] = useState(route.canGoBack());
  const goBack = () => {
    if (route.canGoBack()) {
      setIsTopNav(false);
      route.goBack();
    } else {
      setIsTopNav(true);
      RNExitApp.exitApp();
    }
  };
  const {leftCode, leftEvent = goBack, titleCode, rightCode = '', rightEvent, immersive} = props;

  // å¦‚æœè®¾ç½®äº†â€œæ²‰æµ¸å¼â€çš„æ•ˆæœ åˆ™è‡ªåŠ¨è¿è¡Œæ­¤ä»£ç ç‰‡æ®µ
  useEffect(() => {
    if (immersive && Platform.OS === 'android') {
      StatusBar.setBackgroundColor(immersive?.backgroundColor);
      StatusBar.setTranslucent(true);
    }
    return () => {
      Platform.OS === 'android' && immersive && StatusBar.setTranslucent(false);
    };
  }, []);

  return (
    <SafeAreaView
      mode="padding"
      edges={['right', 'top', 'left']}
      style={[styles.safeBgColor, immersive && {backgroundColor: immersive.backgroundColor}]}
    >
      <View style={[styles.layoutWrap]}>
        {props?.content ? (
          props?.content
        ) : (
          <View style={[]}>
            <View
              style={[
                styles.head,
                styles.flexRowSBC,
                !needHeadLind ? styles.headNotBottom : undefined,
                {backgroundColor: immersive?.backgroundColor},
              ]}
            >
              {/* å·¦å¿« */}
              {!isTopNav || leftCode ? (
                <View style={[styles.berWrap]}>
                  {typeof leftCode === 'string' ? (
                    <TouchableWithoutFeedback onPress={leftEvent}>
                      <Text style={[styles.rightCode, styles.leftCode]}>{leftCode}</Text>
                    </TouchableWithoutFeedback>
                  ) : (
                    <>{leftCode}</>
                  )}
                </View>
              ) : (
                <TouchableWithoutFeedback onPress={leftEvent}>
                  <View style={[styles.leftIconWrap, styles.flexRowSBC, styles.berWrap]}>
                    <Image
                      source={
                        !immersive
                          ? require('@/common/assets/images/left_direct.png')
                          : require('@/common/assets/images/left_directW.png')
                      }
                      style={styles.leftIcon}
                    ></Image>
                  </View>
                </TouchableWithoutFeedback>
              )}
              {/* æ ‡é¢˜ */}
              <View style={{flex: 1, flexDirection: 'row', justifyContent: 'center'}}>
                <Text style={[styles.title, immersive && {color: '#fff'}]}>{titleCode}</Text>
              </View>
              {/* å³å¿« */}
              <View
                style={[
                  styles.berWrap,
                  {
                    alignItems: 'flex-end',
                  },
                ]}
              >
                {typeof rightCode === 'string' ? (
                  <Text style={styles.rightCode} onPress={rightEvent}>
                    {rightCode}
                  </Text>
                ) : (
                  <>{rightCode}</>
                )}
              </View>
            </View>
            {renderHeaderFooter ? renderHeaderFooter : null}
          </View>
        )}
        {scroll ? (
          <ScrollView
            style={[styles.childrenWrap, !needBodyStyle ? styles.childrenNotWrap : undefined, props.wrapBgStyle]}
          >
            {props.children}
          </ScrollView>
        ) : (
          <>{props?.children}</>
        )}
      </View>
    </SafeAreaView>
  );
};
export default memo(PageLayout);


import {createNeweggStyles} from '@/common/utils/style';
import {globalStyle} from '@/common/style';
import {FonStyle} from '@/common/utils/style';
const styles = createNeweggStyles({
  safeBgColor: {
    backgroundColor: '#fff',
    flex: 1,
  },
  layoutWrap: {
    flex: 1,
    backgroundColor: '#fff',
  },
  head: {
    height: 48,
    paddingHorizontal: 16,
    borderBottomWidth: 1,
    borderBottomColor: globalStyle.colors.gray3,
  },
  flexRowSBC: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  headNotBottom: {
    borderBottomWidth: 0,
  },
  leftIconWrap: {
    justifyContent: 'center',
    alignItems: 'center',
  },
  berWrap: {
    minWidth: 75,
    maxWidth: 75,
    overflow: 'hidden',
    paddingVertical: 10,
  },
  leftIcon: {
    width: 10,
    height: 15,
  },
  leftCode: {
    color: globalStyle.colors.gray7,
  },
  title: {
    ...FonStyle({
      fontSize: 19,
    }),
    fontWeight: '600',
    color: '#000',
    fontFamily: 'PingFang SC',
  },
  rightCode: {
    ...FonStyle({
      fontSize: 15,
    }),
    fontWeight: '600',
    color: globalStyle.colors.orange6,
    fontFamily: 'PingFang SC',
  },
  childrenWrap: {
    paddingHorizontal: 16,
  },
  childrenNotWrap: {
    paddingHorizontal: 0,
  },
});
export default styles;

```

# å…³äºè®¾è®¡ç¨¿Style
> 750 * 812 = IphoneX
>

```typescript
//
import {StyleSheet, Dimensions, Platform} from 'react-native';
import {ImageStyle, TextStyle, ViewStyle} from 'react-native';
import {isTablet} from 'react-native-device-info';

export interface CustomNamedRenderStyles {
  [key: string]: ViewStyle & TextStyle & ImageStyle;
}
// å¯ç”¨äºç›´æ¥è½¬åŒ–çš„å±æ€§ï¼Œ
const translateProps = [
  'width',
  'height',
  'lineHeight',
  'minWidth',
  'minHeight',
  'maxWidth',
  'maxHeight',
  'marginTop',
  'marginBottom',
  'marginLeft',
  'marginRight',
  'marginVertical',
  'marginHorizontal',
  'paddingTop',
  'paddingBottom',
  'paddingLeft',
  'paddingRight',
  'paddingVertical',
  'paddingHorizontal',
  'top',
  'bottom',
  'left',
  'right',
  'lineHeight',
  'borderRadius',
  'borderTopWidth',
];
// å¯ç”¨äºå­—ä½“çš„è½¬åŒ–å±æ€§
const translateFontProps = ['fontSize', 'lineHeight'];

const translateOnWidth = (value: number) => {
  if (isNaN(value)) {
    return value;
  }
  if (isTablet()) {
    if (value === STANDARD_WIDTH) {
      return DEVICE_WIDTH;
    }
    return value;
  }
  return Math.round((value / STANDARD_WIDTH) * DEVICE_WIDTH);
};

// è®¾è®¡æå°ºå¯¸ä»¥åŠï¼Œæ¨ªç«–å±åˆ‡æ¢
const STANDARD_WIDTH = 375;
const STANDARD_HEIGHT = 812;
const FONT_SIZE_SCALER: number = 1;
const DEVICE_WIDTH =
  Dimensions.get('window').width > Dimensions.get('window').height
    ? Dimensions.get('window').height
    : Dimensions.get('window').width;
const DEVICE_HEIGHT =
  Dimensions.get('window').width > Dimensions.get('window').height
    ? Dimensions.get('window').width
    : Dimensions.get('window').height;

const GLOBALWIDTH = Dimensions.get('window').width;
const GLOBALHEIGHT = Dimensions.get('window').height;

// æ¨ªç«–å±åˆ‡æ¢ + å±å¹•é€‚é…æ¢ç®—
const getTranslateWidthWithDevice = (originWidth: number): number => {
  if (isNaN(originWidth)) {
    return originWidth;
  }
  if (isTablet()) {
    if (originWidth === STANDARD_WIDTH) {
      return DEVICE_WIDTH;
    }

    return originWidth;
  }
  return Math.round((originWidth / STANDARD_WIDTH) * DEVICE_WIDTH);
};

const getTranslateHeightWithDevice = (originHeight: number): number => {
  if (isNaN(originHeight)) {
    return originHeight;
  }

  if (isTablet()) {
    return originHeight;
  }
  return Math.ceil((originHeight / STANDARD_HEIGHT) * DEVICE_HEIGHT);
};

// è®¾ç½® å­—ä½“
const FonStyle = (value: Pick<TextStyle, 'fontSize' | 'lineHeight'>) => {
  const {fontSize, lineHeight} = value;
  return {
    ...(fontSize && {fontSize: getTranslateFontSize(fontSize)}),
    ...(lineHeight && {lineHeight: getTranslateLineHeight(lineHeight)}),
  };
};

// å­—ä½“ç¼©æ”¾
const getTranslateFontSize = (originFontsize: number) => {
  return Platform.OS === 'android'
    ? getTranslateWidthWithDevice(originFontsize) * FONT_SIZE_SCALER
    : getTranslateWidthWithDevice(originFontsize);
};

// å­—ä½“Lineç¼©æ”¾
const getTranslateLineHeight = (originLineHeight: number) => {
  return Platform.OS === 'android'
    ? parseInt((getTranslateWidthWithDevice(originLineHeight) * FONT_SIZE_SCALER).toString())
    : getTranslateWidthWithDevice(originLineHeight);
};

// ä¸»å‡½æ•°
const createNeweggStyles = (styles: CustomNamedRenderStyles) => {
  const tmpStyles: CustomNamedRenderStyles = {...styles};
  for (const key in styles) {
    if (Array.isArray(styles[key])) {
      const flattenValue = Object.assign({}, styles[key]);
      styles[key] = flattenValue;
    }
    tmpStyles[key] = getTranslatePropertyWithWidth(styles[key]);
  }
  return StyleSheet.create(tmpStyles);
};

// è½¬æ¢å‰¯å‡½æ•°
const getTranslatePropertyWithWidth = (style: {[x: string]: any; hasOwnProperty: (arg0: string) => any}) => {
  let tmpStyles: {[x: string]: any} = {...style};

  translateProps.forEach((property) => {
    if (style.hasOwnProperty(property)) {
      tmpStyles[property] = getTranslateWidthWithDevice(style[property]);
    }
  });

  translateFontProps.forEach((property) => {
    if (style.hasOwnProperty(property)) {
      tmpStyles = {
        ...tmpStyles,
        ...FonStyle(style[property]),
      };
    }
  });
  return tmpStyles;
};

export {
  getTranslateWidthWithDevice,
  getTranslateHeightWithDevice,
  FonStyle,
  getTranslateFontSize,
  getTranslateLineHeight,
  createNeweggStyles,
  GLOBALWIDTH,
  GLOBALHEIGHT,
  translateOnWidth,
};

```



```typescript
const styles = createNeweggStyles({
  afterSaleItem: {
    backgroundColor: '#fff',
    borderRadius: 4,
    marginBottom: 12,
    padding: 8,
  },
  itemCard: {
    flexDirection: 'row',
    padding: 4,
  },
  itemCardWrap: {
    borderBottomColor: globalStyle.colors.gray3,
    marginBottom: 4,
  },
  left: {
    marginRight: 8,
  },
  itemImg: {
    width: 64,
    height: 48,
  },
  right: {
    flex: 1,
  },
  afterSaleItemTitle: {
    ...FonStyle({fontSize: 15}),
    marginBottom: 4,
  },
  sellerPort: {
    ...FonStyle({
      fontSize: 12,
    }),
    color: globalStyle.colors.gray8,
    marginBottom: 4,
  },
  timeWrap: {
    flexDirection: 'row',
    alignItems: 'center',
  },
```

